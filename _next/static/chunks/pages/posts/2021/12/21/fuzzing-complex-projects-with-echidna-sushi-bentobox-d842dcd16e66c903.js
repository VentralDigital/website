(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1965],{6246:function(s,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2021/12/21/fuzzing-complex-projects-with-echidna-sushi-bentobox",function(){return n(25191)}])},25191:function(s,e,n){"use strict";n.r(e),n.d(e,{__toc:function(){return i}});var o=n(35250),r=n(47147),t=n(77298),l=n(18363);let i=[{depth:2,value:"The BentoBox",id:"the-bentobox"},{depth:2,value:"Initialization via Remix",id:"initialization-via-remix"},{depth:2,value:'Initialization via "Proxy" constructor',id:"initialization-via-proxy-constructor"},{depth:2,value:"Fuzz-targets",id:"fuzz-targets"},{depth:2,value:"The Testcase",id:"the-testcase"},{depth:2,value:"Finally, Fuzzing!",id:"finally-fuzzing"}];function _createMdxContent(s){let e=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",span:"span"},(0,t.a)(),s.components);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h1,{children:"Fuzzing Complex Projects With Echidna: Sushi's BentoBox"}),"\n",(0,o.jsxs)("p",{className:"text-xs text-right",children:["December 21, 2021 by ",(0,o.jsx)(e.a,{href:"/about#patrickd",children:"patrickd"})]}),"\n","\n",(0,o.jsxs)(e.p,{children:["During ",(0,o.jsx)(e.a,{href:"https://secureum.substack.com/p/secureum-bootcamp-for-smart-contract",children:"Secureum Bootcamp's second phase"}),' "CARE" (Comprehensive Audit Readiness Evaluation), participants were asked to review their assigned Project for typical ',(0,o.jsx)(e.a,{href:"https://secureum.substack.com/p/security-pitfalls-and-best-practices-101",children:"Pitfalls and Best Practices"})," to help prepare the project for an actual Audit. Since we were free to attempt going further than that, I wanted to try my hand at fuzzing with ",(0,o.jsx)(e.a,{href:"https://github.com/crytic/echidna",children:"Echidna"})," and quickly realized that it wouldn't be easy to do that in this case."]}),"\n",(0,o.jsxs)(e.p,{children:["The problem is that Echidna expects a rather simple environment: To run it, you need to specify a Solidity source file, a single Contract to fuzz, and the constructor must not require any parameters. The Project we were assigned to, on the other hand, ",(0,o.jsx)(e.a,{href:"https://github.com/sushiswap/bentobox-strategies",children:"Sushi's BentoBox-Strategies contracts"})," (Solidity 0.8.7), requires the ",(0,o.jsx)(e.a,{href:"https://github.com/sushiswap/bentobox/",children:"BentoBox contract"})," to be deployed (Solidity 0.6.12), and both have 3rd party dependencies such as ",(0,o.jsx)(e.a,{href:"https://etherscan.io/address/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",children:"WETH9"})," and ",(0,o.jsx)(e.a,{href:"https://aave.com/",children:"Aave"}),"."]}),"\n",(0,o.jsx)(e.h2,{id:"the-bentobox",children:"The BentoBox"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.a,{href:"https://app.sushi.com/bentobox",children:"BentoBox"})," is a Platform you can transfer your Tokens into, to make use of various Applications (currently only ",(0,o.jsx)(e.a,{href:"https://app.sushi.com/lend",children:"Kashi Lending"}),", but the ",(0,o.jsx)(e.a,{href:"https://medium.com/sushiswap-org/introducing-the-sushi-next-generation-amm-trident-7dea6aa3cbc2",children:"AMM Trident"})," and other things have been announced). Additionally, Sushi's Operations Team is able to decide on Investment Strategies for a percentage of the Tokens that are currently unused within the BentoBox."]}),"\n",(0,o.jsx)(e.p,{children:"To make things easier to grasp, we'll concentrate on a simplified use-case: A User deposits Ether into the BentoBox, without using any particular Application for now. BentoBox wraps them into WETH Tokens and at some point, they are rebalanced into the investment Strategy that the Sushi Ops team has set for WETH. This particular Strategy uses Aave to earn interest on the provided liquidity. For investing the WETH Tokens, the Strategy contract gets aWETH Tokens that increase over time and can be exchanged for the same amount of WETH when withdrawn from Aave. Sometime later the Ops Team decides to switch to another, more promising Strategy and the current one is exited, expecting the full amount of WETH (+ earned interest) to be returned into the BentoBox."}),"\n",(0,o.jsx)(e.p,{children:"Using fuzzing we now want to find out whether there's any case where the Strategy might fail to correctly send back all funds when this happens."}),"\n",(0,o.jsx)(e.h2,{id:"initialization-via-remix",children:"Initialization via Remix"}),"\n",(0,o.jsxs)(e.p,{children:["For contracts with complex initialization, the ",(0,o.jsx)(e.a,{href:"https://github.com/crytic/building-secure-contracts/tree/master/program-analysis/echidna",children:"official Tutorial"})," recommends using ",(0,o.jsx)(e.a,{href:"https://github.com/crytic/building-secure-contracts/blob/master/program-analysis/echidna/end-to-end-testing.md",children:"Etheno and the Project's Testsuite"})," to basically record the transactions made when running a single test and replay them when initializing Echidna. The tests of the AaveStrategy however, make use of a chain-fork from an archive node - that might be a bit much for a simple initialization recording."]}),"\n",(0,o.jsxs)(e.p,{children:["But why use tests if we can make use of ",(0,o.jsx)(e.a,{href:"https://github.com/crytic/etheno",children:"Etheno"}),"'s recording functionality and take care of the initialization by hand just once?"]}),"\n",(0,o.jsx)(e.pre,{"data-language":"bash","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"bash","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ubuntu@eth:~$"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"etheno"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--ganache"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--ganache-args"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"--deterministic --gasLimit 10000000"'}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"-x"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"init.json"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Ganache"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"CLI"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"v6.12.2"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (ganache-core: "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"2.13"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:".2"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Available"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Accounts"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"=================="})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (0) 0x5409ED021D9299bf6814279A6A1411A7e866A631 ("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"100"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"ETH"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"..."})}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Private"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Keys"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"=================="})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (0) 0xf2f48ee19680706196e2e339e5da3491186e0c4c5030670656b0e0164837257d"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"..."})}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Listening"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"on"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"127.0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:".0.1:8546"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"INFO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"     [12-18"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"16:48:40][Ganache@8546]"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"eth_accounts"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Etheno"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"v0.2.4"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"*"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Serving"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Flask"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"app"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'etheno.etheno'"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (lazy "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"loading"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"*"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Environment:"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"production"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"WARNING:"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"This"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"is"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"a"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"development"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"server."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Do"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"not"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"use"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"it"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"in"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"a"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"production"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"deployment."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Use"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"a"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"production"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"WSGI"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"server"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"instead."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"*"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Debug"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"mode:"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"off"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"*"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"Running"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"on"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"http://127.0.0.1:8545/"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (Press "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"CTRL+C"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"to"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"quit"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "})]})}),"\n",(0,o.jsxs)(e.p,{children:["If you are running this on the same host as your Browser, you can simply open your ",(0,o.jsx)(e.a,{href:"https://metamask.io/",children:"Metamask"}),' extension and switch to the Network "Localhost 8545". Then look for the "Import Account" option and paste in the private key of the Account (0) from the Ganache logs. Within ',(0,o.jsx)(e.a,{href:"https://remix.ethereum.org/",children:"Remix"}),', open the "Deploy & Run Transactions" sidebar and select the Environment "Injected Web3". All of the contract deployments and interactions you now make within Remix will be written into the ',(0,o.jsx)(e.code,{children:"init.json"})," file, which can be imported into Echidna."]}),"\n",(0,o.jsx)(l.UW,{type:"warning",children:(0,o.jsxs)(e.p,{children:["If you are running Etheno within a container or VM, the problem is that it's not possible to adjust the Interface/IP address that port 8545 is listening on. One way to work around this is creating a port forwarding within the guest system with ",(0,o.jsx)(e.span,{"data-rehype-pretty-code-fragment":"",children:(0,o.jsx)(e.code,{"data-language":"bash","data-theme":"default",children:(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"socat"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"TCP4-LISTEN:8544,fork"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"TCP4:127.0.0.1:8545"})]})})})," and then another one on your host with ",(0,o.jsx)(e.span,{"data-rehype-pretty-code-fragment":"",children:(0,o.jsx)(e.code,{"data-language":"bash","data-theme":"default",children:(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"socat"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"TCP4-LISTEN:8545,fork"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"TCP4:CONTAINER_IP:8544"})]})})}),". With that, you should be able to connect to it as if you were running Etheno locally."]})}),"\n",(0,o.jsxs)(e.p,{children:["So, what should be recorded? Let's trace the dependencies the ",(0,o.jsx)(e.a,{href:"https://github.com/sushiswap/bentobox-strategies/blob/be407e27cd1a9ca8060ef9a389d1cf01b4e5540e/contracts/strategies/AaveStrategy.sol",children:"AaveStrategy"})," has:"]}),"\n",(0,o.jsx)(e.pre,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"solidity","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"AaveStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BaseStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"ILendingPool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"_aaveLendingPool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                  "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Aave LendingPool contract"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"IAaveIncentivesController"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-parameter)"},children:"_incentiveController"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Aave IncentivesController contract"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"BaseStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"ConstructorParams"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" params"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BaseStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(params) {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})})]})}),"\n",(0,o.jsx)(e.pre,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"solidity","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"abstract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BaseStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"IStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Ownable"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"struct"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ConstructorParams"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        IERC20 strategyToken;       "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Token to invest (eg. WETH)"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        IBentoBoxMinimal bentoBox;  "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// BentoBox instance"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        ..."})}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"ConstructorParams"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" params) {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})})]})}),"\n",(0,o.jsx)(e.pre,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"solidity","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BentoBox"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"MasterContractManager"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:", "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"BoringBatchable"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"IERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" wethToken_) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// specifically WETH (which has no dependencies)"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})})]})}),"\n",(0,o.jsx)(e.p,{children:'While we could deploy the real Aave contracts since they\'re open source, that would likely make things a lot more complicated than necessary. Instead, it would be easier to assume Aave works as expected and only mock out the functions that the Strategy is actually interacting with. Aside from that, we also need an instance of BentoBox and a "Strategy Token" which for this use-case will be the wrapped ether contract "WETH9", which BentoBox has a dependency on anyway.'}),"\n",(0,o.jsx)(e.p,{children:'The fact that AaveStrategy\'s constructor needs some parameters, can be taken care of via the constructor of a "proxy" contract that does not, by using constants. That proxy can also take care of initializing the Aave mock contracts. BentoBox and WETH9 on the other hand use incompatible, older Solidity versions and it makes sense to record their deployment.'}),"\n",(0,o.jsxs)(e.p,{children:["So first we'll copy ",(0,o.jsx)(e.a,{href:"https://etherscan.io/address/0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2#code",children:"WETH9's source code"})," into Remix, compile it with ",(0,o.jsx)(e.code,{children:"0.4.18"})," and deploy it. After that, we'll copy a ",(0,o.jsx)(e.a,{href:"https://github.com/sushiswap/bentobox-strategies/blob/be407e27cd1a9ca8060ef9a389d1cf01b4e5540e/contracts/bentobox/BentoBoxV1.sol",children:"flattened version of BentoBox"})," that has already been conveniently adjusted to allow switching between Strategies without the usual 2 week waiting period, compile it with ",(0,o.jsx)(e.code,{children:"0.6.12"}),' and deploy it too. Finally, we want to directly transfer ownership of the BentoBox to where our "proxy" contract will be deployed to by Echidna, which we can find out by checking the ',(0,o.jsx)(e.a,{href:"https://github.com/crytic/echidna/blob/master/examples/solidity/basic/default.yaml#L26-L27",children:"default configuration"}),", and calling ",(0,o.jsx)(e.span,{"data-rehype-pretty-code-fragment":"",children:(0,o.jsx)(e.code,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"transferOwnership"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0x00a329c0648769a73afac7f9381e08fb43dbea72"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"true"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"false"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})})}),"."]}),"\n",(0,o.jsx)(l.UW,{type:"warning",children:(0,o.jsx)(e.p,{children:'If you attempt this multiple times, note that every time Ganache is restarted all transactions made so far are gone. The problem is that Metamask doesn\'t know about this, unless you go hit "Reset Accounts" in its Advanced Options, deleting the history so far and ensuring that the next transaction will work.'})}),"\n",(0,o.jsxs)(e.p,{children:["After stopping the Etheno command, you'll find all of the above transactions recorded in the ",(0,o.jsx)(e.code,{children:"init.json"})," file. To avoid Echidna complaining about parsing errors when reading it, adjust the values of the ",(0,o.jsx)(e.code,{children:"gas_price"})," and ",(0,o.jsx)(e.code,{children:"value"})," fields from numbers to strings."]}),"\n",(0,o.jsx)(e.h2,{id:"initialization-via-proxy-constructor",children:'Initialization via "Proxy" constructor'}),"\n",(0,o.jsxs)(e.p,{children:["Having taken care of dependencies with incompatible Solidity versions, the leftover initializations can be done by making use of the ",(0,o.jsx)(e.a,{href:"https://github.com/crytic/building-secure-contracts/blob/master/program-analysis/echidna/testing-bytecode.md#proxy-pattern",children:'"Proxy Pattern"'})," (not to be confused with the delegate-call-proxy patterns):"]}),"\n",(0,o.jsx)(e.pre,{"data-language":"solidity","data-theme":"default",filename:"contracts/echidna/EchidnaProxy.sol",hasCopyCode:!0,children:(0,o.jsxs)(e.code,{"data-language":"solidity","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"pragma"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"solidity"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" 0.8.7;"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"../strategies/AaveStrategy.sol"'}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"@openzeppelin/contracts/token/ERC20/ERC20.sol"'}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" EchidnaProxy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Deployed via replay of transactions from init.json:"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    IBentoBox "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constant"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" bentobox "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"IBentoBox"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0xd2a5bC10698FD955D1Fe6cb468a17809A08fd005"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ERC20 "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constant"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" weth9 "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0x635B3a867D360C1ECf382A8d695D3092c1e15237"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    AaveStrategy "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aaveStrategy;"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Initialize Strategy."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        AaveStrategy aaveStrategy_ "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aaveStrategy "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"AaveStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ILendingPool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"/* "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"TODO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:" */"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"IAaveIncentivesController"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"/* "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"TODO"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:" */"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            BaseStrategy."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ConstructorParams"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                weth9"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"             "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// strategyToken"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                bentobox"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"          "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// bentobox instance"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0x0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"                "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"[]("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"            )"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        );"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Activate the Strategy for the WETH token in BentoBox."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"setStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(weth9"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aaveStrategy);       "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Propose."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"setStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(weth9"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aaveStrategy);       "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Activate (2 week grace period bypassed)."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"setStrategyTargetPercentage"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(weth9"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"50"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"); "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// 50% of WETH balance should be invested."})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,o.jsxs)(e.p,{children:["This Proxy contract will be our fuzzing target for Echidna. The AaveStrategy is (not quite yet) initialized to invest the WETH token and then activated within BentoBox (which the Proxy is able to do since ownership has been transferred to it when ",(0,o.jsx)(e.code,{children:"init.json"})," is replayed)."]}),"\n",(0,o.jsxs)(e.p,{children:["If we had chosen to also deploy the real Aave contracts when creating that recording, we could simply specify those addresses here for ",(0,o.jsx)(e.code,{children:"ILendingPool"})," and ",(0,o.jsx)(e.code,{children:"IAaveIncentivesController"}),". But instead, we'll write some mock contracts simulating them in the most basic way:"]}),"\n",(0,o.jsx)(e.pre,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"solidity","data-theme":"default",children:[(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:'// Contract that will be "aWETH" while holding "WETH".'})}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"AaveTokenMock"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"ERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" strategyToken_"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" symbol_) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(symbol_, symbol_) {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        strategyToken_."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"approve"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(msg.sender"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" type("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:").max);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// No authentication since this contract is for testing only and won't be fuzzed."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"give"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" to"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"_mint"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(to"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"take"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" from"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"_burn"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(from"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"LendingPoolMock"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ILendingPool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ERC20 "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"immutable"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" strategyToken;"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    AaveTokenMock "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"immutable"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aToken;"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"constructor"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"ERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" strategyToken_"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aTokenSymbol_) {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        strategyToken "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" strategyToken_;"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        aToken "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"AaveTokenMock"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(strategyToken_"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aTokenSymbol_);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Called by AaveStrategy when new balance was added for investment."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"deposit"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" asset"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint16"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"override"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        aToken."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"give"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(msg.sender"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount);"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(asset)."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"transferFrom"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(msg.sender"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(aToken)"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Called by AaveStrategy when profits are taken or when the Strategy is exited."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"withdraw"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" asset"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"override"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"returns"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        aToken."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"take"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(msg.sender"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount);"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(asset)."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"transferFrom"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(aToken)"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" msg.sender"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"AaveIncentivesControllerMock"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"IAaveIncentivesController"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" { ... }"})]})]})}),"\n",(0,o.jsxs)(e.p,{children:["With this kind of mocking, the AaveStrategy should be able to exchange between the strategy token (WETH) and the aToken (aWETH) without issues - but also without interest. Later, the mock contracts can be extended with functions that give profits, rewards and even simulate losses. We can make Echidna explore these scenarios by adding fuzzable util functions like ",(0,o.jsx)(e.span,{"data-rehype-pretty-code-fragment":"",children:(0,o.jsx)(e.code,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"aave_giveReward"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount)"})]})})})," that will call them."]}),"\n",(0,o.jsx)(e.p,{children:"The fuzzing campaign can also be made more powerful by adding the option of using multiple strategy and aTokens instead of just using WETH. But for now let's keep things simple and just get the fuzzer running with some guardrails on, after it turns out that it's unable to find anything this way, we can always allow for more complexity."}),"\n",(0,o.jsx)(e.h2,{id:"fuzz-targets",children:"Fuzz-targets"}),"\n",(0,o.jsx)(e.p,{children:"As things stand, there's still nothing Echidna can actually fuzz yet, so let's add some functions to the Proxy that should be its targets:"}),"\n",(0,o.jsx)(e.pre,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"solidity","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" EchidnaProxy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"bentobox_deposit"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" share) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"payable"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox.deposit{value"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" msg.value}("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0x0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" share);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"bentobox_withdraw"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" share) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"withdraw"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0x0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" amount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" share);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"bentobox_setStrategyTargetPercentage"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint64"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" targetPercentage) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"setStrategyTargetPercentage"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"IERC20"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(weth9)"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" targetPercentage);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"bentobox_exitStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"setStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(weth9"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"IStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0x0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")));"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        bentobox."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"setStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(weth9"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"IStrategy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0x0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:")));"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"strategy_safeHarvest"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" maxBalance"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"bool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" rebalance"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" maxChangeAmount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"bool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" harvestRewards"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ) "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        aaveStrategy."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"safeHarvest"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(maxBalance"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" rebalance"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" maxChangeAmount"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" harvestRewards);"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,o.jsx)(e.p,{children:"Here again, complexity was reduced by hardcoding function parameters, which can be exposed to Echidna later if necessary. In general, you'll need to find a balance here between too much exposure, where Echidna will find itself looking for a needle in the haystack, and too many assumptions, where an issue can't be discovered anymore since the guardrails prevent Echidna from doing so."}),"\n",(0,o.jsx)(e.h2,{id:"the-testcase",children:"The Testcase"}),"\n",(0,o.jsx)(e.p,{children:"Finally, we have to give Echidna a way to check whether something has gone wrong while it poked at the BentoBox:"}),"\n",(0,o.jsx)(e.pre,{"data-language":"solidity","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"solidity","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:" EchidnaProxy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// An exited AaveStrategy never has funds left in it."})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"echidna_exitedStrategyNeverHasFunds"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"view"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"returns"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"bool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"bool"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" strategyWasExited "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aaveStrategy."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"exited"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" aTokenBalance "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" lendingPool."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"aToken"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"()."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"balanceOf"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(aaveStrategy));"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" strategyTokenBalance "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" weth9."}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"balanceOf"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"(aaveStrategy));"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// Property returns true (== state is valid) as long as either"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// - the Strategy was not exited yet"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"// - the Strategy was exited and no funds are left"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"!"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"strategyWasExited "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"||"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" (aTokenBalance "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" strategyTokenBalance "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"));"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"    ..."})}),"\n",(0,o.jsx)(e.span,{className:"line",children:(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,o.jsxs)(e.p,{children:["For the fuzzer to pick these functions up as testcases, they must be part of the abi (external/public), return a boolean value, and be prefixed with ",(0,o.jsx)(e.code,{children:"echidna_"}),'. Aim to write as many of these properties as you can come up with early on, since Echidna can check them "all at once" it would be a waste to have to rerun it for new testcases later.']}),"\n",(0,o.jsxs)(e.p,{children:['Now before starting up the fuzzer I recommend doing a dry run by playing through this as the fuzzer would. Switch Remix back to its "Javascript VM" and deploy all of the contracts and their dependencies, just like we did when creating the ',(0,o.jsx)(e.code,{children:"init.json"}),". Call each of the fuzzing target functions and check whether they had the expected effects. Between each call, check the testcase functions and make sure they all return true when you expect them to. Once confident that the environment you've built for Echidna works properly, it's time to start fuzzing."]}),"\n",(0,o.jsx)(e.h2,{id:"finally-fuzzing",children:"Finally, Fuzzing!"}),"\n",(0,o.jsxs)(e.p,{children:["To tell Echidna to initialize using the transaction log in ",(0,o.jsx)(e.code,{children:"init.json"}),", we need a simple configuration file:"]}),"\n",(0,o.jsx)(e.pre,{"data-language":"yaml","data-theme":"default",filename:"contracts/echidna/config.yaml",children:(0,o.jsxs)(e.code,{"data-language":"yaml","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"initialize"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:"contracts/echidna/init.json"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# the transactions to replay for initialization"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:"contractAddr"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"0x00a329c0648769a73afac7f9381e08fb43dbea72"'}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-comment)"},children:"# where EchidnaProxy should be deployed to"})]})]})}),"\n",(0,o.jsx)(e.p,{children:"After that, we only have to tell Echidna where to find the Proxy contract, its name, the config file, and make sure it knows that the OpenZeppelin contract dependencies can be found within the node_modules folder:"}),"\n",(0,o.jsx)(e.pre,{"data-language":"bash","data-theme":"default",children:(0,o.jsxs)(e.code,{"data-language":"bash","data-theme":"default",children:[(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"ubuntu@eth:~/bentobox-strategies$"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"echidna-test"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"contracts/echidna/EchidnaProxy.sol"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--contract"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"EchidnaProxy"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--crytic-args"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"--solc-remaps @openzeppelin/=$('}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"pwd"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string-expression)"},children:')/node_modules/@openzeppelin/"'}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"--config"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"contracts/echidna/config.yaml"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Loaded"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"total"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"of"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"transactions"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"from"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"corpus/coverage"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Analyzing"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"contract:"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"/home/ubuntu/bentobox-strategies/contracts/echidna/EchidnaProxy.sol:EchidnaProxy"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"echidna_exitedStrategyNeverHasFunds:"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"passed!"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"\uD83C\uDF89"})]}),"\n",(0,o.jsx)(e.span,{className:"line",children:" "}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Corpus"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"size:"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-constant)"},children:"1"})]}),"\n",(0,o.jsxs)(e.span,{className:"line",children:[(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-function)"},children:"Seed:"}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,o.jsx)(e.span,{style:{color:"var(--shiki-token-string)"},children:"-6400691107094289626"})]})]})}),"\n",(0,o.jsxs)(e.p,{children:["And now it's time to iterate: Tweak the fuzzing exposure, open up for more search space or narrow down to make it focus on a specific part of the code. For example, at the moment all of the function calls are made via the ",(0,o.jsx)(e.code,{children:"EchidnaProxy"})," contract, which has Owner and Executor access roles, it would make sense to allow the fuzzer to make unauthenticated calls too. Things like that should be considered when adjusting the environment while waiting for the previous campaign to finish."]}),"\n",(0,o.jsx)(e.p,{children:"Tweak, fuzz, repeat"})]})}e.default=(0,r.j)({MDXContent:function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,t.a)(),s.components);return e?(0,o.jsx)(e,{...s,children:(0,o.jsx)(_createMdxContent,{...s})}):_createMdxContent(s)},pageOpts:{filePath:"pages/posts/2021/12/21/fuzzing-complex-projects-with-echidna-sushi-bentobox.mdx",route:"/posts/2021/12/21/fuzzing-complex-projects-with-echidna-sushi-bentobox",timestamp:1701640359e3,title:"Fuzzing Complex Projects With Echidna: Sushi's BentoBox",headings:i},pageNextRoute:"/posts/2021/12/21/fuzzing-complex-projects-with-echidna-sushi-bentobox"})},47147:function(s,e,n){"use strict";n.d(e,{j:function(){return setupNextraPage}});var o,r=n(44619),t=n.n(r),l=n(54594),i=n(70079);n(77298);var a=n(35250),c=(0,i.createContext)(!1),h=n(65263);function Nextra({__nextra_pageMap:s,__nextra_dynamic_opts:e,...n}){let{context:o,Layout:r}=function(){let s=globalThis[l.eZ],{route:e}=(0,h.useRouter)();(0,i.useState)({})[1];let n=s.context[e];if(!n)throw Error("No content found for the current route. This is a Nextra bug.");return{context:n,Layout:s.Layout}}(),{Content:t,...d}=o;if(s&&(d.pageOpts={...d.pageOpts,pageMap:s}),e){let{headings:s,title:n,frontMatter:o}=JSON.parse(e);d.pageOpts={...d.pageOpts,headings:s,title:n,frontMatter:o}}return(0,a.jsx)(r,{...d,pageProps:n,children:(0,a.jsx)(c.Provider,{value:n,children:(0,a.jsx)(t,{...n})})})}var d=n(86264),x=n(99199),k=n(20439);function pageTitleFromFilename(s){return k(s.replaceAll(/[-_]/g," "))}function isFolder(s){return!!s&&"object"==typeof s&&"folder"===s.type}function normalizeMetaData(s){return Object.fromEntries(Object.entries(s).map(([s,e])=>{if(isFolder(e)){let n=s.replace("/","");return[n,e.title||pageTitleFromFilename(n)]}return[s,e||pageTitleFromFilename(s)]}))}function setupNextraPage({pageNextRoute:s,pageOpts:e,nextraLayout:n,themeConfig:r,MDXContent:i,hot:a,pageOptsChecksum:c,dynamicMetaModules:h=[]}){var k;"undefined"==typeof window&&(globalThis.__nextra_resolvePageMap=async()=>{if(o)return o;let s=JSON.parse(JSON.stringify(p.pageMap));return await Promise.all(h.map(async([e,{metaObjectKeyPath:n,metaParentKeyPath:o}])=>{let r=await e,l=await r.default(),i=t()(s,n);i.data=l;let a=t()(s,o);!function collectCatchAllRoutes(s,e,n=!0){if(n){collectCatchAllRoutes(s,{kind:"Meta",data:e.data,locale:e.locale},!1),e.data=normalizeMetaData(e.data);return}for(let[n,r]of Object.entries(e.data)){if(!isFolder(r)){var o;if("*"===n)continue;s.children.push({kind:"MdxPage",...e.locale&&{locale:e.locale},name:n,route:(o=s.route,x(d.join(o,n.replace(/^index$/,""))))});continue}let t=n.replace("/",""),l={kind:"Folder",name:t,route:`${s.route}/${t}`,children:[{kind:"Meta",...e.locale&&{locale:e.locale},data:normalizeMetaData(r.items)}]};s.children.push(l),collectCatchAllRoutes(l,{kind:"Meta",data:r.items,locale:e.locale},!1)}}(a,i)})),o=s});let p=globalThis[k=l.eZ]||(globalThis[k]=Object.create(null));return e.pageMap?(p.pageMap=e.pageMap,p.Layout=n):(e={...e,pageMap:p.pageMap,flexsearch:p.flexsearch},r=p.themeConfig),e={frontMatter:{},...e},p.route=e.route,p.context||(p.context=Object.create(null)),p.context[s]={Content:i,pageOpts:e,themeConfig:r},Nextra}}},function(s){s.O(0,[3220,9774,2888,179],function(){return s(s.s=6246)}),_N_E=s.O()}]);