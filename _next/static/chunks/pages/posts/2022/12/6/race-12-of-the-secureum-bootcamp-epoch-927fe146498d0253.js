(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1039],{56057:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2022/12/6/race-12-of-the-secureum-bootcamp-epoch",function(){return n(73638)}])},64751:function(e,s){"use strict";s.Z={src:"/_next/static/media/secureum-banner.b3ad8557.jpg",height:630,width:1200,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAEAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAbEAACAgMBAAAAAAAAAAAAAAAAAgEDBCEyE//EABUBAQEAAAAAAAAAAAAAAAAAAAQF/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAwDAQACEQMRAD8AnGFcviyPjUWS1PTJuOtgAcT9auj/2Q==",blurWidth:8,blurHeight:4}},73638:function(e,s,n){"use strict";n.r(s),n.d(s,{HiddenSolution:function(){return HiddenSolution},__toc:function(){return u}});var t=n(35250),i=n(65910),c=n.n(i),l=n(47147),r=n(77298),a=n(18363),o=n(30746),d=n.n(o),h=n(64751),x=n(13423);function HiddenSolution(e){let{children:s}=e,n=Object.assign({details:"details",summary:"summary",strong:"strong",div:"div"},(0,r.a)());return(0,t.jsxs)(n.details,{closed:!0,className:"last-of-type:mb-0 rounded-lg bg-neutral-50 dark:bg-neutral-800 p-2 mt-4",children:[(0,t.jsx)(n.summary,{children:(0,t.jsx)(n.strong,{className:"text-lg",children:"Solution"})}),(0,t.jsx)(n.div,{className:"nx-p-2",children:s})]})}let u=[{depth:3,value:"Code",id:"code"},{depth:3,value:"Question 1 of 8",id:"question-1-of-8"},{depth:3,value:"Question 2 of 8",id:"question-2-of-8"},{depth:3,value:"Question 3 of 8",id:"question-3-of-8"},{depth:3,value:"Question 4 of 8",id:"question-4-of-8"},{depth:3,value:"Question 5 of 8",id:"question-5-of-8"},{depth:3,value:"Question 6 of 8",id:"question-6-of-8"},{depth:3,value:"Question 7 of 8",id:"question-7-of-8"},{depth:3,value:"Question 8 of 8",id:"question-8-of-8"}];function _createMdxContent(e){let s=Object.assign({h1:"h1",p:"p",a:"a",strong:"strong",hr:"hr",h3:"h3",pre:"pre",code:"code",span:"span"},(0,r.a)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{children:"RACE #12 Of The Secureum Bootcamp Epoch∞"}),"\n","\n",(0,t.jsxs)(d(),{children:[(0,t.jsx)("meta",{property:"og:image",content:"https://ventral.digital"+h.Z.src,className:"jsx-ea2c409626c7be76"}),(0,t.jsx)("meta",{name:"twitter:image",content:"https://ventral.digital"+h.Z.src,className:"jsx-ea2c409626c7be76"})]}),"\n",(0,t.jsxs)(s.p,{children:["This is a Write-Up of RACE-12, Quiz of the ",(0,t.jsx)(s.a,{href:"https://twitter.com/0xRajeev/status/1470910752085065731",children:"Secureum Bootcamp"})," for Ethereum Smart Contract Auditors."]}),"\n",(0,t.jsxs)(a.UW,{type:"info",children:[(0,t.jsxs)(s.p,{children:["I once again had the honor of designing it and gave my best to find something that is both challenging and interesting. I imagine it was very hard to ",(0,t.jsx)(s.strong,{children:"solve all 8 questions within the strict timelimit of 16 minutes"}),", but I recommend you’ll try to see how far you come with using more time before looking at the solutions."]}),(0,t.jsx)(s.p,{children:"As usual, I waited for submissions to close before publishing it and, to stay true to the original, I omitted syntax highlighting. Feel free to copy it into your favorite editor, but do so after starting the timer!"})]}),"\n",(0,t.jsxs)("p",{className:"jsx-ea2c409626c7be76 text-xs text-right",children:["December 6, 2022 by ",(0,t.jsx)(s.a,{href:"/about#patrickd",children:"patrickd"})]}),"\n",(0,t.jsx)(c(),{id:"ea2c409626c7be76",children:"input[type=checkbox].jsx-ea2c409626c7be76{width:15px;height:15px}li.jsx-ea2c409626c7be76{padding:.5em}"}),"\n","\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"code",children:"Code"}),"\n",(0,t.jsx)(a.UW,{type:"info",children:(0,t.jsx)(s.p,{children:"All 8 questions in this RACE are based on the following contracts. You will see them for all the 8 questions in this RACE. The questions are below the shown contracts."})}),"\n",(0,t.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,t.jsxs)(s.code,{"data-line-numbers":"","data-language":"plaintext","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// SPDX-License-Identifier: GPL-3.0"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"pragma solidity 0.8.17;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import "@openzeppelin/contracts/token/ERC20/ERC20.sol";'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import "@openzeppelin/contracts/token/ERC20/extensions/draft-ERC20Permit.sol";'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import "@openzeppelin/contracts/access/AccessControl.sol";'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract TokenV1 is ERC20, AccessControl {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'    bytes32 MIGRATOR_ROLE = keccak256("MIGRATOR_ROLE");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'    constructor() ERC20("Token", "TKN") {'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    // Spec wasn't clear about what 'admin functions' need to be capable of."})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    // Well, this should do the trick."})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    fallback() external {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        if (hasRole(MIGRATOR_ROLE, msg.sender)) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            (bool success, bytes memory data) = msg.sender.delegatecall(msg.data);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'            require(success, "MIGRATION CALL FAILED");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            assembly {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                return(add(data, 32), mload(data))"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"interface IEERC20 is IERC20, IERC20Permit {}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract Vault {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    address public UNDERLYING;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    mapping(address => uint256) public balances;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    constructor(address token)  {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        UNDERLYING = token;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function deposit(uint256 amount) external {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        IEERC20(UNDERLYING).transferFrom(msg.sender, address(this), amount);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        balances[msg.sender] += amount;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function depositWithPermit(address target, uint256 amount, uint256 deadline, uint8 v, bytes32 r, bytes32 s, address to) external {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        IEERC20(UNDERLYING).permit(target, address(this), amount, deadline, v, r, s);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        IEERC20(UNDERLYING).transferFrom(target, address(this), amount);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        balances[to] += amount;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function withdraw(uint256 amount) external {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        IEERC20(UNDERLYING).transfer(msg.sender, amount);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        balances[msg.sender] -= amount;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function sweep(address token) external {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        require(UNDERLYING != token, "can\'t sweep underlying");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        IEERC20(token).transfer(msg.sender, IEERC20(token).balanceOf(address(this)));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"/* ... some time later ... */"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// Adding permit() while maintaining old token balances."})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract TokenV2 {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    address private immutable TOKEN_V1;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    address private immutable PERMIT_MODULE;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    constructor(address _tokenV1)  {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        TOKEN_V1 = _tokenV1;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        PERMIT_MODULE = address(new PermitModule());"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    // Abusing migrations as proxy."})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    fallback() external {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        ("})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            bool success,"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            bytes memory data"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        ) = (address(this) != TOKEN_V1)"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'          ? TOKEN_V1.call(abi.encodePacked(hex"00000000", msg.data, msg.sender))'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"          : PERMIT_MODULE.delegatecall(msg.data[4:]);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        require(success, "FORWARDING CALL FAILED");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        assembly {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            return(add(data, 32), mload(data))"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract PermitModule is TokenV1, ERC20Permit {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'    constructor() TokenV1() ERC20Permit("Token") {}'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function _msgSender() internal view virtual override returns (address) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        if (address(this).code.length == 0) return super._msgSender(); // normal context during construction"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        return address(uint160(bytes20(msg.data[msg.data.length-20:msg.data.length])));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,t.jsx)(s.h3,{id:"question-1-of-8",children:"Question 1 of 8"}),"\n",(0,t.jsx)(s.p,{children:"Sensible gas optimization(s) would be"}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Making ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," state variable ",(0,t.jsx)(s.code,{children:"constant"})," "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Making ",(0,t.jsx)(s.code,{children:"UNDERLYING"})," state variable ",(0,t.jsx)(s.code,{children:"constant"})," "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Making ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," state variable ",(0,t.jsx)(s.code,{children:"immutable"})," "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Making ",(0,t.jsx)(s.code,{children:"UNDERLYING"})," state variable ",(0,t.jsx)(s.code,{children:"immutable"})," "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A, D."})}),(0,t.jsxs)(s.p,{children:["While ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," can be made both ",(0,t.jsx)(s.code,{children:"constant"})," or ",(0,t.jsx)(s.code,{children:"immutable"}),", using ",(0,t.jsx)(s.code,{children:"constant"})," makes the most sense since the value is known during compile time."]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"UNDERLYING"})," on the other hand can only be ",(0,t.jsx)(s.code,{children:"immutable"})," since the value is passed in during the contract's construction."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-2-of-8",children:"Question 2 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["What would a caller with ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," permission be capable of?"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Manipulating ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s storage "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Deleting ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s stored bytecode "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Changing ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s stored bytecode to something different "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. With the current code it's not possible for anyone to have ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," permission "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A, B."})}),(0,t.jsxs)(s.p,{children:["A contract that was given the ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," will be capable of triggering ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s ",(0,t.jsx)(s.code,{children:"fallback"})," function which will delegate-call them back. During this delegate-call, the contract will be capable of manipulating storage as well as self-destructing ",(0,t.jsx)(s.code,{children:"TokenV1"}),"."]}),(0,t.jsxs)(s.p,{children:["Replacing the bytecode would only be possible if ",(0,t.jsx)(s.code,{children:"TokenV1"})," was deployed via ",(0,t.jsx)(s.code,{children:"CREATE2"}),", allowing for a redeployment at the same address with a different bytecode."]}),(0,t.jsxs)(s.p,{children:["The public ",(0,t.jsx)(s.code,{children:"grantRole()"})," function is inherited from ",(0,t.jsx)(s.code,{children:"AccessControl"})," and allows callers with ",(0,t.jsx)(s.code,{children:"DEFAULT_ADMIN_ROLE"})," to grant the ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," to any address."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-3-of-8",children:"Question 3 of 8"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"Vault"})," initialized with ",(0,t.jsx)(s.code,{children:"TokenV1"})," as underlying"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Can be drained by re-entering during withdrawal "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Can be drained during withdrawal due to an integer underflow "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Allows stealing approved tokens due to a phantom (i.e. missing) function "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is C."})}),(0,t.jsxs)(s.p,{children:["A Vault initialized with ",(0,t.jsx)(s.code,{children:"TokenV1"})," offers no opportunity to re-enter although the Checks-Effects-Interactions pattern is not being followed. For this to be exploitable the underlying token itself must either be malicious or implement something akin to receive-hooks like ERC-777."]}),(0,t.jsxs)(s.p,{children:["The fact that a Solidity version >0.8.0 is used without any ",(0,t.jsx)(s.code,{children:"unchecked"})," blocks should prevent any integer over- or underflows from happening."]}),(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"depositWithPermit()"})," function is relying on the call to ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s ",(0,t.jsx)(s.code,{children:"permit()"})," method to revert if it's not implemented or the provided signature is invalid. However, ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s ",(0,t.jsx)(s.code,{children:"fallback()"})," function will make any calls to ",(0,t.jsx)(s.code,{children:"permit()"})," succeed, making ",(0,t.jsx)(s.code,{children:"permit()"}),' a "phantom function". With any calls succeeding an attacker would be able to make deposits using the allowances of other users without the need for a valid signature.']})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-4-of-8",children:"Question 4 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["If ",(0,t.jsx)(s.code,{children:"Vault"})," were to use ",(0,t.jsx)(s.code,{children:"safeTransferFrom"})," instead of ",(0,t.jsx)(s.code,{children:"transferFrom"})," then"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. It would be able to safely support tokens that don't revert on error "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. It would ensure that tokens are only sent to contracts that support handling them "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. It would introduce a re-entrancy vulnerability due to receive hooks "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A."})}),(0,t.jsxs)(s.p,{children:["The way ",(0,t.jsx)(s.code,{children:"Vault"})," is currently implemented, its deployer needs to be careful to not use a token as ",(0,t.jsx)(s.code,{children:"underlying"})," that returns success booleans instead of reverting on error. Using the ",(0,t.jsx)(s.code,{children:"SafeERC20"})," library would add the ",(0,t.jsx)(s.code,{children:"saveTranserFrom()"})," function and allow both kinds of token implementations to be used."]}),(0,t.jsxs)(s.p,{children:['Answers B and C talk about the "save" methods of NFT standards such as ERC721. These would check whether a receiving contract declares supporting them and would also offer an opportunity for re-entrancy via the ',(0,t.jsx)(s.code,{children:"onERC721Received()"})," hook."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-5-of-8",children:"Question 5 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["Who would need the ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," for ",(0,t.jsx)(s.code,{children:"TokenV2"})," to function as intended?"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. The deployer of the ",(0,t.jsx)(s.code,{children:"TokenV2"})," contract "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. The ",(0,t.jsx)(s.code,{children:"TokenV1"})," contract "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. The ",(0,t.jsx)(s.code,{children:"TokenV2"})," contract "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. The ",(0,t.jsx)(s.code,{children:"PermitModule"})," contract "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is C."})}),(0,t.jsxs)(s.p,{children:["The deployer of ",(0,t.jsx)(s.code,{children:"TokenV2"})," would need ",(0,t.jsx)(s.code,{children:"DEFAULT_ADMIN_ROLE"})," for granting it the ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"}),"."]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"TokenV2"})," is the only contract that requires the role since it needs to (ab)use ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s fallback function trigger a delegate-call to the ",(0,t.jsx)(s.code,{children:"PermitModule"}),"'s contract."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-6-of-8",children:"Question 6 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["With ",(0,t.jsx)(s.code,{children:"TokenV2"})," deployed, a ",(0,t.jsx)(s.code,{children:"Vault"})," initialized with ",(0,t.jsx)(s.code,{children:"TokenV1"})," as ",(0,t.jsx)(s.code,{children:"underlying"})]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Is no longer vulnerable in the ",(0,t.jsx)(s.code,{children:"depositWithPermit()"})," function "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Becomes more vulnerable due to a Double-Entry-Point "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Stops functioning because ",(0,t.jsx)(s.code,{children:"TokenV1"})," has been replaced "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is B."})}),(0,t.jsxs)(s.p,{children:["A ",(0,t.jsx)(s.code,{children:"Vault"})," initialized with ",(0,t.jsx)(s.code,{children:"TokenV1"})," will always be vulnerable in the ",(0,t.jsx)(s.code,{children:"depositWithPermit()"})," function. A new ",(0,t.jsx)(s.code,{children:"Vault"})," would need to start using ",(0,t.jsx)(s.code,{children:"TokenV2"})," for the ",(0,t.jsx)(s.code,{children:"depositWithPermit()"})," function to no longer be vulnerable to the ",(0,t.jsx)(s.code,{children:"permit()"}),"-phantom."]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"TokenV2"})," now acts as a Double-Entry-Point for ",(0,t.jsx)(s.code,{children:"TokenV1"})," (and vice versa). This can be exploited via the ",(0,t.jsx)(s.code,{children:"sweep()"})," function which allows rescuing any stuck tokens as long as they are not the underlying token. Sweeping ",(0,t.jsx)(s.code,{children:"TokenV2"})," on a ",(0,t.jsx)(s.code,{children:"Vault"})," using ",(0,t.jsx)(s.code,{children:"TokenV1"})," would effectively drain the ",(0,t.jsx)(s.code,{children:"Vault"}),"."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-7-of-8",children:"Question 7 of 8"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"Vault"})," initialized with ",(0,t.jsx)(s.code,{children:"TokenV2"})," as underlying"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Can be drained by re-entering during withdrawal "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Can be drained during withdrawal due to a integer underflow "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Is not vulnerable in the ",(0,t.jsx)(s.code,{children:"depositWithPermit()"})," function "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Is vulnerable due to a Double-Entry-Point "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is C, D."})}),(0,t.jsxs)(s.p,{children:["Answers A and B haven't changed from Question 3 with the introduction of ",(0,t.jsx)(s.code,{children:"TokenV2"}),"."]}),(0,t.jsxs)(s.p,{children:["In ",(0,t.jsx)(s.code,{children:"TokenV2"})," calling the ",(0,t.jsx)(s.code,{children:"permit()"})," function will no longer call the ",(0,t.jsx)(s.code,{children:"fallback"})," but its actual implementation from ERC20Permit. Therefore a ",(0,t.jsx)(s.code,{children:"Vault"})," with ",(0,t.jsx)(s.code,{children:"TokenV2"})," will no longer be vulnerable to the ",(0,t.jsx)(s.code,{children:"permit()"}),"-phantom."]}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"TokenV1"})," acts as a Double-Entry-Point for ",(0,t.jsx)(s.code,{children:"TokenV2"})," (and vice versa). This can be exploited via the ",(0,t.jsx)(s.code,{children:"sweep()"})," function which allows rescuing any stuck tokens as long as they are not the underlying token. Sweeping ",(0,t.jsx)(s.code,{children:"TokenV1"})," on a ",(0,t.jsx)(s.code,{children:"Vault"})," using ",(0,t.jsx)(s.code,{children:"TokenV2"})," would effectively drain the ",(0,t.jsx)(s.code,{children:"Vault"}),"."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-8-of-8",children:"Question 8 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"PermitModule"})," contract"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Acts as a proxy "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Acts as an implementation "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Allows anyone to manipulate ",(0,t.jsx)(s.code,{children:"TokenV2"}),"'s ",(0,t.jsx)(s.code,{children:"balances"})," "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Can be self-destructed by anyone "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is B, D."})}),(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"TokenV2"})," will forward delegate-calls made from ",(0,t.jsx)(s.code,{children:"TokenV2"})," to the ",(0,t.jsx)(s.code,{children:"PermitModule"})," contract. Effectively ",(0,t.jsx)(s.code,{children:"TokenV2"})," abuses the migration logic in ",(0,t.jsx)(s.code,{children:"TokenV1"})," turning it into a proxy while ",(0,t.jsx)(s.code,{children:"PermitModule"})," acts like the implementation."]}),(0,t.jsxs)(s.p,{children:["The way that ",(0,t.jsx)(s.code,{children:"Context"}),"'s ",(0,t.jsx)(s.code,{children:"_msgSender()"})," function has been overridden, it allows any caller to arbitrarily set what is expected to be the ",(0,t.jsx)(s.code,{children:"msg.sender"}),". By crafting a call with ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s address appended they will gain the ",(0,t.jsx)(s.code,{children:"DEFAULT_ADMIN_ROLE"}),". With that, they can grant themselves the ",(0,t.jsx)(s.code,{children:"MIGRATOR_ROLE"})," and make ",(0,t.jsx)(s.code,{children:"PermitModule"})," delegate-call back. Since all token balances are stored at ",(0,t.jsx)(s.code,{children:"TokenV1"}),"'s address this will not allow for a manipulation of any real balances. But it would allow delegate-calling to a contract that'll execute a self-destruct."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n","\n",(0,t.jsxs)(a.oy,{children:[(0,t.jsx)(a.Zb,{icon:(0,t.jsx)(x.H8,{}),title:"← RACE #11 Of The Secureum Bootcamp Epoch∞",href:"/posts/2022/10/31/race-11-of-the-secureum-bootcamp-epoch/"}),(0,t.jsx)(a.Zb,{icon:(0,t.jsx)(x.H8,{}),title:"RACE #13 Of The Secureum Bootcamp Epoch∞ →",href:"/posts/2023/1/3/race-13-of-the-secureum-bootcamp-epoch"})]})]})}s.default=(0,l.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,r.a)(),e.components);return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/2022/12/6/race-12-of-the-secureum-bootcamp-epoch.mdx",route:"/posts/2022/12/6/race-12-of-the-secureum-bootcamp-epoch",timestamp:1731290394e3,title:"RACE #12 Of The Secureum Bootcamp Epoch∞",headings:u},pageNextRoute:"/posts/2022/12/6/race-12-of-the-secureum-bootcamp-epoch"})},96139:function(e,s,n){var t=n(94869);n(26228);var i=n(70079),c=i&&"object"==typeof i&&"default"in i?i:{default:i};function _defineProperties(e,s){for(var n=0;n<s.length;n++){var t=s[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var l=void 0!==t&&t.env&&!0,isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},r=function(){function StyleSheet(e){var s=void 0===e?{}:e,n=s.name,t=void 0===n?"stylesheet":n,i=s.optimizeForSpeed,c=void 0===i?l:i;invariant$1(isString(t),"`name` must be a string"),this._name=t,this._deletedRulePlaceholder="#"+t+"-deleted-rule____{}",invariant$1("boolean"==typeof c,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=c,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var r=document.querySelector('meta[property="csp-nonce"]');this._nonce=r?r.getAttribute("content"):null}var e,s=StyleSheet.prototype;return s.setOptimizeForSpeed=function(e){invariant$1("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),invariant$1(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(invariant$1(!this._injected,"sheet already injected"),this._injected=!0,this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(l||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(s,n){return"number"==typeof n?e._serverSheet.cssRules[n]={cssText:s}:e._serverSheet.cssRules.push({cssText:s}),n},deleteRule:function(s){e._serverSheet.cssRules[s]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].ownerNode===e)return document.styleSheets[s]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,s){if(invariant$1(isString(e),"`insertRule` accepts only strings"),this._optimizeForSpeed){var n=this.getSheet();"number"!=typeof s&&(s=n.cssRules.length);try{n.insertRule(e,s)}catch(s){return l||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var t=this._tags[s];this._tags.push(this.makeStyleTag(this._name,e,t))}return this._rulesCount++},s.replaceRule=function(e,s){if(this._optimizeForSpeed){var n=this.getSheet();if(s.trim()||(s=this._deletedRulePlaceholder),!n.cssRules[e])return e;n.deleteRule(e);try{n.insertRule(s,e)}catch(t){l||console.warn("StyleSheet: illegal rule: \n\n"+s+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),n.insertRule(this._deletedRulePlaceholder,e)}}else{var t=this._tags[e];invariant$1(t,"old rule at index `"+e+"` not found"),t.textContent=s}return e},s.deleteRule=function(e){if(this._optimizeForSpeed)this.replaceRule(e,"");else{var s=this._tags[e];invariant$1(s,"rule at index `"+e+"` not found"),s.parentNode.removeChild(s),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]},s.cssRules=function(){var e=this;return this._tags.reduce(function(s,n){return n?s=s.concat(Array.prototype.map.call(e.getSheetForTag(n).cssRules,function(s){return s.cssText===e._deletedRulePlaceholder?null:s})):s.push(null),s},[])},s.makeStyleTag=function(e,s,n){s&&invariant$1(isString(s),"makeStyleTag accepts only strings as second parameter");var t=document.createElement("style");this._nonce&&t.setAttribute("nonce",this._nonce),t.type="text/css",t.setAttribute("data-"+e,""),s&&t.appendChild(document.createTextNode(s));var i=document.head||document.getElementsByTagName("head")[0];return n?i.insertBefore(t,n):i.appendChild(t),t},_defineProperties(StyleSheet.prototype,[{key:"length",get:function(){return this._rulesCount}}]),e&&_defineProperties(StyleSheet,e),StyleSheet}();function invariant$1(e,s){if(!e)throw Error("StyleSheet: "+s+".")}var stringHash=function(e){for(var s=5381,n=e.length;n;)s=33*s^e.charCodeAt(--n);return s>>>0},a={};function computeId(e,s){if(!s)return"jsx-"+e;var n=String(s),t=e+n;return a[t]||(a[t]="jsx-"+stringHash(e+"-"+n)),a[t]}function computeSelector(e,s){var n=e+s;return a[n]||(a[n]=s.replace(/__jsx-style-dynamic-selector/g,e)),a[n]}var o=function(){function StyleSheetRegistry(e){var s=void 0===e?{}:e,n=s.styleSheet,t=void 0===n?null:n,i=s.optimizeForSpeed,c=void 0!==i&&i;this._sheet=t||new r({name:"styled-jsx",optimizeForSpeed:c}),this._sheet.inject(),t&&"boolean"==typeof c&&(this._sheet.setOptimizeForSpeed(c),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var e=StyleSheetRegistry.prototype;return e.add=function(e){var s=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,s){return e[s]=0,e},{}));var n=this.getIdAndRules(e),t=n.styleId,i=n.rules;if(t in this._instancesCounts){this._instancesCounts[t]+=1;return}var c=i.map(function(e){return s._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[t]=c,this._instancesCounts[t]=1},e.remove=function(e){var s=this,n=this.getIdAndRules(e).styleId;if(function(e,s){if(!e)throw Error("StyleSheetRegistry: "+s+".")}(n in this._instancesCounts,"styleId: `"+n+"` not found"),this._instancesCounts[n]-=1,this._instancesCounts[n]<1){var t=this._fromServer&&this._fromServer[n];t?(t.parentNode.removeChild(t),delete this._fromServer[n]):(this._indices[n].forEach(function(e){return s._sheet.deleteRule(e)}),delete this._indices[n]),delete this._instancesCounts[n]}},e.update=function(e,s){this.add(s),this.remove(e)},e.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},e.cssRules=function(){var e=this,s=this._fromServer?Object.keys(this._fromServer).map(function(s){return[s,e._fromServer[s]]}):[],n=this._sheet.cssRules();return s.concat(Object.keys(this._indices).map(function(s){return[s,e._indices[s].map(function(e){return n[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},e.styles=function(e){var s,n;return s=this.cssRules(),void 0===(n=e)&&(n={}),s.map(function(e){var s=e[0],t=e[1];return c.default.createElement("style",{id:"__"+s,key:"__"+s,nonce:n.nonce?n.nonce:void 0,dangerouslySetInnerHTML:{__html:t}})})},e.getIdAndRules=function(e){var s=e.children,n=e.dynamic,t=e.id;if(n){var i=computeId(t,n);return{styleId:i,rules:Array.isArray(s)?s.map(function(e){return computeSelector(i,e)}):[computeSelector(i,s)]}}return{styleId:computeId(t),rules:Array.isArray(s)?s:[s]}},e.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,s){return e[s.id.slice(2)]=s,e},{})},StyleSheetRegistry}(),d=i.createContext(null);d.displayName="StyleSheetContext";var h=c.default.useInsertionEffect||c.default.useLayoutEffect,x=new o;function JSXStyle(e){var s=x||i.useContext(d);return s&&h(function(){return s.add(e),function(){s.remove(e)}},[e.id,String(e.dynamic)]),null}JSXStyle.dynamic=function(e){return e.map(function(e){return computeId(e[0],e[1])}).join(" ")},s.style=JSXStyle},65910:function(e,s,n){"use strict";e.exports=n(96139).style},26228:function(){}},function(e){e.O(0,[3220,1589,9774,2888,179],function(){return e(e.s=56057)}),_N_E=e.O()}]);