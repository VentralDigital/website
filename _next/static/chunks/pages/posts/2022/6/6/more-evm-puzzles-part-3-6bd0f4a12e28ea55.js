(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4394],{90653:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2022/6/6/more-evm-puzzles-part-3",function(){return l(17263)}])},17263:function(e,s,l){"use strict";l.r(s),l.d(s,{__toc:function(){return c}});var n=l(35250),a=l(47147),i=l(77298),t=l(18363),r=l(13423);let c=[{depth:2,value:"Puzzle #5",id:"puzzle-5"},{depth:2,value:"Puzzle #6",id:"puzzle-6"},{depth:2,value:"Puzzle #7",id:"puzzle-7"}];function _createMdxContent(e){let s=Object.assign({h1:"h1",a:"a",p:"p",h2:"h2",pre:"pre",code:"code",span:"span",hr:"hr"},(0,i.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{children:"More EVM Puzzles - Part 3"}),"\n",(0,n.jsxs)("p",{className:"text-xs text-right",children:["June 6, 2022 by ",(0,n.jsx)(s.a,{href:"/about#patrickd",children:"patrickd"})]}),"\n",(0,n.jsxs)(s.p,{children:["This continues the series on ",(0,n.jsx)(s.a,{href:"https://twitter.com/DaltonSweeney9",children:"Dalton Sweeney"}),"'s ",(0,n.jsx)(s.a,{href:"https://github.com/daltyboy11/more-evm-puzzles",children:'"10 more EVM puzzles"'})," collection. If this is all new to you, you should probably check out ",(0,n.jsx)(s.a,{href:"/posts/2022/5/24/more-evm-puzzles-part-1",children:"Part 1"})," first."]}),"\n",(0,n.jsx)(s.h2,{id:"puzzle-5",children:"Puzzle #5"}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"plaintext","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"00      6020      PUSH1 20"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"02      36        CALLDATASIZE"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"03      11        GT"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"04      6008      PUSH1 08"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"06      57        JUMPI"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"07      FD        REVERT"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"08      5B        JUMPDEST"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"09      36        CALLDATASIZE"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0A      6000      PUSH1 00"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0C      6000      PUSH1 00"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0E      37        CALLDATACOPY"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0F      36        CALLDATASIZE"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"10      59        MSIZE"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"11      03        SUB"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"12      6003      PUSH1 03"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"14      14        EQ"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"15      6019      PUSH1 19"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"17      57        JUMPI"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"18      FD        REVERT"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"19      5B        JUMPDEST"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1A      00        STOP"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"? Enter the calldata:"})})]})}),"\n",(0,n.jsxs)(s.p,{children:["This one starts easy: The calldata we send must be longer than 32 (",(0,n.jsx)(s.code,{children:"0x20"}),") bytes for the first ",(0,n.jsx)(s.code,{children:"JUMPI"})," to succeed. Then all of the calldata is copied to memory at offset ",(0,n.jsx)(s.code,{children:"0x0"}),". Then ",(0,n.jsx)(s.code,{children:"CALLDATASIZE"})," is subtracted from ",(0,n.jsx)(s.code,{children:"MSIZE"})," and the result of this subtraction must be 3 for the final jump to succeed as well."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://www.evm.codes/#59",children:"evm.codes"})," tells us that ",(0,n.jsx)(s.code,{children:"MSIZE"}),' returns "the size of active memory in bytes". But there\'s an important detail: "The size is always a multiple of a word (32 bytes)". So even if we only sent 33 bytes as calldata which were copied to memory, ',(0,n.jsx)(s.code,{children:"MSIZE"})," would instead return 64 as value."]}),"\n",(0,n.jsx)(s.p,{children:"This also means the solution is quite simple: Sending 61 bytes will yield a difference of 3 from the subtraction and is also of a greater size than 32 to make the first jump."}),"\n",(0,n.jsx)(s.pre,{"data-language":"text","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"text","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"? Enter the calldata: 0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Puzzle solved!"})})]})}),"\n",(0,n.jsx)(s.p,{children:"Knowing this little fact on how memory expansion works in the EVM made solving this puzzle quite easy."}),"\n",(0,n.jsx)(s.h2,{id:"puzzle-6",children:"Puzzle #6"}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"plaintext","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"00      7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0      PUSH32 FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"21      34                                                                      CALLVALUE"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"22      01                                                                      ADD"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"23      6001                                                                    PUSH1 01"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"25      14                                                                      EQ"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"26      602A                                                                    PUSH1 2A"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"28      57                                                                      JUMPI"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"29      FD                                                                      REVERT"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"2A      5B                                                                      JUMPDEST"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"2B      00                                                                      STOP"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"? Enter the value to send:"})})]})}),"\n",(0,n.jsx)(s.p,{children:'Seems like the "gimmick" on this one is integer overflows. Right at the beginning, a really large number is pushed onto the stack, so large in fact that just adding 16 will make it overflow and flip to 0. But for the jump condition to succeed it needs to be a 1 - so we need to send 17!'}),"\n",(0,n.jsx)(s.pre,{"data-language":"text","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"text","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"? Enter the value to send: 17"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Puzzle solved!"})})]})}),"\n",(0,n.jsx)(s.h2,{id:"puzzle-7",children:"Puzzle #7"}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"plaintext","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"00      5A        GAS"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"01      34        CALLVALUE"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"02      5B        JUMPDEST"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"03      6001      PUSH1 01"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"05      90        SWAP1"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"06      03        SUB"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"07      80        DUP1"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"08      6000      PUSH1 00"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0A      14        EQ"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0B      6011      PUSH1 11"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0D      57        JUMPI"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0E      6002      PUSH1 02"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"10      56        JUMP"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"11      5B        JUMPDEST"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"12      5A        GAS"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"13      90        SWAP1"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"14      91        SWAP2"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"15      03        SUB"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"16      60A6      PUSH1 A6"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"18      14        EQ"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"19      601D      PUSH1 1D"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1B      57        JUMPI"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1C      FD        REVERT"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1D      5B        JUMPDEST"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1E      00        STOP"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"? Enter the value to send:"})})]})}),"\n",(0,n.jsxs)(s.p,{children:["This one's got a loop! Right after pushing the initial amount of ",(0,n.jsx)(s.code,{children:"GAS"})," onto the stack, we enter the first loop:"]}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"plaintext","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"# It gets the call value and subtracts 1 from it."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"01      34        CALLVALUE"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"02      5B        JUMPDEST"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"03      6001      PUSH1 01"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"05      90        SWAP1"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"06      03        SUB"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"# It duplicates the result of the subtraction for the next loop round (instead of using call value again)."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"07      80        DUP1"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"# If the result of the subtraction was zero we exit the loop."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"08      6000      PUSH1 00"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0A      14        EQ"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0B      6011      PUSH1 11"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0D      57        JUMPI"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"# If not, we keep looping."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0E      6002      PUSH1 02"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"10      56        JUMP"})})]})}),"\n",(0,n.jsx)(s.p,{children:"If we'd send a value of 0 it would end up looping until it runs out of gas, because the integer will underflow resulting in the largest possible number to count down from. But as long as we send any value that ensures we have enough gas left at the end of the loop, we should be fine. If we'd for example send a 1 as a value, the result of the subtraction would immediately yield a 0 and it would never loop to begin with. Sending a 2 would loop exactly once and then exit, and so on.."}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"plaintext","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"00      5A        GAS            [initialGas]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"...                              [0, initialGas]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"12      5A        GAS            [gasAfterLoop, 0, initialGas]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"13      90        SWAP1          [0, gasAfterLoop, initialGas]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"14      91        SWAP2          [initialGas, gasAfterLoop, 0]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"15      03        SUB            [initialGas-gasAfterLoop, 0]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"16      60A6      PUSH1 A6       [0xa6, initialGas-gasAfterLoop, 0]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"18      14        EQ             [0xa6==initialGas-gasAfterLoop, 0]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"19      601D      PUSH1 1D       [0x1d, 0xa6==initialGas-gasAfterLoop, 0]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1B      57        JUMPI          [0]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1C      FD        REVERT"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1D      5B        JUMPDEST       [0]"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1E      00        STOP           [0]"})})]})}),"\n",(0,n.jsxs)(s.p,{children:["Immediately after the loop it pushes the now still left gas onto the stack again. You can also see that the final value from the loop, which will always be 0, is still left on the stack even though it's never used again, which is why there are a bunch of confusing swaps happening. But all that's actually being done here is determining the gas that was consumed during the loop by subtracting the second ",(0,n.jsx)(s.code,{children:"GAS"})," instruction's value from the first one. The result of this subtraction is then compared with ",(0,n.jsx)(s.code,{children:"0xA6"}),", or 166 in decimal."]}),"\n",(0,n.jsxs)(s.p,{children:["In summary: We have to send a transaction ",(0,n.jsx)(s.code,{children:"value"})," that'll cause the loop to consume exactly 166 gas."]}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"plaintext","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"00      5A        GAS           2gas  │"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"01      34        CALLVALUE     2gas  │"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"02      5B        JUMPDEST      1gas  ┢━<━┓"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"03      6001      PUSH1 01      3gas  ┃   ┃"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"05      90        SWAP1         3gas  ┃   ┃"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"06      03        SUB           3gas  ┃   ┃"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"07      80        DUP1          3gas  ┃   ┃"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"08      6000      PUSH1 00      3gas  ┃   ┃"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0A      14        EQ            3gas  ┃   ┃"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0B      6011      PUSH1 11      3gas  ┃   ┃"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0D      57        JUMPI        10gas  ┠──────┐"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"0E      6002      PUSH1 02      3gas  ┃   ┃  │"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"10      56        JUMP          8gas  ┗━>━┛  │"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"11      5B        JUMPDEST      1gas  <──────┘"})})]})}),"\n",(0,n.jsx)(s.p,{children:"The instructions around the loop will consume 5gas while a normal loop execution will cost 43gas. The final loop skips a few instructions, pricing it at 32gas."}),"\n",(0,n.jsxs)(s.p,{children:["So what we have to determine is the ",(0,n.jsx)(s.code,{children:"CALLVALUE"})," we have to send for ",(0,n.jsx)(s.code,{children:"5 + 43*(CALLVALUE-1) + 32 = 166"}),", which is 4."]}),"\n",(0,n.jsx)(s.pre,{"data-language":"text","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-language":"text","data-theme":"default",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"? Enter the value to send: 4"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Puzzle solved!"})})]})}),"\n",(0,n.jsx)(s.p,{children:"It should be noted though that gas prices for instructions aren't completely fixed. Their cost might change in the future which would likely break this puzzle."}),"\n",(0,n.jsx)(s.hr,{}),"\n","\n",(0,n.jsxs)(t.oy,{children:[(0,n.jsx)(t.Zb,{icon:(0,n.jsx)(r.aA,{}),title:"← More EVM Puzzles - Part 2",href:"/posts/2022/5/26/more-evm-puzzles-part-2/"}),(0,n.jsx)(t.Zb,{icon:(0,n.jsx)(r.aA,{}),title:"More EVM Puzzles - Part 4 →",href:"/posts/2022/6/7/more-evm-puzzles-part-4/"})]})]})}s.default=(0,a.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.a)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/2022/6/6/more-evm-puzzles-part-3.mdx",route:"/posts/2022/6/6/more-evm-puzzles-part-3",timestamp:1702204664e3,title:"More EVM Puzzles - Part 3",headings:c},pageNextRoute:"/posts/2022/6/6/more-evm-puzzles-part-3"})}},function(e){e.O(0,[3220,1589,9774,2888,179],function(){return e(e.s=90653)}),_N_E=e.O()}]);