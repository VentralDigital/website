(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9408],{78091:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2022/8/29/secureum-bootcamp-epoch-august-race-9",function(){return t(63293)}])},64751:function(e,s){"use strict";s.Z={src:"/_next/static/media/secureum-banner.b3ad8557.jpg",height:630,width:1200,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAEAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAbEAACAgMBAAAAAAAAAAAAAAAAAgEDBCEyE//EABUBAQEAAAAAAAAAAAAAAAAAAAQF/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAwDAQACEQMRAD8AnGFcviyPjUWS1PTJuOtgAcT9auj/2Q==",blurWidth:8,blurHeight:4}},63293:function(e,s,t){"use strict";t.r(s),t.d(s,{HiddenSolution:function(){return HiddenSolution},__toc:function(){return u}});var n=t(35250),i=t(65910),c=t.n(i),a=t(47147),r=t(77298),o=t(18363),l=t(30746),h=t.n(l),d=t(64751),x=t(13423);function HiddenSolution(e){let{children:s}=e,t=Object.assign({details:"details",summary:"summary",strong:"strong",div:"div"},(0,r.a)());return(0,n.jsxs)(t.details,{closed:!0,className:"last-of-type:mb-0 rounded-lg bg-neutral-50 dark:bg-neutral-800 p-2 mt-4",children:[(0,n.jsx)(t.summary,{children:(0,n.jsx)(t.strong,{className:"text-lg",children:"Solution"})}),(0,n.jsx)(t.div,{className:"nx-p-2",children:s})]})}let u=[{depth:3,value:"Code",id:"code"},{depth:3,value:"Question 1 of 8",id:"question-1-of-8"},{depth:3,value:"Question 2 of 8",id:"question-2-of-8"},{depth:3,value:"Question 3 of 8",id:"question-3-of-8"},{depth:3,value:"Question 4 of 8",id:"question-4-of-8"},{depth:3,value:"Question 5 of 8",id:"question-5-of-8"},{depth:3,value:"Question 6 of 8",id:"question-6-of-8"},{depth:3,value:"Question 7 of 8",id:"question-7-of-8"},{depth:3,value:"Question 8 of 8",id:"question-8-of-8"}];function _createMdxContent(e){let s=Object.assign({h1:"h1",p:"p",a:"a",em:"em",hr:"hr",h3:"h3",pre:"pre",code:"code",span:"span",strong:"strong"},(0,r.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{children:"Secureum Bootcamp Epoch∞ - August RACE #9"}),"\n","\n",(0,n.jsxs)(h(),{children:[(0,n.jsx)("meta",{property:"og:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"}),(0,n.jsx)("meta",{name:"twitter:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"})]}),"\n",(0,n.jsxs)(s.p,{children:["This is a write-up of the ",(0,n.jsx)(s.a,{href:"https://twitter.com/0xRajeev/status/1470910752085065731",children:"Secureum Bootcamp Race 9 Quiz of Epoch Infinity"})," with solutions."]}),"\n",(0,n.jsxs)(o.UW,{type:"info",children:[(0,n.jsxs)(s.p,{children:["This quiz had a strict time limit of 16 minutes for 8 questions, no pause. Choose all and ",(0,n.jsx)(s.em,{children:"only"})," correct answers."]}),(0,n.jsx)(s.p,{children:"Syntax highlighting was omitted since the original quiz did not have any either."})]}),"\n",(0,n.jsxs)("p",{className:"jsx-ea2c409626c7be76 text-xs text-right",children:["August 31, 2022 by ",(0,n.jsx)(s.a,{href:"/about#patrickd",children:"patrickd"})]}),"\n",(0,n.jsx)(c(),{id:"ea2c409626c7be76",children:"input[type=checkbox].jsx-ea2c409626c7be76{width:15px;height:15px}li.jsx-ea2c409626c7be76{padding:.5em}"}),"\n","\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"code",children:"Code"}),"\n",(0,n.jsx)(o.UW,{type:"info",children:(0,n.jsx)(s.p,{children:"All 8 questions in this RACE are based on the following contracts. You will see them for all the 8 questions in this RACE. The questions are below the shown contracts."})}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-line-numbers":"","data-language":"plaintext","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"pragma solidity 0.8.7;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import "@openzeppelin/contracts/access/Ownable.sol";'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// Assume the Proxy contract was deployed and no further transactions were made afterwards."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract Mastercopy is Ownable {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    int256 public counter = 0;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function increase() public onlyOwner returns (int256) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        return ++counter;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function decrease() public onlyOwner returns (int256) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        return --counter;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract Proxy is Ownable {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    mapping(bytes4 => address) public implementations;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    constructor() {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        Mastercopy mastercopy = new Mastercopy();"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        implementations[bytes4(keccak256(bytes("counter()")))] = address(mastercopy);'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        implementations[Mastercopy.increase.selector] = address(mastercopy);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        implementations[Mastercopy.increase.selector] = address(mastercopy);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    fallback() external payable {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        address implementation = implementations[msg.sig];"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        assembly {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            // Copied without changes to the logic from OpenZeppelin's Proxy contract."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            calldatacopy(0, 0, calldatasize())"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            let result := delegatecall(gas(), implementation, 0, calldatasize(), 0, 0)"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            returndatacopy(0, 0, returndatasize())"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            switch result"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                case 0 {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                    revert(0, returndatasize())"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                default {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                    return(0, returndatasize())"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function setImplementationForSelector(bytes4 signature, address implementation) external onlyOwner {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        implementations[signature] = implementation;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(s.h3,{id:"question-1-of-8",children:"Question 1 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["The function signature is the first 4 bytes of the ",(0,n.jsx)(s.em,{children:"keccak"})," hash which"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Includes the function name "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Includes a comma separated list of parameter types "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Includes a comma separated list of return value types "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Is generated only for ",(0,n.jsx)(s.code,{children:"public"})," and ",(0,n.jsx)(s.code,{children:"external"})," functions "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is A, B, D."})}),(0,n.jsxs)(s.p,{children:["A function's signature is created by hashing its name and a comma separated list (no spaces) of the types of all its parameters. For example: ",(0,n.jsx)(s.span,{"data-rehype-pretty-code-fragment":"",children:(0,n.jsx)(s.code,{"data-language":"solidity","data-theme":"default",children:(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"add"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]})})}),"."]}),(0,n.jsxs)(s.p,{children:["The fact that the return value type isn't part of the signature is basically given away by the fact that the creation of the ",(0,n.jsx)(s.code,{children:"counter()"})," function's signature doesn't mention ",(0,n.jsx)(s.code,{children:"int256"}),"."]}),(0,n.jsxs)(s.p,{children:["Since it's used for calling external and public functions of a contract, only these functions need a signature to be called by. Internal and private functions can only be directly ",(0,n.jsx)(s.code,{children:"JUMP"}),"ed to within the bytecode of the contract that contains them."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-2-of-8",children:"Question 2 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"Proxy"})," contract is most similar to a"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. UUPS Proxy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Beacon Proxy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Transparent Proxy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Metamorphic Proxy "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is C."})}),(0,n.jsxs)(s.p,{children:["A UUPS (or Universal Upgradeable Proxy Standard) would have it's upgradeability logic within the implementation which ensures there won't be function signature clashes. This is not the case here with the ",(0,n.jsx)(s.code,{children:"setImplementationForSelector()"})," function being part of the Proxy."]}),(0,n.jsx)(s.p,{children:"A Beacon Proxy would ask another contract where it can find the implementation, this isn't the case here since the implementation address is managed and stored in the Proxy contract itself."}),(0,n.jsx)(s.p,{children:"This makes it most similar to a Transparent Proxy."}),(0,n.jsx)(s.p,{children:'A "Metamorphic" Proxy isn\'t really a thing. Contracts referred to being metamorphic usually achieve upgradeability not thanks to a proxy, but due to the fact that they can be re-deployed to the same address via CREATE2.'})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-3-of-8",children:"Question 3 of 8"}),"\n",(0,n.jsx)(s.p,{children:"Gas will be saved with the following changes"}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Skipping initialization of ",(0,n.jsx)(s.code,{children:"counter"})," variable "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Making ",(0,n.jsx)(s.code,{children:"increase()"})," function external to avoid copying from ",(0,n.jsx)(s.code,{children:"calldata"})," to ",(0,n.jsx)(s.code,{children:"memory"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Packing multiple implementation addresses into the same storage slot "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Moving the calculation of the ",(0,n.jsx)(s.code,{children:"counter()"})," function's signature hash to a constant "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is A."})}),(0,n.jsx)(s.p,{children:"Avoiding initialization of state variables to zero can indeed save gas and are usually not necessary when deploying contracts to fresh addresses where all state variables will be zero-initialized by default."}),(0,n.jsxs)(s.p,{children:["If initialization in the ",(0,n.jsx)(s.code,{children:"Mastercopy"})," contract would attempt setting a value different from 0 it wouldn't even have any effect, since it's not setting this value in the Proxy's state - this would be considered a bug."]}),(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"increase()"})," function does not have any function parameters that are being copied from calldata to memory. Introducing this change would have no effect."]}),(0,n.jsx)(s.p,{children:"Addresses are too large (20 bytes) for multiple of them to be packed into a single storage slot (32 bytes)."}),(0,n.jsx)(s.p,{children:'Constants are basically placeholders in the bytecode for expressions that are filled during compile time. It would not make a difference whether the compiler fills them or whether we\'ve already "filled" them by hand. It might however improve readability to do so.'})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-4-of-8",children:"Question 4 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["Calling the ",(0,n.jsx)(s.code,{children:"increase()"})," function on the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract will"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Will revert since the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract has no ",(0,n.jsx)(s.code,{children:"increase()"})," function "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Will revert for any other caller than the one that deployed the ",(0,n.jsx)(s.code,{children:"Proxy"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Increases the integer value in the ",(0,n.jsx)(s.code,{children:"Proxy"}),"'s storage slot located at index 1 "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Delegate-call to the zero-address "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is B, C."})}),(0,n.jsxs)(s.p,{children:["When the ",(0,n.jsx)(s.code,{children:"Proxy"})," is called with the function signature for ",(0,n.jsx)(s.code,{children:"increase()"}),", Solidity will call the ",(0,n.jsx)(s.code,{children:"fallback()"})," function since the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract itself does not have a function with a matching signature."]}),(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"fallback()"})," function will determine that, for this signature, it has stored the mastercontract's address as an implementation and will delegate-call it."]}),(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"Mastercontract"}),"'s code will be execute in the context of the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract, meaning that the state being manipulated by the ",(0,n.jsx)(s.code,{children:"Mastercontract"}),"'s code is that of the ",(0,n.jsx)(s.code,{children:"Proxy"}),"."]}),(0,n.jsxs)(s.p,{children:["The function-selection logic of the ",(0,n.jsx)(s.code,{children:"Mastercontract"})," will find that it indeed has a matching function signature belonging to ",(0,n.jsx)(s.code,{children:"increase()"})," and will execute it."]}),(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"increase()"})," function will increment the value of the counter state variable by one, who's index is at 1 because the first index is already reserved by ",(0,n.jsx)(s.code,{children:"Ownable"}),"'s ",(0,n.jsx)(s.code,{children:"owner"})," state variable."]}),(0,n.jsxs)(s.p,{children:["This means that whatever value is currently located at the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract's storage slot with index 1 will be increased by one even if there's no variable called counter in the ",(0,n.jsx)(s.code,{children:"Proxy"})," itself."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-5-of-8",children:"Question 5 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["Calling the ",(0,n.jsx)(s.code,{children:"decrease()"})," function on the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract will"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Will revert because it was not correctly registered on the proxy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Will succeed and return the value of ",(0,n.jsx)(s.code,{children:"counter"})," after it was decreased "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Will succeed and return the value of ",(0,n.jsx)(s.code,{children:"counter"})," before it was decreased "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Will succeed and return nothing "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is D."})}),(0,n.jsxs)(s.p,{children:["When checking for the implementation address of the ",(0,n.jsx)(s.code,{children:"decrease()"})," function's signature, the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract won't find one since it wasn't registered in the constructor like the ",(0,n.jsx)(s.code,{children:"increase()"})," function was."]}),(0,n.jsx)(s.p,{children:"But that doesn't mean it'll revert, it'll instead get the default state value: The zero address."}),(0,n.jsxs)(s.p,{children:["Since no check is made to prevent ",(0,n.jsx)(s.em,{children:"calls"})," when no matching signature is found in the ",(0,n.jsx)(s.code,{children:"implementations"})," mapping, a ",(0,n.jsx)(s.em,{children:"delegate-call"})," will be made to the zero address, and like all calls that are made to addresses that do not have runtime bytecode, this call will succeed without returning anything."]}),(0,n.jsxs)(s.p,{children:["The EVM implicitly assumes that all bytecode ends with the ",(0,n.jsx)(s.code,{children:"STOP"})," opcode, even if the ",(0,n.jsx)(s.code,{children:"STOP"})," opcode isn't explicitly mentioned in the bytecode itself. So to the EVM an empty bytecode actually always contains one opcode: ",(0,n.jsx)(s.code,{children:"STOP"})," - the opcode for stopping execution without errors."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-6-of-8",children:"Question 6 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["Due to a storage clash between the ",(0,n.jsx)(s.code,{children:"Proxy"})," and the ",(0,n.jsx)(s.code,{children:"Mastercopy"})," contracts"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. The Proxy's ",(0,n.jsx)(s.code,{children:"implementations"})," would be overwritten by 0 during initialization of the Mastercopy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. The Proxy's ",(0,n.jsx)(s.code,{children:"implementations"})," would be overwritten when the counter variable changes "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. The Proxy's ",(0,n.jsx)(s.code,{children:"implementations"})," variable's storage slot being overwritten causes a DoS "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is D."})}),(0,n.jsx)(s.p,{children:"Mappings leave their assigned storage slot unused. The actual values of a mapping are stored at location's determined by hashing the mapping slot's index with the key."}),(0,n.jsxs)(s.p,{children:["That means that, even though the Proxy's ",(0,n.jsx)(s.code,{children:"implementations"})," and the Mastercopy's ",(0,n.jsx)(s.code,{children:"counter"})," variables make use of the same slot, they actually do not interfere with each other and nothing will happen when ",(0,n.jsx)(s.code,{children:"counter"}),"'s value changes."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-7-of-8",children:"Question 7 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"Proxy"})," contract"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Won't be able to receive any ether when ",(0,n.jsx)(s.code,{children:"calldatasize"})," is 0 due to a missing ",(0,n.jsx)(s.code,{children:"receive()"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Will be the owner of the ",(0,n.jsx)(s.code,{children:"Mastercopy"})," contract "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Has a storage clash in slot 0 which will cause issues with the current mastercopy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is B."})}),(0,n.jsxs)(s.p,{children:["Thanks to its payable ",(0,n.jsx)(s.code,{children:"fallback()"})," function it'll still be able to receive ether without issues."]}),(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"Ownable"})," always initializes the owner with the ",(0,n.jsx)(s.code,{children:"msg.sender"}),". When the ",(0,n.jsx)(s.code,{children:"Proxy"})," deploys the ",(0,n.jsx)(s.code,{children:"Mastercopy"})," contract, the ",(0,n.jsx)(s.code,{children:"Proxy"})," will be the ",(0,n.jsx)(s.code,{children:"msg.sender"})," and therefore become the owner of the ",(0,n.jsx)(s.code,{children:"Mastercopy"})," contract."]}),(0,n.jsxs)(s.p,{children:["Both the ",(0,n.jsx)(s.code,{children:"Proxy"})," contract and the ",(0,n.jsx)(s.code,{children:"Mastercopy"})," contract first inherit from ",(0,n.jsx)(s.code,{children:"Ownable"})," ensuring that the storage slot at index 0 will be used in the same manner on both contracts preventing any issues."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-8-of-8",children:"Question 8 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"fallback()"})," function’s ",(0,n.jsx)(s.code,{children:"assembly"})," block"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Can be marked as ",(0,n.jsx)(s.code,{children:'"memory-safe"'})," for gas optimizations "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. The result of the delegate-call overwrites the the call parameters in memory "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Interferes with the Slot-Hash calculation for the implementations-mapping by overwriting the scratch space "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is B."})}),(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"assembly"})," block doesn't respect Solidity's memory management and can't be considered to be ",(0,n.jsx)(s.code,{children:'"memory-safe"'}),". And even if it did, this Solidity version does not have the option to mark ",(0,n.jsx)(s.code,{children:"assembly"})," blocks as such yet, this was introduced with version 0.8.13."]}),(0,n.jsxs)(s.p,{children:["The use of the ",(0,n.jsx)(s.code,{children:"CALLDATACOPY"})," opcode will copy the full ",(0,n.jsx)(s.code,{children:"CALLDATASIZE"})," to memory starting at offset 0. Then, after the delegate-call was finished, the use of the ",(0,n.jsx)(s.code,{children:"RETURNDATACOPY"})," opcode will copy the full ",(0,n.jsx)(s.code,{children:"RETURNDATASIZE"})," to memory, also starting at offset 0. This effectively means that the output will overwrite the input of the delegate-call."]}),(0,n.jsxs)(s.p,{children:["The slot-hash calculation has already finished when the ",(0,n.jsx)(s.code,{children:"assembly"})," block begins, therefore there should not be any interference by overwriting the scratch space that was used for it."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n","\n",(0,n.jsxs)(o.oy,{children:[(0,n.jsx)(o.Zb,{icon:(0,n.jsx)(x.H8,{}),title:"← Secureum A-MAZE-X Stanford CTF",href:"/posts/2022/8/27/secureum-a-maze-x-stanford-ctf/"}),(0,n.jsx)(o.Zb,{icon:(0,n.jsx)(x.H8,{}),title:"← Go-To: Secureum Bootcamp Epoch∞ - August RACE #8",href:"/posts/2022/7/25/secureum-bootcamp-epoch-july-race-8/"}),(0,n.jsx)(o.Zb,{icon:(0,n.jsx)(x.H8,{}),title:"Secureum Bootcamp Epoch∞ - October RACE #10 →",href:"/posts/2022/10/3/secureum-bootcamp-epoch-october-race-10"})]})]})}s.default=(0,a.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,r.a)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/2022/8/29/secureum-bootcamp-epoch-august-race-9.mdx",route:"/posts/2022/8/29/secureum-bootcamp-epoch-august-race-9",timestamp:1731290394e3,title:"Secureum Bootcamp Epoch∞ - August RACE #9",headings:u},pageNextRoute:"/posts/2022/8/29/secureum-bootcamp-epoch-august-race-9"})},96139:function(e,s,t){var n=t(94869);t(26228);var i=t(70079),c=i&&"object"==typeof i&&"default"in i?i:{default:i};function _defineProperties(e,s){for(var t=0;t<s.length;t++){var n=s[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=void 0!==n&&n.env&&!0,isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},r=function(){function StyleSheet(e){var s=void 0===e?{}:e,t=s.name,n=void 0===t?"stylesheet":t,i=s.optimizeForSpeed,c=void 0===i?a:i;invariant$1(isString(n),"`name` must be a string"),this._name=n,this._deletedRulePlaceholder="#"+n+"-deleted-rule____{}",invariant$1("boolean"==typeof c,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=c,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var r=document.querySelector('meta[property="csp-nonce"]');this._nonce=r?r.getAttribute("content"):null}var e,s=StyleSheet.prototype;return s.setOptimizeForSpeed=function(e){invariant$1("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),invariant$1(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(invariant$1(!this._injected,"sheet already injected"),this._injected=!0,this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(a||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(s,t){return"number"==typeof t?e._serverSheet.cssRules[t]={cssText:s}:e._serverSheet.cssRules.push({cssText:s}),t},deleteRule:function(s){e._serverSheet.cssRules[s]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].ownerNode===e)return document.styleSheets[s]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,s){if(invariant$1(isString(e),"`insertRule` accepts only strings"),this._optimizeForSpeed){var t=this.getSheet();"number"!=typeof s&&(s=t.cssRules.length);try{t.insertRule(e,s)}catch(s){return a||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var n=this._tags[s];this._tags.push(this.makeStyleTag(this._name,e,n))}return this._rulesCount++},s.replaceRule=function(e,s){if(this._optimizeForSpeed){var t=this.getSheet();if(s.trim()||(s=this._deletedRulePlaceholder),!t.cssRules[e])return e;t.deleteRule(e);try{t.insertRule(s,e)}catch(n){a||console.warn("StyleSheet: illegal rule: \n\n"+s+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),t.insertRule(this._deletedRulePlaceholder,e)}}else{var n=this._tags[e];invariant$1(n,"old rule at index `"+e+"` not found"),n.textContent=s}return e},s.deleteRule=function(e){if(this._optimizeForSpeed)this.replaceRule(e,"");else{var s=this._tags[e];invariant$1(s,"rule at index `"+e+"` not found"),s.parentNode.removeChild(s),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]},s.cssRules=function(){var e=this;return this._tags.reduce(function(s,t){return t?s=s.concat(Array.prototype.map.call(e.getSheetForTag(t).cssRules,function(s){return s.cssText===e._deletedRulePlaceholder?null:s})):s.push(null),s},[])},s.makeStyleTag=function(e,s,t){s&&invariant$1(isString(s),"makeStyleTag accepts only strings as second parameter");var n=document.createElement("style");this._nonce&&n.setAttribute("nonce",this._nonce),n.type="text/css",n.setAttribute("data-"+e,""),s&&n.appendChild(document.createTextNode(s));var i=document.head||document.getElementsByTagName("head")[0];return t?i.insertBefore(n,t):i.appendChild(n),n},_defineProperties(StyleSheet.prototype,[{key:"length",get:function(){return this._rulesCount}}]),e&&_defineProperties(StyleSheet,e),StyleSheet}();function invariant$1(e,s){if(!e)throw Error("StyleSheet: "+s+".")}var stringHash=function(e){for(var s=5381,t=e.length;t;)s=33*s^e.charCodeAt(--t);return s>>>0},o={};function computeId(e,s){if(!s)return"jsx-"+e;var t=String(s),n=e+t;return o[n]||(o[n]="jsx-"+stringHash(e+"-"+t)),o[n]}function computeSelector(e,s){var t=e+s;return o[t]||(o[t]=s.replace(/__jsx-style-dynamic-selector/g,e)),o[t]}var l=function(){function StyleSheetRegistry(e){var s=void 0===e?{}:e,t=s.styleSheet,n=void 0===t?null:t,i=s.optimizeForSpeed,c=void 0!==i&&i;this._sheet=n||new r({name:"styled-jsx",optimizeForSpeed:c}),this._sheet.inject(),n&&"boolean"==typeof c&&(this._sheet.setOptimizeForSpeed(c),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var e=StyleSheetRegistry.prototype;return e.add=function(e){var s=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,s){return e[s]=0,e},{}));var t=this.getIdAndRules(e),n=t.styleId,i=t.rules;if(n in this._instancesCounts){this._instancesCounts[n]+=1;return}var c=i.map(function(e){return s._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[n]=c,this._instancesCounts[n]=1},e.remove=function(e){var s=this,t=this.getIdAndRules(e).styleId;if(function(e,s){if(!e)throw Error("StyleSheetRegistry: "+s+".")}(t in this._instancesCounts,"styleId: `"+t+"` not found"),this._instancesCounts[t]-=1,this._instancesCounts[t]<1){var n=this._fromServer&&this._fromServer[t];n?(n.parentNode.removeChild(n),delete this._fromServer[t]):(this._indices[t].forEach(function(e){return s._sheet.deleteRule(e)}),delete this._indices[t]),delete this._instancesCounts[t]}},e.update=function(e,s){this.add(s),this.remove(e)},e.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},e.cssRules=function(){var e=this,s=this._fromServer?Object.keys(this._fromServer).map(function(s){return[s,e._fromServer[s]]}):[],t=this._sheet.cssRules();return s.concat(Object.keys(this._indices).map(function(s){return[s,e._indices[s].map(function(e){return t[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},e.styles=function(e){var s,t;return s=this.cssRules(),void 0===(t=e)&&(t={}),s.map(function(e){var s=e[0],n=e[1];return c.default.createElement("style",{id:"__"+s,key:"__"+s,nonce:t.nonce?t.nonce:void 0,dangerouslySetInnerHTML:{__html:n}})})},e.getIdAndRules=function(e){var s=e.children,t=e.dynamic,n=e.id;if(t){var i=computeId(n,t);return{styleId:i,rules:Array.isArray(s)?s.map(function(e){return computeSelector(i,e)}):[computeSelector(i,s)]}}return{styleId:computeId(n),rules:Array.isArray(s)?s:[s]}},e.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,s){return e[s.id.slice(2)]=s,e},{})},StyleSheetRegistry}(),h=i.createContext(null);h.displayName="StyleSheetContext";var d=c.default.useInsertionEffect||c.default.useLayoutEffect,x=new l;function JSXStyle(e){var s=x||i.useContext(h);return s&&d(function(){return s.add(e),function(){s.remove(e)}},[e.id,String(e.dynamic)]),null}JSXStyle.dynamic=function(e){return e.map(function(e){return computeId(e[0],e[1])}).join(" ")},s.style=JSXStyle},65910:function(e,s,t){"use strict";e.exports=t(96139).style},26228:function(){}},function(e){e.O(0,[3220,1589,9774,2888,179],function(){return e(e.s=78091)}),_N_E=e.O()}]);