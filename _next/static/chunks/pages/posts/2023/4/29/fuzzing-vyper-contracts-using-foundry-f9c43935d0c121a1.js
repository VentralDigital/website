(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{37093:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2023/4/29/fuzzing-vyper-contracts-using-foundry",function(){return n(507)}])},507:function(e,s,n){"use strict";n.r(s),n.d(s,{__toc:function(){return h},default:function(){return d}});var r=n(35250),t=n(47147),o=n(77298),l={src:"/_next/static/media/vyper_bytecode.bb85f8ec.png",height:101,width:1500,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAABCAMAAADU3h9xAAAAA1BMVEVUWV2ybHDiAAAACXBIWXMAAAsSAAALEgHS3X78AAAAC0lEQVR4nGNggAIAAAkAAftSuKkAAAAASUVORK5CYII=",blurWidth:8,blurHeight:1},i={src:"/_next/static/media/first_success.74d9573c.png",height:177,width:492,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAABlBMVEUtLi0hISHLhWDLAAAACXBIWXMAAAsSAAALEgHS3X78AAAAE0lEQVR4nGNgAAFGRkYYDWGA2AAAhgAJLGu3nQAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:3},a={src:"/_next/static/media/fuzz_success.b202252c.png",height:193,width:544,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAACVBMVEUtLy4fIB8lJSXpQ+YnAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFklEQVR4nGNgAAImJkZGMM3ICGGAOQAA5AAPdPsCCwAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:3},c=n(18363);let h=[{depth:2,value:"Introduction to testing using Foundry and Solidity",id:"introduction-to-testing-using-foundry-and-solidity"},{depth:4,value:"The Basics of Foundry",id:"the-basics-of-foundry"},{depth:4,value:"The Basics of Fuzzing",id:"the-basics-of-fuzzing"},{depth:4,value:"Deploying Contracts",id:"deploying-contracts"},{depth:2,value:"Testing using Foundry with Vyper",id:"testing-using-foundry-with-vyper"},{depth:4,value:"Vyper 101",id:"vyper-101"},{depth:4,value:"Combining Vyper and Foundry",id:"combining-vyper-and-foundry"},{depth:2,value:"Building on our example",id:"building-on-our-example"},{depth:4,value:"Adding the fuzzing test function to our test file",id:"adding-the-fuzzing-test-function-to-our-test-file"},{depth:2,value:"Conclusion",id:"conclusion"}];function _createMdxContent(e){let s=Object.assign({h1:"h1",p:"p",a:"a",h2:"h2",h4:"h4",strong:"strong",code:"code",pre:"pre",span:"span",ol:"ol",li:"li",img:"img"},(0,o.a)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{children:"Fuzzing Vyper Contracts Using Foundry"}),"\n","\n",(0,r.jsx)(c.UW,{type:"info",children:(0,r.jsxs)(s.p,{children:["This is a guest post by ",(0,r.jsx)(s.a,{href:"https://twitter.com/_Parsely_",children:"Darren Chapman (aka Parsely)"})," created as part of ",(0,r.jsx)(s.a,{href:"https://twitter.com/patrickd_de/status/1646941356277788672",children:"patrickdâ€™s writing mentorship"}),"."]})}),"\n",(0,r.jsxs)("p",{className:"text-xs text-right",children:["April 29, 2023 by ",(0,r.jsx)(s.a,{href:"/about#parsely",children:"Parsely"})]}),"\n",(0,r.jsx)(s.p,{children:"As a web3 developer one of the essential tasks is to write tests for your contracts. These tests are usually unit tests that test the functionality and business logic of the code. One step up from that, to really enhance the security, would be to write more complex tests like invariant tests and fuzzing tests. The Foundry framework has made writing these types of tests for Solidity contracts a much easier task."}),"\n",(0,r.jsx)(s.p,{children:"But what about smart contracts written in other languages? How can we use the Foundry framework in these development environments?"}),"\n",(0,r.jsx)(s.p,{children:"In this article, we will take a look at how the Foundry framework can be used to write tests that will fuzz contracts written in Vyper."}),"\n",(0,r.jsx)(s.h2,{id:"introduction-to-testing-using-foundry-and-solidity",children:"Introduction to testing using Foundry and Solidity"}),"\n",(0,r.jsx)(s.h4,{id:"the-basics-of-foundry",children:"The Basics of Foundry"}),"\n",(0,r.jsx)(s.p,{children:"Let's begin by looking at how a basic Foundry test is written and what happens when we run our tests within the framework."}),"\n",(0,r.jsx)(s.p,{children:"This will give us a better foundational understanding of the basic testing pattern, before exploring fuzzing Vyper contracts in more detail."}),"\n",(0,r.jsxs)(s.p,{children:["Foundry's module that runs the tests is called ",(0,r.jsx)(s.strong,{children:"Forge"}),". Forge will check the function names declared in the contract, if any of the function's names starts with ",(0,r.jsx)(s.strong,{children:"test"}),", it is considered to be a valid Forge test. By convention, test contracts are usually created within the ",(0,r.jsx)(s.strong,{children:"/test"})," directory and the file name usually ends with ",(0,r.jsx)(s.strong,{children:".t.sol"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["When a test is run in Foundry, the ",(0,r.jsx)(s.code,{children:"setup"})," function which can be used to set up the environment, will be invoked before running each test method."]}),"\n",(0,r.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"solidity","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"setup"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    counter "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Counter"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}   "})})]})}),"\n",(0,r.jsx)(s.p,{children:"Once setup has successfully run, the framework will then run any of the tests written in our Solidity code in the test contract."}),"\n",(0,r.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"solidity","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"testSomethingStatic"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(){"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    deployedContract."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"callAFunction"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"assertEq"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(deployedContract."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"aVariable"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"valueItShouldBeNow);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,r.jsx)(s.h4,{id:"the-basics-of-fuzzing",children:"The Basics of Fuzzing"}),"\n",(0,r.jsx)(s.p,{children:"We have looked at how simple tests can be written and run in Foundry. Let's now take a look at how fuzzing can be implemented in the Foundry framework."}),"\n",(0,r.jsxs)(s.p,{children:["A fuzz test function is identified by Foundry as being a function with at least one input parameter. The test function will run a configurable number of times, with quasi-random values set for the input parameter on each iteration. Foundry has created a way in which developers can either filter input values, or set ranges that these values should be within. Forge tests will recognise and adhere to any limits set by using the cheatcodes called ",(0,r.jsx)(s.code,{children:"assume"})," and ",(0,r.jsx)(s.code,{children:"bound"}),"."]}),"\n",(0,r.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"solidity","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"testFuzzSettingaNewValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint256"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" valuetoBeSet){"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The value of the variable valuetoBeSet will be generated by Forge "})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// and passed into the contract function being tested"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The input values should be greater than zero"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    vm."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"assume"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(valuetoBeSet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Set a range for valuetoBeSet, it must be between 1 and 200"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    valuetoBeSet "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"bound"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(valuetoBeSet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"200"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    deployedContract."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"callAFunction"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(valuetoBeSet);"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"assertEq"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(deployedContract."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"aVariable"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"valueItShouldBeNow);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,r.jsxs)(s.p,{children:["The above test will run and replace the value of ",(0,r.jsx)(s.code,{children:"theNewValue"})," with a quasi-random number to test the logic and the assertion."]}),"\n",(0,r.jsx)(s.p,{children:"By default the test will run 256 times, but this can be set within the Foundry configuration to be any value of your choosing."}),"\n",(0,r.jsx)(s.h4,{id:"deploying-contracts",children:"Deploying Contracts"}),"\n",(0,r.jsxs)(s.p,{children:["The main assumption in any of the test functions is, that any contract that the test needs to interact with either is deployed, or will be deployed in the ",(0,r.jsx)(s.code,{children:"setup()"})," function or as part of the test logic. The logic in our Solidity code allows us to declare and instantiate any of the contracts we would need to have deployed, in order to successfully run the logic of our test."]}),"\n",(0,r.jsx)(s.p,{children:"Vyper contracts are not as easily deployed as Solidity contracts by the Foundry framework, which necessitates a few more steps, in order to deploy the Vyper code that the test needs to interact with."}),"\n",(0,r.jsx)(s.h2,{id:"testing-using-foundry-with-vyper",children:"Testing using Foundry with Vyper"}),"\n",(0,r.jsx)(s.h4,{id:"vyper-101",children:"Vyper 101"}),"\n",(0,r.jsx)(s.p,{children:"It would be good to take a quick look at how Vyper development and deployment work on a local system, before we continue exploring how to use Foundry to fuzz test our Vyper contracts."}),"\n",(0,r.jsxs)(s.p,{children:["In order to be able to have a working example by the end of the article, we will build a very basic project together, that will allow us to build step by step and end up with a working fuzz example. The Vyper contract we will use is one I have written, which mimicks the functionality of the Counter contract, which is created by default when a new Forge workspace is initialized using the ",(0,r.jsx)(s.code,{children:"forge init"})," command."]}),"\n",(0,r.jsx)(s.p,{children:"To develop the example project, we first need to set up our environment and workspace."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"mkdir vyper_example"}),". Create a directory for the example."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"cd vyper_example"}),". Move into that directory"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"npm install Vyper"}),". Install the Vyper NPM modules."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"mkdir src"}),". Create a ",(0,r.jsx)(s.strong,{children:"src"})," directory"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"cd ./src"}),". Move into the ",(0,r.jsx)(s.strong,{children:"src"})," directory."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"touch Contract.vy"}),". Create a file called ",(0,r.jsx)(s.strong,{children:"Contract.vy"})]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Copy and Paste"})," the code below into the file"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"python","data-theme":"default",filename:"Contract.vy",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-line-numbers":"","data-language":"python","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# @version ^0.3.7"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# declare a variable called somenumber of type uint8"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"somenumber "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"public"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"(uint8)"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# the @external decorator declares the visibility of the function"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# the __init__ function is the same as a constructor in Solidity"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"@external"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"__init__"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"():"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# For state variables we always need to refer to them using self."})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# Set our somenumber variable to 1 in the constructor"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    self"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"somenumber "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# The setNumber function takes an input parameter"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# @param newvalue type uint8 "})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# @return a value of type uint8 which should be the input value of the parameter newvalue"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"@external"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"setNumber"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-parameter)"},children:"newvalue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" uint8) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" uint8:"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    self"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"somenumber "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" newvalue"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"somenumber"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# The getNumber function returns the current value of the somenumber variable"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# @return the current value of the somenumber variable"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"@external"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"def"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"getNumber"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"->"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" uint8:"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" self"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"somenumber"})]})]})}),"\n",(0,r.jsxs)(s.p,{children:["Open a new Terminal in the ",(0,r.jsx)(s.strong,{children:"vyper_example"})," directory"]}),"\n",(0,r.jsxs)(s.ol,{start:"6",children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"vyper src\\Contract.vy"}),". Compile the contract."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Vyper bytecode",placeholder:"blur",src:l})}),"\n",(0,r.jsx)(s.p,{children:"The command line code returns bytecode, which can then be used to deploy the Vyper contract onto the blockchain."}),"\n",(0,r.jsx)(s.h4,{id:"combining-vyper-and-foundry",children:"Combining Vyper and Foundry"}),"\n",(0,r.jsxs)(s.p,{children:["When we test Vyper contracts using Foundry, we will need a way to compile and deploy the contracts within the ",(0,r.jsx)(s.code,{children:"setup"})," or ",(0,r.jsx)(s.code,{children:"test"})," functions."]}),"\n",(0,r.jsxs)(s.p,{children:["Foundry comes with a cheatcode in the framework, which enables us to interact with our local system, called ",(0,r.jsx)(s.strong,{children:"ffi"}),". This Foundry cheatcode allows us to run terminal commands from Solidity code on our local system, and assumes the output of the terminal command will be hex values. ",(0,r.jsx)(s.strong,{children:"ffi"})," runs within the context of the root directory of the project, and not within the context of the test directory."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.a,{href:"https://book.getFoundry.sh/cheatcodes/ffi?highlight=ffi#ffi",children:"Link to Foundry Book Website -> ffi"})}),"\n",(0,r.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",children:(0,r.jsx)(s.code,{"data-language":"solidity","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ffi"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"calldata"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"returns"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"bytes"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]})})}),"\n",(0,r.jsx)(s.p,{children:"The example below is very basic, but will allow us to compile and deploy a Vyper contract from Solidity code."}),"\n",(0,r.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"solidity","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"interface"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" ffiInterface"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ffi"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"calldata"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"returns"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"bytes"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Instantiate the interface to be able to call the cheatcode"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"ffiInterface "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ffiCheat "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ffiInterface"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(HEVM_ADDRESS);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// ffi takes as input a string array."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" deployCommand "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[]("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The Vyper terminal command to compile a Vyper file"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"deployCommand["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"vyper"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The path to Vyper file that we would like to compile and receive"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// the bytecode output for."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"deployCommand["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"src/Contract.vy"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Store the output bytecode in a local variable"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"bytes"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" compiledByteCode "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ffiCheat."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ffi"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(deployCommand);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Now use inline assembly to deploy that bytecode onto our test environment."})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" newContractAddress;"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"assembly"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { "})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    newContractAddress "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"create"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"add"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(compiledByteCode"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0x20"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"mload"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(compiledByteCode)) "})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,r.jsx)(s.h2,{id:"building-on-our-example",children:"Building on our example"}),"\n",(0,r.jsxs)(s.p,{children:["The example project we have built so far is not yet setup to use Foundry. We need to initialize the current directory ",(0,r.jsx)(s.strong,{children:"vyper_example"})," and install all the requisite libraries needed by the framework to be able to run tests. The terminal command to initialize a directory is ",(0,r.jsx)(s.code,{children:"forge init --no-git --force"}),"."]}),"\n",(0,r.jsx)(c.UW,{children:(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"--force"})," option is provided to allow ",(0,r.jsx)(s.strong,{children:"Forge"})," to ignore the fact that our root directory is not empty, as by default ",(0,r.jsx)(s.strong,{children:"Forge"})," requires an empty directory to start a new project."]})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"Forge init"})," should install the required test libraries for Foundry in the ",(0,r.jsx)(s.strong,{children:"lib"})," directory by default, however if you need to install them, you can run the command ",(0,r.jsx)(s.code,{children:"forge install foundry-rs/forge-std"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["The configuration file called ",(0,r.jsx)(s.strong,{children:"remappings.txt"}),", tells Foundry where to look for files referred to by import statements in the code. In our example, we would need to create this file in our project's root directory called ",(0,r.jsx)(s.strong,{children:"vyper_example"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"For convenience I have pasted the values needed in our remappings file below. These values map to the Forge-std libraries which are imported into our test contract to run the fuzz tests."}),"\n",(0,r.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",filename:"remappings.txt",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-line-numbers":"","data-language":"plaintext","data-theme":"default","data-line-numbers-max-digits":"1",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"ds-test/=lib/forge-std/lib/ds-test/src/"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"forge-std/=lib/forge-std/src/"})})]})}),"\n",(0,r.jsxs)(s.p,{children:["We learned earlier that test contract files are usually created in the ",(0,r.jsx)(s.strong,{children:"test"})," directory. So let's create a file in the ",(0,r.jsx)(s.strong,{children:"test"})," directory called ",(0,r.jsx)(s.strong,{children:"Contract.t.sol"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Copy and paste"})," the code below into the test contract and save the file."]}),"\n",(0,r.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",filename:"test/Contract.t.sol",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-line-numbers":"","data-language":"solidity","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// SPDX-License-Identifier: UNLICENSED"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"pragma"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"Solidity"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ^0.8.13;"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Forge-std/Test.sol"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Declare the interface which describes our Vyper contract"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"interface"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" VyperContract"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"setNumber"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint8"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"returns"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint8"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"getNumber"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"returns"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint8"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Declare the interface for the ffi cheatcode function"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"interface"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" ffiInterface"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ffi"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"calldata"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"external"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"returns"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"bytes"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"contract"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"VyperContractTest"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"is"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Test"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Declare a variable for the Vyper interface variable"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    VyperContract VyperContract;"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The setup function will run before each test function "})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// and compile and deploy our Vyper contract to our local test environment"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"setUp"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Instantiate the ffi interface"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        ffiInterface ffiCheat "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ffiInterface"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(HEVM_ADDRESS);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The string array input varaible used by ffi"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" deployCommand "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"[]("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"2"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The Vyper keyword to compile a contract"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        deployCommand["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"vyper"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The path to the Vyper contract file starting from the project root directory"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        deployCommand["}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"] "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"src/Contract.vy"'}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:";"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// A local variable to hold the output bytecode"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"bytes"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"memory"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" compiledByteCode "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ffiCheat."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"ffi"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(deployCommand);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// A local variable to hold the address of the deployed Vyper contract"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"address"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" newContractAddress;"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Inline assembly code to deploy a contract using bytecode"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"assembly"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { "})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                    newContractAddress "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"create"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"add"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(compiledByteCode"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0x20"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"mload"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(compiledByteCode)) "})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                }"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Instantiate the Vyper interface "})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        VyperContract "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"VyperContract"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(newContractAddress);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Static test function which will run once"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"testExists"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Variable to hold the value of the getNumber() function from our Vyper contract"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The number in the Vyper contract is set to 1 in the constructor"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint8"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" currentContractValue "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" VyperContract."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"getNumber"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"();"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Assert that the value we got from calling the getNumber function is correctly set to 1"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"assertEq"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(currentContractValue"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"1"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "})]})}),"\n",(0,r.jsx)(s.p,{children:"We are now ready to run our first test, which will deploy our Vyper contract and run our static test."}),"\n",(0,r.jsxs)(s.ol,{start:"8",children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"forge test --match-contract VyperContractTest -vv --ffi"}),". To run the Forge test"]}),"\n"]}),"\n",(0,r.jsx)(c.UW,{children:(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"--ffi"})," tells Foundry to allow the ",(0,r.jsx)(s.strong,{children:"ffi"})," call as it is disabled by default for security reasons."]})}),"\n",(0,r.jsx)(s.p,{children:"If everything has worked correctly our test should be successful."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Screenshot of successful forge test run",placeholder:"blur",src:i})}),"\n",(0,r.jsx)(s.h4,{id:"adding-the-fuzzing-test-function-to-our-test-file",children:"Adding the fuzzing test function to our test file"}),"\n",(0,r.jsx)(s.p,{children:"We have progressed now to a point where we can deploy and interact with our Vyper contract."}),"\n",(0,r.jsx)(s.p,{children:"The final step will be to add a fuzzing function to our Foundry test contract."}),"\n",(0,r.jsx)(s.p,{children:"Paste the code below into our test contract and run the test command again."}),"\n",(0,r.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"solidity","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Fuzzing test as it has an input parameter"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"testFuzzSetNumber"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint8"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" fuzzNum) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"public"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    {"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Local variable to hold the value returned by calling the setNumber() function"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// The return value should be the same as the value sent in"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"uint8"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" numberThatWasSet  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" VyperContract."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"setNumber"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(fuzzNum);"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// Assert that the returned value is equal to the number sent in"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"assertEq"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(numberThatWasSet"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"fuzzNum);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})})]})}),"\n",(0,r.jsx)(s.p,{children:"Reminder of the command to run:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.code,{children:"forge test --match-contract VyperContractTest -vv --ffi"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Screenshot of successful fuzz run",placeholder:"blur",src:a})}),"\n",(0,r.jsx)(s.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsxs)(s.p,{children:["In this article we covered a brief overview of Vyper and Foundry.\nWe went through the steps of creating and compiling the Vyper contract using ",(0,r.jsx)(s.strong,{children:"ffi"}),". We learned how to allow Foundry to interact with our system to run commands, and finally, we saw how all of these techniques can be combined to enable developers to write unit tests and fuzzing tests for their Vyper development."]})]})}var d=(0,t.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,o.a)(),e.components);return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/2023/4/29/fuzzing-vyper-contracts-using-foundry.mdx",route:"/posts/2023/4/29/fuzzing-vyper-contracts-using-foundry",timestamp:1701793814e3,title:"Fuzzing Vyper Contracts Using Foundry",headings:h},pageNextRoute:"/posts/2023/4/29/fuzzing-vyper-contracts-using-foundry"})},47147:function(e,s,n){"use strict";n.d(s,{j:function(){return setupNextraPage}});var r,t=n(44619),o=n.n(t),l=n(54594),i=n(70079);n(77298);var a=n(35250),c=(0,i.createContext)(!1),h=n(65263);function Nextra({__nextra_pageMap:e,__nextra_dynamic_opts:s,...n}){let{context:r,Layout:t}=function(){let e=globalThis[l.eZ],{route:s}=(0,h.useRouter)();(0,i.useState)({})[1];let n=e.context[s];if(!n)throw Error("No content found for the current route. This is a Nextra bug.");return{context:n,Layout:e.Layout}}(),{Content:o,...d}=r;if(e&&(d.pageOpts={...d.pageOpts,pageMap:e}),s){let{headings:e,title:n,frontMatter:r}=JSON.parse(s);d.pageOpts={...d.pageOpts,headings:e,title:n,frontMatter:r}}return(0,a.jsx)(t,{...d,pageProps:n,children:(0,a.jsx)(c.Provider,{value:n,children:(0,a.jsx)(o,{...n})})})}var d=n(86264),x=n(99199),p=n(20439);function pageTitleFromFilename(e){return p(e.replaceAll(/[-_]/g," "))}function isFolder(e){return!!e&&"object"==typeof e&&"folder"===e.type}function normalizeMetaData(e){return Object.fromEntries(Object.entries(e).map(([e,s])=>{if(isFolder(s)){let n=e.replace("/","");return[n,s.title||pageTitleFromFilename(n)]}return[e,s||pageTitleFromFilename(e)]}))}function setupNextraPage({pageNextRoute:e,pageOpts:s,nextraLayout:n,themeConfig:t,MDXContent:i,hot:a,pageOptsChecksum:c,dynamicMetaModules:h=[]}){var p;"undefined"==typeof window&&(globalThis.__nextra_resolvePageMap=async()=>{if(r)return r;let e=JSON.parse(JSON.stringify(y.pageMap));return await Promise.all(h.map(async([s,{metaObjectKeyPath:n,metaParentKeyPath:r}])=>{let t=await s,l=await t.default(),i=o()(e,n);i.data=l;let a=o()(e,r);!function collectCatchAllRoutes(e,s,n=!0){if(n){collectCatchAllRoutes(e,{kind:"Meta",data:s.data,locale:s.locale},!1),s.data=normalizeMetaData(s.data);return}for(let[n,t]of Object.entries(s.data)){if(!isFolder(t)){var r;if("*"===n)continue;e.children.push({kind:"MdxPage",...s.locale&&{locale:s.locale},name:n,route:(r=e.route,x(d.join(r,n.replace(/^index$/,""))))});continue}let o=n.replace("/",""),l={kind:"Folder",name:o,route:`${e.route}/${o}`,children:[{kind:"Meta",...s.locale&&{locale:s.locale},data:normalizeMetaData(t.items)}]};e.children.push(l),collectCatchAllRoutes(l,{kind:"Meta",data:t.items,locale:s.locale},!1)}}(a,i)})),r=e});let y=globalThis[p=l.eZ]||(globalThis[p]=Object.create(null));return s.pageMap?(y.pageMap=s.pageMap,y.Layout=n):(s={...s,pageMap:y.pageMap,flexsearch:y.flexsearch},t=y.themeConfig),s={frontMatter:{},...s},y.route=s.route,y.context||(y.context=Object.create(null)),y.context[e]={Content:i,pageOpts:s,themeConfig:t},Nextra}}},function(e){e.O(0,[3220,9774,2888,179],function(){return e(e.s=37093)}),_N_E=e.O()}]);