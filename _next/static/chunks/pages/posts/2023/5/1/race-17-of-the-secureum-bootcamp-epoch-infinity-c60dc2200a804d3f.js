(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7964],{48598:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2023/5/1/race-17-of-the-secureum-bootcamp-epoch-infinity",function(){return t(38879)}])},64751:function(e,s){"use strict";s.Z={src:"/_next/static/media/secureum-banner.b3ad8557.jpg",height:630,width:1200,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAEAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAbEAACAgMBAAAAAAAAAAAAAAAAAgEDBCEyE//EABUBAQEAAAAAAAAAAAAAAAAAAAQF/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAwDAQACEQMRAD8AnGFcviyPjUWS1PTJuOtgAcT9auj/2Q==",blurWidth:8,blurHeight:4}},38879:function(e,s,t){"use strict";t.r(s),t.d(s,{HiddenSolution:function(){return HiddenSolution},__toc:function(){return x}});var n=t(35250),i=t(65910),a=t.n(i),r=t(47147),c=t(77298),o=t(18363),l=t(30746),h=t.n(l),d=t(64751),u=t(13423);function HiddenSolution(e){let{children:s}=e,t=Object.assign({details:"details",summary:"summary",strong:"strong",div:"div"},(0,c.a)());return(0,n.jsxs)(t.details,{closed:!0,className:"last-of-type:mb-0 rounded-lg bg-neutral-50 dark:bg-neutral-800 p-2 mt-4",children:[(0,n.jsx)(t.summary,{children:(0,n.jsx)(t.strong,{className:"text-lg",children:"Solution"})}),(0,n.jsx)(t.div,{className:"nx-p-2",children:s})]})}let x=[{depth:3,value:"Code",id:"code"},{depth:3,value:"Question 1 of 8",id:"question-1-of-8"},{depth:3,value:"Question 2 of 8",id:"question-2-of-8"},{depth:3,value:"Question 3 of 8",id:"question-3-of-8"},{depth:3,value:"Question 4 of 8",id:"question-4-of-8"},{depth:3,value:"Question 5 of 8",id:"question-5-of-8"},{depth:3,value:"Question 6 of 8",id:"question-6-of-8"},{depth:3,value:"Question 7 of 8",id:"question-7-of-8"},{depth:3,value:"Question 8 of 8",id:"question-8-of-8"}];function _createMdxContent(e){let s=Object.assign({h1:"h1",p:"p",a:"a",strong:"strong",hr:"hr",h3:"h3",pre:"pre",code:"code",span:"span",ul:"ul",li:"li",math:"math",semantics:"semantics",mrow:"mrow",mn:"mn",mi:"mi",annotation:"annotation"},(0,c.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{children:"RACE #17 Of The Secureum Bootcamp Epoch∞"}),"\n","\n",(0,n.jsxs)(h(),{children:[(0,n.jsx)("meta",{property:"og:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"}),(0,n.jsx)("meta",{name:"twitter:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"})]}),"\n",(0,n.jsxs)(s.p,{children:["This is a Write-Up of RACE-17, Quiz of the ",(0,n.jsx)(s.a,{href:"https://twitter.com/0xRajeev/status/1470910752085065731",children:"Secureum Bootcamp"})," for Ethereum Smart Contract Auditors.   It was designed by Secureum Mentor ",(0,n.jsx)(s.a,{href:"https://twitter.com/HickupH",children:"Desmond (aka Hickup)"}),", one of my colleagues at ",(0,n.jsx)(s.a,{href:"https://twitter.com/SpearbitDAO",children:"Spearbit DAO"}),"."]}),"\n",(0,n.jsxs)(o.UW,{type:"info",children:[(0,n.jsxs)(s.p,{children:["Participants of this quiz had to ",(0,n.jsx)(s.strong,{children:"answer 8 questions within the strict time limit of 16 minutes"}),". If you’re reading this in preparation for participating yourself, it’s best to give it a try under the same time limit!"]}),(0,n.jsx)(s.p,{children:"As usual, I waited for submissions to close before publishing it and, to stay true to the original, I omitted syntax highlighting. Feel free to copy it into your favorite editor, but do so after starting the timer!"})]}),"\n",(0,n.jsxs)("p",{className:"jsx-ea2c409626c7be76 text-xs text-right",children:["May 1, 2023 by ",(0,n.jsx)(s.a,{href:"/about#patrickd",children:"patrickd"})]}),"\n",(0,n.jsx)(a(),{id:"ea2c409626c7be76",children:"input[type=checkbox].jsx-ea2c409626c7be76{width:15px;height:15px}li.jsx-ea2c409626c7be76{padding:.5em}"}),"\n","\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"code",children:"Code"}),"\n",(0,n.jsx)(o.UW,{type:"info",children:(0,n.jsx)(s.p,{children:"All 8 questions in this RACE are based on the below contract. This is the same contract you will see for all the 8 questions in this RACE. The question is below the shown contract."})}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,n.jsxs)(s.code,{"data-line-numbers":"","data-language":"plaintext","data-theme":"default","data-line-numbers-max-digits":"2",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"pragma solidity 0.8.19;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import {Pausable} from "https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/security/Pausable.sol";'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import {IERC20} from "https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/IERC20.sol";'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import {SafeERC20} from "https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/utils/SafeERC20.sol";'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"interface IWETH is IERC20 {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function deposit() external payable;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function withdraw(uint256) external;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract Vault is Pausable {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   using SafeERC20 for IWETH;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   address public immutable controller;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   IWETH public immutable WETH;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // about 4700 ETH"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint72 public constant TOTAL_CONTRIBUTION_CAP = type(uint72).max;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // ALLOWANCE_CAP = 40% of TOTAL_CONTRIBUTION_CAP"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint256 public immutable ALLOWANCE_CAP = 40 * uint256(TOTAL_CONTRIBUTION_CAP) / 100;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint72 public totalContributions;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   mapping (address => uint72) individualContributions;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint256 numContributors;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   event ContributorsUpdated(address newContributor, uint256 indexed oldNumContributors, uint256 indexed newNumContributors);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   constructor(address _controller, IWETH _weth) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       controller = _controller;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       WETH = _weth;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function deposit(uint72 amount) external payable whenNotPaused {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       if (msg.value > 0) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           WETH.deposit{value: amount}();"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       } else {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           WETH.transferFrom(msg.sender, address(this), amount);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require((totalContributions += amount) <= TOTAL_CONTRIBUTION_CAP, "cap exceeded");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       if (individualContributions[msg.sender] == 0) emit ContributorsUpdated(msg.sender, numContributors, numContributors++);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       individualContributions[msg.sender] += amount;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function withdraw(uint72 amount) external whenNotPaused {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       individualContributions[msg.sender] -= amount;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       totalContributions -= amount;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       // unwrap and call"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       WETH.withdraw(amount);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       (bool success, ) = payable(address(msg.sender)).call{value: amount}("");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(success, "failed to transfer ETH");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function requestAllowance(uint256 amount) external {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       // ALLOWANCE_CAP is 40% of TOTAL_CAP"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 allowanceCap = ALLOWANCE_CAP;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 allowance = amount > totalContributions ? allowanceCap : amount;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       WETH.safeApprove(controller, allowance);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // for unwrapping WETH -> ETH"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   receive() external payable {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(msg.sender == address(WETH), "only WETH contract");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(s.h3,{id:"question-1-of-8",children:"Question 1 of 8"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"deposit()"})," can revert:"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. If insufficient ETH was sent with the call "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. If the caller has insufficient WETH balance "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. With the ",(0,n.jsx)(s.code,{children:'"cap exceeded"'})," error "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. If called internally "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is A, B."})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["A: If the ether ",(0,n.jsx)(s.code,{children:"(msg.value > 0)"})," provided with the call to ",(0,n.jsx)(s.code,{children:"deposit()"})," is less than the specified amount, the attempt to call ",(0,n.jsx)(s.code,{children:"WETH.deposit()"})," may revert."]}),"\n",(0,n.jsxs)(s.li,{children:["B: If no ether was provided with the call and the caller has an insufficient balance of WETH, or given insufficient approval to their WETH balance, the attempt to call ",(0,n.jsx)(s.code,{children:"WETH.transferFrom()"})," will revert."]}),"\n",(0,n.jsxs)(s.li,{children:["C: For the ",(0,n.jsx)(s.code,{children:'"cap exceeded"'})," error to be thrown, ",(0,n.jsx)(s.code,{children:"totalContributions + amount > TOTAL_CONTRIBUTION_CAP"}),". But ",(0,n.jsx)(s.code,{children:"TOTAL_CONTRIBUTION_CAP = type(uint72).max"})," and ",(0,n.jsx)(s.code,{children:"totalContributions"})," is ",(0,n.jsx)(s.code,{children:"uint72"}),". So the attempt to add an amount to ",(0,n.jsx)(s.code,{children:"totalContributions"})," that would make it larger than ",(0,n.jsx)(s.code,{children:"type(uint72).max"})," would revert from an integer overflow error before the ",(0,n.jsx)(s.code,{children:"require()"})," ever could. This makes the ",(0,n.jsx)(s.code,{children:"require()"})," basically redundant and it can be removed."]}),"\n",(0,n.jsxs)(s.li,{children:["D: The ",(0,n.jsx)(s.code,{children:"deposit()"})," function is a external. An attempt to call it internally would not revert but never compile in the first place. The contract could still call this function via ",(0,n.jsx)(s.code,{children:"this.deposit()"})," though, which would make the contract ",(0,n.jsx)(s.code,{children:"CALL"})," itself like it would an external contract."]}),"\n"]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-2-of-8",children:"Question 2 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["What issues pertain to the ",(0,n.jsx)(s.code,{children:"deposit()"})," function?"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Funds can be drained through re-entrancy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Accounting mismatch if user specifies ",(0,n.jsx)(s.code,{children:"amount"})," > ",(0,n.jsx)(s.code,{children:"msg.value"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Accounting mismatch if user specifies ",(0,n.jsx)(s.code,{children:"amount"})," < ",(0,n.jsx)(s.code,{children:"msg.value"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. ",(0,n.jsx)(s.code,{children:"totalContributionCap"})," isn't enforced on an individual level "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is C."})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["A: For a re-entrancy an unsafe external call needs to be made. All the external calls being made within the ",(0,n.jsx)(s.code,{children:"deposit()"})," are to the trusted WETH contract which does also not have any sender callbacks/hooks like an ERC777 would have."]}),"\n",(0,n.jsxs)(s.li,{children:["B/C: If the specified ",(0,n.jsx)(s.code,{children:"amount"})," was larger than the sent ",(0,n.jsx)(s.code,{children:"msg.value"}),", the function would revert. But on the other hand, if the ",(0,n.jsx)(s.code,{children:"amount"})," was smaller than the actual sent ",(0,n.jsx)(s.code,{children:"msg.value"})," the deposit would only handle the ",(0,n.jsx)(s.code,{children:"amount"})," and the rest of the ether would be left in the ",(0,n.jsx)(s.code,{children:"Vault"})," contract (allowing someone else to pick it up on another deposit)."]}),"\n",(0,n.jsxs)(s.li,{children:["D: The fact that ",(0,n.jsx)(s.code,{children:"totalContributionCap"})," isn't enforced on an individual level does not cause an issue as ",(0,n.jsx)(s.code,{children:"totalContributions"}),"'s value would revert before any individual contributor would be able to make deposits beyond the cap."]}),"\n"]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-3-of-8",children:"Question 3 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["Which of the following is/are true about ",(0,n.jsx)(s.code,{children:"withdraw()"}),"?"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Funds can be drained through re-entrancy "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Funds can be drained due to improper amount accounting in ",(0,n.jsx)(s.code,{children:"deposit()"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Assuming a sufficiently high gas limit, the function reverts from the recipient (caller) consuming all forwarded gas "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. May revert with ",(0,n.jsx)(s.code,{children:'"failed to transfer ETH"'})," "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is D."})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["A: The ",(0,n.jsx)(s.code,{children:"withdraw()"})," function follows the Checks-Effects-Interactions pattern: (Check) Subtracting the amount from the individual's contribution would revert if the integer were to underflow. (Effect) The individual contributor's balance is updated before the value is transferred. (Interactions) The unsafe external call to the ",(0,n.jsx)(s.code,{children:"msg.sender"})," is only made once all Checks and Effects have been applied. Re-entering the contract would not allow draining any funds."]}),"\n",(0,n.jsxs)(s.li,{children:["B: It's true that there's improper accounting, but the effect is that funds that were left over from a ",(0,n.jsx)(s.code,{children:"deposit()"})," can be recovered/stolen by another depositor and then withdrawn. This does not allow to drain the Vault of any funds that have been properly accounted for though."]}),"\n",(0,n.jsxs)(s.li,{children:["C: As only ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsx)(s.mn,{children:"63"}),(0,n.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,n.jsx)(s.mn,{children:"64"})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"63/64"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,n.jsx)(s.span,{className:"mord",children:"63/64"})]})})]})," gas is forwarded, the function should have sufficient gas remaining for execution (hence the high gas limit assumption)."]}),"\n",(0,n.jsxs)(s.li,{children:["D: True, if ",(0,n.jsx)(s.code,{children:"msg.sender"})," reverts (eg. is a contract that lacks ",(0,n.jsx)(s.code,{children:"payable"})," / ",(0,n.jsx)(s.code,{children:"fallback"})," function)."]}),"\n"]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-4-of-8",children:"Question 4 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["Which of the following parameters are correctly emitted in the ",(0,n.jsx)(s.code,{children:"ContributorsUpdated()"})," event?"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. ",(0,n.jsx)(s.code,{children:"newContributor"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. ",(0,n.jsx)(s.code,{children:"oldNumContributors"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. ",(0,n.jsx)(s.code,{children:"newNumContributors"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above. "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is A."})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"A: Option A is understandably ambiguous: if withdrawals were working, then you could have an existing contributor be recognized as a new one. Nevertheless, in its current state, we can take it to emit for only legitimately new contributors."}),"\n",(0,n.jsxs)(s.li,{children:["B: Generally, it's not save to make assumptions about the evaluation order of expressions in Solidity. How obscure this can be especially for event emissions has been shown in last year's ",(0,n.jsx)(s.a,{href:"https://github.com/ethereum/solidity-underhanded-contest/blob/master/2022/submissions_2022/submission9_TynanRichards/SPOILERS.md",children:"Underhanded Solidity contest"}),': "The indexed parameters are evaluated first in right-to-left order, then the non-indexed parameters are evaluated left-to-right". Because of this, the general best practice is to avoid nested expressions whenever possible and do them within separate lines of code.']}),"\n",(0,n.jsxs)(s.li,{children:["C: One of the most common gas optimizations seen in Code4rena reports is how the prefix increment (",(0,n.jsx)(s.code,{children:"++i"}),") is more efficient than postfix (",(0,n.jsx)(s.code,{children:"i++"}),"). However, most aren't aware of a key difference: Prefix increments returns the value AFTER the increment, postfix returns the value BEFORE."]}),"\n"]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-5-of-8",children:"Question 5 of 8"}),"\n",(0,n.jsx)(s.p,{children:"The vault deployer can pause the following functions:"}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. ",(0,n.jsx)(s.code,{children:"deposit()"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. ",(0,n.jsx)(s.code,{children:"withdraw()"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. ",(0,n.jsx)(s.code,{children:"requestAllowance()"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is D."})}),(0,n.jsx)(s.p,{children:"The contract can't be paused because the pause and unpause functionality aren't exposed."}),(0,n.jsx)(s.p,{children:"Author notes: Sort of a trick question that requires knowledge about the Pausable contract. As mentioned in the Spearbit community workshop I gave recently, it can be difficult to spot what's absent, not just what's present."})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-6-of-8",children:"Question 6 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["What is the largest possible allowance given to the ",(0,n.jsx)(s.code,{children:"controller"}),"?"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. 40% of ",(0,n.jsx)(s.code,{children:"totalContributionCap"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. 60% of ",(0,n.jsx)(s.code,{children:"totalContributionCap"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. 100% of ",(0,n.jsx)(s.code,{children:"totalContributionCap"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Unbounded "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is C."})}),(0,n.jsxs)(s.p,{children:["The allowance is only capped as long as the specified ",(0,n.jsx)(s.code,{children:"amount"})," is larger the current ",(0,n.jsx)(s.code,{children:"totalContributions"}),". That means as soon as the ",(0,n.jsx)(s.code,{children:"totalContributions"})," are larger than ",(0,n.jsx)(s.code,{children:"ALLOWANCE_CAP"}),", it's possible to give an allowance of 100%."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-7-of-8",children:"Question 7 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"requestAllowance()"})," implementation would have failed after the 1st call for tokens that only allow zero to non-zero allowances. Which of the following mitigations do NOT work?"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. ",(0,n.jsx)(s.code,{children:"safeApprove(0)"})," followed by ",(0,n.jsx)(s.code,{children:"safeApprove(type(uint256).max)"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. ",(0,n.jsx)(s.code,{children:"safeIncreaseAllowance(type(uint256).max)"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. ",(0,n.jsx)(s.code,{children:"safeIncreaseAllowance(0)"})," followed by ",(0,n.jsx)(s.code,{children:"safeIncreaseAllowance(type(uint256).max)"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. ",(0,n.jsx)(s.code,{children:"safeDecreaseAllowance(0)"})," followed by ",(0,n.jsx)(s.code,{children:"safeApprove(type(uint256).max)"})," "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is B, C, D."})}),(0,n.jsx)(s.p,{children:"There are some implementations of ERC20 tokens that require an approval to be reset to 0 before it can be updated to another non-zero value."}),(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"safeIncreaseAllowance()"})," / ",(0,n.jsx)(s.code,{children:"safeDecreaseAllowance()"})," functions request the current allowance, adding/subtracting the specified amount and then update it by calling ",(0,n.jsx)(s.code,{children:"approve()"}),". These functions do not set the approval to 0 in between, so for these tokens the function would still fail after the 1st call."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-8-of-8",children:"Question 8 of 8"}),"\n",(0,n.jsx)(s.p,{children:"Which of the following gas optimizations are relevant in reducing runtime gas costs for the vault contract?"}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Changing ",(0,n.jsx)(s.code,{children:"ALLOWANCE_CAP"})," type from ",(0,n.jsx)(s.code,{children:"immutable"})," to ",(0,n.jsx)(s.code,{children:"constant"}),", ie. ",(0,n.jsx)(s.code,{children:"uint256 public constant ALLOWANCE_CAP = 40 * uint256(TOTAL_CONTRIBUTION_CAP) / 100;"})," "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Increase number of solc ",(0,n.jsx)(s.code,{children:"runs"})," (assuming default was ",(0,n.jsx)(s.code,{children:"200 runs"}),") "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Renaming functions so that the most used functions have smaller method IDs "]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Use unchecked math in ",(0,n.jsx)(s.code,{children:"withdraw()"})," "]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is B, (C)."})}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["A: Changing ",(0,n.jsx)(s.code,{children:"ALLOWANCE_CAP"})," to be ",(0,n.jsx)(s.code,{children:"constant"})," would actually consume more runtime gas as the expression would then be evaluated on every call, while with ",(0,n.jsx)(s.code,{children:"immutable"})," the expression would be calculated during deployment and then become a static value. (Note that there's no difference between these options anymore when the via-IR compilation pipeline and optimization is used)."]}),"\n",(0,n.jsxs)(s.li,{children:["B: Increasing the optimizer's ",(0,n.jsx)(s.code,{children:"runs"})," configuration will increase the deployment bytecode size but decrease the gas usage at runtime."]}),"\n",(0,n.jsxs)(s.li,{children:["C: (The smaller the function's ID the earlier it can be found by the function selector.) – In hindsight, this is not entirely true: Including the public variable getters, the Vault contract has 9 function signatures exposed. For contracts with more than 4 function IDs the Solidity compiler starts using a ",(0,n.jsx)(s.a,{href:"https://github.com/0xArcturus/binarysearch/",children:"binary search algorithm"})," instead of using a sorted-if-then selector. So in the case of the Vault contract, there's no guarantee that renaming the functions in the described manner would actually ensure reduced runtime costs for all of the most used functions. It's still true that the function with the lowest ID will have the shortest path (one pivot, on EQ), but the same is not guaranteed for the other functions."]}),"\n",(0,n.jsxs)(s.li,{children:["D: It wouldn't be safe to use unchecked math in the ",(0,n.jsx)(s.code,{children:"withdraw()"})," function as it would potentially allow users to withdraw more than they should be able to. (The wording is intended to imply that the entire function's body would be put into an unchecked block.)"]}),"\n"]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n","\n",(0,n.jsxs)(o.oy,{children:[(0,n.jsx)(o.Zb,{icon:(0,n.jsx)(u.H8,{}),title:"← RACE #16 Of The Secureum Bootcamp Epoch∞",href:"/posts/2023/4/1/race-16-of-the-secureum-bootcamp-epoch-infinity/"}),(0,n.jsx)(o.Zb,{icon:(0,n.jsx)(u.H8,{}),title:"RACE #18 Of The Secureum Bootcamp Epoch∞ →",href:"/posts/2023/5/29/race-18-of-the-secureum-bootcamp-epoch-infinity"})]})]})}s.default=(0,r.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,c.a)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/2023/5/1/race-17-of-the-secureum-bootcamp-epoch-infinity.mdx",route:"/posts/2023/5/1/race-17-of-the-secureum-bootcamp-epoch-infinity",timestamp:1731290394e3,title:"RACE #17 Of The Secureum Bootcamp Epoch∞",headings:x},pageNextRoute:"/posts/2023/5/1/race-17-of-the-secureum-bootcamp-epoch-infinity"})},96139:function(e,s,t){var n=t(94869);t(26228);var i=t(70079),a=i&&"object"==typeof i&&"default"in i?i:{default:i};function _defineProperties(e,s){for(var t=0;t<s.length;t++){var n=s[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=void 0!==n&&n.env&&!0,isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},c=function(){function StyleSheet(e){var s=void 0===e?{}:e,t=s.name,n=void 0===t?"stylesheet":t,i=s.optimizeForSpeed,a=void 0===i?r:i;invariant$1(isString(n),"`name` must be a string"),this._name=n,this._deletedRulePlaceholder="#"+n+"-deleted-rule____{}",invariant$1("boolean"==typeof a,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=a,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var c=document.querySelector('meta[property="csp-nonce"]');this._nonce=c?c.getAttribute("content"):null}var e,s=StyleSheet.prototype;return s.setOptimizeForSpeed=function(e){invariant$1("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),invariant$1(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(invariant$1(!this._injected,"sheet already injected"),this._injected=!0,this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(r||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(s,t){return"number"==typeof t?e._serverSheet.cssRules[t]={cssText:s}:e._serverSheet.cssRules.push({cssText:s}),t},deleteRule:function(s){e._serverSheet.cssRules[s]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].ownerNode===e)return document.styleSheets[s]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,s){if(invariant$1(isString(e),"`insertRule` accepts only strings"),this._optimizeForSpeed){var t=this.getSheet();"number"!=typeof s&&(s=t.cssRules.length);try{t.insertRule(e,s)}catch(s){return r||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var n=this._tags[s];this._tags.push(this.makeStyleTag(this._name,e,n))}return this._rulesCount++},s.replaceRule=function(e,s){if(this._optimizeForSpeed){var t=this.getSheet();if(s.trim()||(s=this._deletedRulePlaceholder),!t.cssRules[e])return e;t.deleteRule(e);try{t.insertRule(s,e)}catch(n){r||console.warn("StyleSheet: illegal rule: \n\n"+s+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),t.insertRule(this._deletedRulePlaceholder,e)}}else{var n=this._tags[e];invariant$1(n,"old rule at index `"+e+"` not found"),n.textContent=s}return e},s.deleteRule=function(e){if(this._optimizeForSpeed)this.replaceRule(e,"");else{var s=this._tags[e];invariant$1(s,"rule at index `"+e+"` not found"),s.parentNode.removeChild(s),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]},s.cssRules=function(){var e=this;return this._tags.reduce(function(s,t){return t?s=s.concat(Array.prototype.map.call(e.getSheetForTag(t).cssRules,function(s){return s.cssText===e._deletedRulePlaceholder?null:s})):s.push(null),s},[])},s.makeStyleTag=function(e,s,t){s&&invariant$1(isString(s),"makeStyleTag accepts only strings as second parameter");var n=document.createElement("style");this._nonce&&n.setAttribute("nonce",this._nonce),n.type="text/css",n.setAttribute("data-"+e,""),s&&n.appendChild(document.createTextNode(s));var i=document.head||document.getElementsByTagName("head")[0];return t?i.insertBefore(n,t):i.appendChild(n),n},_defineProperties(StyleSheet.prototype,[{key:"length",get:function(){return this._rulesCount}}]),e&&_defineProperties(StyleSheet,e),StyleSheet}();function invariant$1(e,s){if(!e)throw Error("StyleSheet: "+s+".")}var stringHash=function(e){for(var s=5381,t=e.length;t;)s=33*s^e.charCodeAt(--t);return s>>>0},o={};function computeId(e,s){if(!s)return"jsx-"+e;var t=String(s),n=e+t;return o[n]||(o[n]="jsx-"+stringHash(e+"-"+t)),o[n]}function computeSelector(e,s){var t=e+s;return o[t]||(o[t]=s.replace(/__jsx-style-dynamic-selector/g,e)),o[t]}var l=function(){function StyleSheetRegistry(e){var s=void 0===e?{}:e,t=s.styleSheet,n=void 0===t?null:t,i=s.optimizeForSpeed,a=void 0!==i&&i;this._sheet=n||new c({name:"styled-jsx",optimizeForSpeed:a}),this._sheet.inject(),n&&"boolean"==typeof a&&(this._sheet.setOptimizeForSpeed(a),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var e=StyleSheetRegistry.prototype;return e.add=function(e){var s=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,s){return e[s]=0,e},{}));var t=this.getIdAndRules(e),n=t.styleId,i=t.rules;if(n in this._instancesCounts){this._instancesCounts[n]+=1;return}var a=i.map(function(e){return s._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[n]=a,this._instancesCounts[n]=1},e.remove=function(e){var s=this,t=this.getIdAndRules(e).styleId;if(function(e,s){if(!e)throw Error("StyleSheetRegistry: "+s+".")}(t in this._instancesCounts,"styleId: `"+t+"` not found"),this._instancesCounts[t]-=1,this._instancesCounts[t]<1){var n=this._fromServer&&this._fromServer[t];n?(n.parentNode.removeChild(n),delete this._fromServer[t]):(this._indices[t].forEach(function(e){return s._sheet.deleteRule(e)}),delete this._indices[t]),delete this._instancesCounts[t]}},e.update=function(e,s){this.add(s),this.remove(e)},e.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},e.cssRules=function(){var e=this,s=this._fromServer?Object.keys(this._fromServer).map(function(s){return[s,e._fromServer[s]]}):[],t=this._sheet.cssRules();return s.concat(Object.keys(this._indices).map(function(s){return[s,e._indices[s].map(function(e){return t[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},e.styles=function(e){var s,t;return s=this.cssRules(),void 0===(t=e)&&(t={}),s.map(function(e){var s=e[0],n=e[1];return a.default.createElement("style",{id:"__"+s,key:"__"+s,nonce:t.nonce?t.nonce:void 0,dangerouslySetInnerHTML:{__html:n}})})},e.getIdAndRules=function(e){var s=e.children,t=e.dynamic,n=e.id;if(t){var i=computeId(n,t);return{styleId:i,rules:Array.isArray(s)?s.map(function(e){return computeSelector(i,e)}):[computeSelector(i,s)]}}return{styleId:computeId(n),rules:Array.isArray(s)?s:[s]}},e.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,s){return e[s.id.slice(2)]=s,e},{})},StyleSheetRegistry}(),h=i.createContext(null);h.displayName="StyleSheetContext";var d=a.default.useInsertionEffect||a.default.useLayoutEffect,u=new l;function JSXStyle(e){var s=u||i.useContext(h);return s&&d(function(){return s.add(e),function(){s.remove(e)}},[e.id,String(e.dynamic)]),null}JSXStyle.dynamic=function(e){return e.map(function(e){return computeId(e[0],e[1])}).join(" ")},s.style=JSXStyle},65910:function(e,s,t){"use strict";e.exports=t(96139).style},26228:function(){}},function(e){e.O(0,[3220,1589,9774,2888,179],function(){return e(e.s=48598)}),_N_E=e.O()}]);