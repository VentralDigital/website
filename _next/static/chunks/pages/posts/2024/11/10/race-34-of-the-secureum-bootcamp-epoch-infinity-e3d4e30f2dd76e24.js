(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5992],{96877:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2024/11/10/race-34-of-the-secureum-bootcamp-epoch-infinity",function(){return a(45581)}])},64751:function(e,s){"use strict";s.Z={src:"/_next/static/media/secureum-banner.b3ad8557.jpg",height:630,width:1200,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAEAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAbEAACAgMBAAAAAAAAAAAAAAAAAgEDBCEyE//EABUBAQEAAAAAAAAAAAAAAAAAAAQF/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAwDAQACEQMRAD8AnGFcviyPjUWS1PTJuOtgAcT9auj/2Q==",blurWidth:8,blurHeight:4}},45581:function(e,s,a){"use strict";a.r(s),a.d(s,{HiddenSolution:function(){return HiddenSolution},__toc:function(){return m}});var n=a(35250),t=a(65910),i=a.n(t),l=a(47147),c=a(77298),r=a(18363),o=a(30746),h=a.n(o),d=a(64751),x=a(13423);function HiddenSolution(e){let{children:s}=e,a=Object.assign({details:"details",summary:"summary",strong:"strong",div:"div"},(0,c.a)());return(0,n.jsxs)(a.details,{closed:!0,className:"last-of-type:mb-0 rounded-lg bg-neutral-50 dark:bg-neutral-800 p-2 mt-4",children:[(0,n.jsx)(a.summary,{children:(0,n.jsx)(a.strong,{className:"text-lg",children:"Solution"})}),(0,n.jsx)(a.div,{className:"nx-p-2",children:s})]})}let m=[{depth:3,value:"Code",id:"code"},{depth:3,value:"Question 1 of 8",id:"question-1-of-8"},{depth:3,value:"Question 2 of 8",id:"question-2-of-8"},{depth:3,value:"Question 3 of 8",id:"question-3-of-8"},{depth:3,value:"Question 4 of 8",id:"question-4-of-8"},{depth:3,value:"Question 5 of 8",id:"question-5-of-8"},{depth:3,value:"Question 6 of 8",id:"question-6-of-8"},{depth:3,value:"Question 7 of 8",id:"question-7-of-8"},{depth:3,value:"Question 8 of 8",id:"question-8-of-8"}];function _createMdxContent(e){let s=Object.assign({h1:"h1",p:"p",a:"a",strong:"strong",hr:"hr",h3:"h3",pre:"pre",code:"code",span:"span",math:"math",semantics:"semantics",mrow:"mrow",mi:"mi",annotation:"annotation",mo:"mo",mfrac:"mfrac",mn:"mn",ul:"ul",li:"li",blockquote:"blockquote"},(0,c.a)(),e.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{children:"RACE #34 Of The Secureum Bootcamp Epoch∞"}),"\n","\n",(0,n.jsxs)(h(),{children:[(0,n.jsx)("meta",{property:"og:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"}),(0,n.jsx)("meta",{name:"twitter:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"})]}),"\n",(0,n.jsxs)(s.p,{children:["This is a Write-Up of RACE-34, Quiz of the ",(0,n.jsx)(s.a,{href:"https://twitter.com/0xRajeev/status/1470910752085065731",children:"Secureum Bootcamp"})," for Ethereum Smart Contract Auditors. This month's RACE was designed by Secureum Mentor and Independent Security Researcher ",(0,n.jsx)(s.a,{href:"https://x.com/milotruck",children:"MiloTruck"}),"."]}),"\n",(0,n.jsxs)(r.UW,{type:"info",children:[(0,n.jsxs)(s.p,{children:["Participants of this quiz had a single attempt to ",(0,n.jsx)(s.strong,{children:"answer 8 questions within the strict time limit of 16 minutes"}),". If you’re reading this in preparation for participating yourself, it’s best to give it a try under the same time limit!"]}),(0,n.jsx)(s.p,{children:"As usual, I waited for submissions to close before publishing it and, to stay true to the original, I omitted syntax highlighting. Feel free to copy it into your favorite editor, but do so after starting the timer!"})]}),"\n",(0,n.jsxs)("p",{className:"jsx-ea2c409626c7be76 text-xs text-right",children:["November 10, 2024 by ",(0,n.jsx)(s.a,{href:"/about#patrickd",children:"patrickd"})]}),"\n",(0,n.jsx)(i(),{id:"ea2c409626c7be76",children:"input[type=checkbox].jsx-ea2c409626c7be76{width:15px;height:15px}li.jsx-ea2c409626c7be76{padding:.5em}"}),"\n","\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"code",children:"Code"}),"\n",(0,n.jsx)(r.UW,{type:"info",children:(0,n.jsx)(s.p,{children:"All 8 questions are based on the following contract."})}),"\n",(0,n.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",filename:"CrossChainMessenger.sol",children:(0,n.jsxs)(s.code,{"data-line-numbers":"","data-language":"plaintext","data-theme":"default","data-line-numbers-max-digits":"3",children:[(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// SPDX-License-Identifier: UNLICENSED"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"pragma solidity 0.8.20;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"library SafeCall {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function safeCall(address _to, uint256 _gas, bytes memory _data) external returns (bool _success) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        assembly {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            _success := call(_gas, _to, 0, add(_data, 32), mload(_data), 0, 0)"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function unsafeCall(address _to, uint256 _gas, bytes memory _data) internal returns (bytes memory) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        assembly {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            let _success := call(_gas, _to, 0, add(_data, 32), mload(_data), 0, 0)"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            // Copy return data"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            returndatacopy(0, 0, returndatasize())"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            // Revert on error, otherwise return data from the call"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            switch _success"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            case 0 { revert(0, returndatasize()) }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            default { return(0, returndatasize()) }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"/*"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"Assume this contract is part of a cross-chain messaging protocol."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"A message is sent from a source to destination chain as follows:"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"1. Users call sendMessage() on the source chain to send a message."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"2. The protocol reads the MessageSent event emitted from sendMessage() offchain."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"3. The protocol calls relayMessage() on the destination chain with the same message."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"*/"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract CrossChainMessenger is Ownable(msg.sender) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    event MessageSent(Message message);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    struct Message {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        address sender;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        address to;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        uint256 gas;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        bytes data;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    uint256 public constant MAXIMUM_GAS_LIMIT = 100_000;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    uint256 public constant GAS_BUFFER = 40_000;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    mapping(bytes32 => bool) public failedMessages;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    /**"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @notice Send a message from the source chain."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     *"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @param to   Address that receives the message on the destination chain."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @param gas  Minimum amount of gas sent to the receiver."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @param data Calldata the receiver is called with."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     */"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function sendMessage(address to, uint256 gas, bytes memory data) external {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        Message memory message = Message({sender: msg.sender, to: to, gas: gas, data: data});"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        emit MessageSent(message);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    /**"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @notice Receive a message on the destination chain."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     *"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @param message Message struct containing the sender, receiver, gas and calldata."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     */"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function relayMessage(Message calldata message) external onlyOwner {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        require(gasleft() >= (message.gas * 64) / 63 + GAS_BUFFER, "Insufficient gas");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        bool success = SafeCall.safeCall(message.to, message.gas, message.data);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        if (!success) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            bytes32 messageHash = keccak256(abi.encode(message));"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            failedMessages[messageHash] = true;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    /**"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @notice Replay a message that failed execution in relayMessage()."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     *"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @param message Message struct containing the sender, receiver, gas and calldata."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     */"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function replayMessage(Message calldata message) public {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        require(msg.sender == message.sender || msg.sender == message.to, "Not sender or receiver");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        bytes32 messageHash = keccak256(abi.encode(message));"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        require(failedMessages[messageHash], "Invalid message");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        require(gasleft() >= (message.gas * 64) / 63 + GAS_BUFFER, "Insufficient gas");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        bool success = SafeCall.safeCall(message.to, message.gas, message.data);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'        require(success, "Message execution failed");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        failedMessages[messageHash] = false;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    /**"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @notice Forcefully replay failed messages."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     *"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     * @param messages An array of message structs to execute."})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"     */"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    function forceReplayMessages(Message[] calldata messages) external onlyOwner {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        for (uint256 i; i < messages.length; i++) {"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            Message memory message = messages[i];"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            bytes32 messageHash = keccak256(abi.encode(message));"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'            require(failedMessages[messageHash], "Invalid message");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            failedMessages[messageHash] = false;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            uint256 gasLimit = message.gas < MAXIMUM_GAS_LIMIT ? message.gas : MAXIMUM_GAS_LIMIT;"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'            require(gasleft() >= (gasLimit * 64) / 63 + GAS_BUFFER, "Insufficient gas");'})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            SafeCall.unsafeCall(message.to, gasLimit, message.data);"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,n.jsx)(s.span,{className:"line",children:(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,n.jsx)(s.h3,{id:"question-1-of-8",children:"Question 1 of 8"}),"\n",(0,n.jsx)(s.p,{children:"The protocol facilitates cross-chain messaging by:"}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Transmitting messages sent from a source chain to the receiver on a destination chain through ",(0,n.jsx)(s.code,{children:"relayMessage()"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Allowing messages that revert during execution in ",(0,n.jsx)(s.code,{children:"relayMessage()"})," to be re-executed in ",(0,n.jsx)(s.code,{children:"replayMessage()"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Allowing anyone to execute failed messages in ",(0,n.jsx)(s.code,{children:"replayMessage()"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Allowing the protocol to execute failed messages on anyone’s behalf."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is A, B, D."})}),(0,n.jsxs)(s.p,{children:["This is a giveaway question meant to test the participant's understanding of the contract. From looking at the code, A, B and D are clearly true. C is incorrect according to the first require statement within ",(0,n.jsx)(s.code,{children:"replayMessage()"}),"."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-2-of-8",children:"Question 2 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["In ",(0,n.jsx)(s.code,{children:"relayMessage()"}),", the ",(0,n.jsx)(s.code,{children:"gasleft()"})," check multiplies ",(0,n.jsx)(s.code,{children:"message.gas"})," by 64 / 63 to:"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Avoid rounding errors due to division in Solidity rounding down."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Account for the reduction in gas passed to a callee due to EIP-150."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Reserve sufficient gas for the function to complete execution after ",(0,n.jsx)(s.code,{children:"safeCall()"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Provide extra gas in case the message sender specifies too little gas."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is B."})}),(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.a,{href:"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-150.md",children:"EIP-150"}),' standard indeed defines the "send all but one 64th" gas rule: It dictates that only 63/64 of the currently remaining gas is passed to a callee.']}),(0,n.jsx)(s.p,{children:"The question is whether the check truly accounts for the reduction in gas passed to the callee:"}),(0,n.jsx)(s.pre,{"data-language":"solidity","data-theme":"default",children:(0,n.jsx)(s.code,{"data-language":"solidity","data-theme":"default",children:(0,n.jsxs)(s.span,{className:"line",children:[(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"require"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(gasleft() "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:">="}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (message.gas "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"*"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"64"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"63"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"+"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" GAS_BUFFER"}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"Insufficient gas"'}),(0,n.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]})})}),(0,n.jsxs)(s.p,{children:["Let's say we specify ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsx)(s.mrow,{children:(0,n.jsx)(s.mi,{children:"y"})}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"{y}"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"})})]})})]})," as gas amount sent during the ",(0,n.jsx)(s.code,{children:"CALL"}),". Then the actual gas received by the callee is ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsx)(s.mi,{children:"y"}),(0,n.jsx)(s.mo,{children:"⋅"}),(0,n.jsxs)(s.mfrac,{children:[(0,n.jsx)(s.mn,{children:"63"}),(0,n.jsx)(s.mn,{children:"64"})]})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"{y}\\cdot\\frac{{63}}{{64}}"})]})})}),(0,n.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.1944em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"})}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(s.span,{className:"mbin",children:"⋅"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"1.1901em",verticalAlign:"-0.345em"}}),(0,n.jsxs)(s.span,{className:"mord",children:[(0,n.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,n.jsx)(s.span,{className:"mfrac",children:(0,n.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(s.span,{className:"vlist-r",children:[(0,n.jsxs)(s.span,{className:"vlist",style:{height:"0.8451em"},children:[(0,n.jsxs)(s.span,{style:{top:"-2.655em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:"64"})})})})]}),(0,n.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,n.jsxs)(s.span,{style:{top:"-3.394em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:"63"})})})})]})]}),(0,n.jsx)(s.span,{className:"vlist-s",children:"​"})]}),(0,n.jsx)(s.span,{className:"vlist-r",children:(0,n.jsx)(s.span,{className:"vlist",style:{height:"0.345em"},children:(0,n.jsx)(s.span,{})})})]})}),(0,n.jsx)(s.span,{className:"mclose nulldelimiter"})]})]})]})]}),". But we want this received amount to be exactly ",(0,n.jsx)(s.code,{children:"message.gas"}),", let's call it ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsx)(s.mrow,{children:(0,n.jsx)(s.mi,{children:"x"})}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"{x}"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",children:"x"})})]})})]}),", then ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsx)(s.mi,{children:"y"}),(0,n.jsx)(s.mo,{children:"⋅"}),(0,n.jsxs)(s.mfrac,{children:[(0,n.jsx)(s.mn,{children:"63"}),(0,n.jsx)(s.mn,{children:"64"})]}),(0,n.jsx)(s.mo,{children:"="}),(0,n.jsx)(s.mi,{children:"x"})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"{y}\\cdot\\frac{{63}}{{64}}={x}"})]})})}),(0,n.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.6389em",verticalAlign:"-0.1944em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"})}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(s.span,{className:"mbin",children:"⋅"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"1.1901em",verticalAlign:"-0.345em"}}),(0,n.jsxs)(s.span,{className:"mord",children:[(0,n.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,n.jsx)(s.span,{className:"mfrac",children:(0,n.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(s.span,{className:"vlist-r",children:[(0,n.jsxs)(s.span,{className:"vlist",style:{height:"0.8451em"},children:[(0,n.jsxs)(s.span,{style:{top:"-2.655em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:"64"})})})})]}),(0,n.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,n.jsxs)(s.span,{style:{top:"-3.394em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:"63"})})})})]})]}),(0,n.jsx)(s.span,{className:"vlist-s",children:"​"})]}),(0,n.jsx)(s.span,{className:"vlist-r",children:(0,n.jsx)(s.span,{className:"vlist",style:{height:"0.345em"},children:(0,n.jsx)(s.span,{})})})]})}),(0,n.jsx)(s.span,{className:"mclose nulldelimiter"})]}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(s.span,{className:"mrel",children:"="}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",children:"x"})})]})]})]}),". By solving for ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsx)(s.mrow,{children:(0,n.jsx)(s.mi,{children:"y"})}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"{y}"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"})})]})})]})," we will obtain the gas amount we'd have to specify for ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsx)(s.mrow,{children:(0,n.jsx)(s.mi,{children:"x"})}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"{x}"})]})})}),(0,n.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",children:"x"})})]})})]})," to arrive at the callee: ",(0,n.jsxs)(s.span,{className:"katex",children:[(0,n.jsx)(s.span,{className:"katex-mathml",children:(0,n.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,n.jsxs)(s.semantics,{children:[(0,n.jsxs)(s.mrow,{children:[(0,n.jsx)(s.mi,{children:"y"}),(0,n.jsx)(s.mo,{children:"="}),(0,n.jsx)(s.mi,{children:"x"}),(0,n.jsx)(s.mo,{children:"⋅"}),(0,n.jsxs)(s.mfrac,{children:[(0,n.jsx)(s.mn,{children:"64"}),(0,n.jsx)(s.mn,{children:"53"})]})]}),(0,n.jsx)(s.annotation,{encoding:"application/x-tex",children:"{y}={x}\\cdot\\frac{{64}}{{53}}"})]})})}),(0,n.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"})}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,n.jsx)(s.span,{className:"mrel",children:"="}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"0.4445em"}}),(0,n.jsx)(s.span,{className:"mord",children:(0,n.jsx)(s.span,{className:"mord mathnormal",children:"x"})}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,n.jsx)(s.span,{className:"mbin",children:"⋅"}),(0,n.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,n.jsxs)(s.span,{className:"base",children:[(0,n.jsx)(s.span,{className:"strut",style:{height:"1.1901em",verticalAlign:"-0.345em"}}),(0,n.jsxs)(s.span,{className:"mord",children:[(0,n.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,n.jsx)(s.span,{className:"mfrac",children:(0,n.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,n.jsxs)(s.span,{className:"vlist-r",children:[(0,n.jsxs)(s.span,{className:"vlist",style:{height:"0.8451em"},children:[(0,n.jsxs)(s.span,{style:{top:"-2.655em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:"53"})})})})]}),(0,n.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,n.jsxs)(s.span,{style:{top:"-3.394em"},children:[(0,n.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,n.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:(0,n.jsx)(s.span,{className:"mord mtight",children:"64"})})})})]})]}),(0,n.jsx)(s.span,{className:"vlist-s",children:"​"})]}),(0,n.jsx)(s.span,{className:"vlist-r",children:(0,n.jsx)(s.span,{className:"vlist",style:{height:"0.345em"},children:(0,n.jsx)(s.span,{})})})]})}),(0,n.jsx)(s.span,{className:"mclose nulldelimiter"})]})]})]})]}),". This matches with the ",(0,n.jsx)(s.code,{children:"require()"})," statement."]}),(0,n.jsxs)(s.p,{children:["If you're wondering whether checks like this actually happen in practice, you can search for the require statement on ",(0,n.jsx)(s.a,{href:"https://www.codeslaw.app/contracts/arbitrum/0x41675c099f32341bf84bfc5382af534df5c7461a?file=eth_0xfd0732dc9e303f09fcef3a7388ad10a83459ec99_code%2Fcontracts%2FSafe.sol&start=197",children:"codeslaw"})," and find many projects where it's used."]}),(0,n.jsxs)(s.p,{children:["This check indeed also reserves sufficient gas for the function to complete after ",(0,n.jsx)(s.code,{children:"safeCall()"}),", but it does so using the ",(0,n.jsx)(s.code,{children:"GAS_BUFFER"}),". This is not related to the multiplication by 64 / 63 as the question suggests."]}),(0,n.jsx)(s.p,{children:"(Answers A and D are fillers)"})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-3-of-8",children:"Question 3 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["In ",(0,n.jsx)(s.code,{children:"relayMessage()"}),", the external call to ",(0,n.jsx)(s.code,{children:"message.to"})," may receive less gas than ",(0,n.jsx)(s.code,{children:"message.gas"})," because:"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Calling ",(0,n.jsx)(s.code,{children:"safeCall()"})," performs a delegate call, which reduces the gas remaining by 1/64."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Calling ",(0,n.jsx)(s.code,{children:"safeCall()"})," performs an internal call, which consumes gas for a few opcodes."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Copying message from calldata to memory when calling ",(0,n.jsx)(s.code,{children:"safeCall()"})," consumes gas."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above, the ",(0,n.jsx)(s.code,{children:"gasleft()"})," check ensures sufficient gas is always passed to the callee."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is A, C."})}),(0,n.jsxs)(s.p,{children:["There's an ",(0,n.jsx)(s.a,{href:"https://eip2535diamonds.substack.com/p/the-difference-between-solidity-libraries",children:"important difference"}),' in how external functions of Solidity libraries are handled compared to internal functions: Internal functions are "inlined" into the contract calling it, in other words, the functions bytecode is added to the calling contract and the call is a ',(0,n.jsx)(s.code,{children:"JUMP"}),". On the other hand, external functions of libraries are deployed within a separate contract. When a contract makes a call to such an external library function, it does so using the ",(0,n.jsx)(s.code,{children:"DELEGATECALL"})," opcode."]}),(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["Therefore ",(0,n.jsx)(s.code,{children:"safeCall()"})," indeed performs a delegate call while ",(0,n.jsx)(s.code,{children:"unsafeCall()"})," performs an internal call."]}),"\n",(0,n.jsxs)(s.li,{children:["And EIP-150 applies to ",(0,n.jsx)(s.a,{href:"https://www.evm.codes/?fork=cancun#f4",children:(0,n.jsx)(s.code,{children:"DELEGATECALL"})}),"s as well."]}),"\n",(0,n.jsxs)(s.li,{children:["Additionally, calling ",(0,n.jsx)(s.code,{children:"safeCall()"})," requires copying ",(0,n.jsx)(s.code,{children:"message"})," (declared with data location ",(0,n.jsx)(s.code,{children:"calldata"})," in ",(0,n.jsx)(s.code,{children:"CrossChainMessenger"}),"'s functions) from calldata to memory before the call can be executed with the message data as parameter."]}),"\n",(0,n.jsxs)(s.li,{children:["For large ",(0,n.jsx)(s.code,{children:"message.data"})," this copy operation could indeed consume more gas than anticipated by ",(0,n.jsx)(s.code,{children:"GAS_BUFFER"}),"."]}),"\n"]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-4-of-8",children:"Question 4 of 8"}),"\n",(0,n.jsx)(s.p,{children:"A failed message may never be executed if:"}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Trying to execute the message in ",(0,n.jsx)(s.code,{children:"replayMessage()"})," fails once."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. A sender sends multiple messages with the exact same ",(0,n.jsx)(s.code,{children:"Message"})," struct without checking if execution in ",(0,n.jsx)(s.code,{children:"relayMessage()"})," was successful."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. The message was sent with empty ",(0,n.jsx)(s.code,{children:"message.data"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above, a sender can always call ",(0,n.jsx)(s.code,{children:"replayMessage()"})," to retry a failed message."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is B."})}),(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["There is no way to uniquely identify two messages with the exact same ",(0,n.jsx)(s.code,{children:"sender"}),", ",(0,n.jsx)(s.code,{children:"to"}),", ",(0,n.jsx)(s.code,{children:"gas"})," and ",(0,n.jsx)(s.code,{children:"data"}),". If multiple messages with the same Message struct are sent, they will all have the same ",(0,n.jsx)(s.code,{children:"messageHash"})," when being stored in the ",(0,n.jsx)(s.code,{children:"failedMessages"})," mapping. Therefore, ",(0,n.jsx)(s.code,{children:"replayMessage()"})," can only be called once, even though multiple messages failed."]}),"\n"]}),(0,n.jsxs)(s.p,{children:["A and C are filler answers: A message is only removed from the ",(0,n.jsx)(s.code,{children:"failedMessages"})," mapping if the replay succeeded. The ",(0,n.jsx)(s.code,{children:"message.data"})," being empty has no impact on the ability to replay messages."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-5-of-8",children:"Question 5 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["If ",(0,n.jsx)(s.code,{children:"replayMessage()"})," could only be called by ",(0,n.jsx)(s.code,{children:"message.sender"})," (i.e. no ",(0,n.jsx)(s.code,{children:"msg.sender == message.to"})," condition check in ",(0,n.jsx)(s.code,{children:"require()"}),"), it would be problematic because:"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. There is no way to verify if the caller of ",(0,n.jsx)(s.code,{children:"sendMessage()"})," is the address that calls ",(0,n.jsx)(s.code,{children:"replayMessage()"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. An EOA that calls ",(0,n.jsx)(s.code,{children:"sendMessage()"})," on a source chain cannot call ",(0,n.jsx)(s.code,{children:"replayMessage()"})," on the destination chain as EOAs are chain-specific."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Messages sent from contracts that directly call ",(0,n.jsx)(s.code,{children:"sendMessage()"})," may not be replayable if execution fails."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above, there are no issues with the current implementation."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is C."})}),(0,n.jsxs)(s.p,{children:["Unless a contract's deployment was ",(0,n.jsx)(s.a,{href:"https://medium.com/patronum-labs/nicks-method-ethereum-keyless-execution-168a6659479c",children:"specifically prepared"})," for this, it's unlikely for a contract to have the same address across different chains. In such cases, messages sent from contracts that directly call ",(0,n.jsx)(s.code,{children:"sendMessage()"})," may not be replayable if execution fails when requiring ",(0,n.jsx)(s.code,{children:"msg.sender == message.sender"})," alone."]}),(0,n.jsxs)(s.p,{children:["With the additional ",(0,n.jsx)(s.code,{children:"msg.sender == message.to"})," condition the receiver is able to replay the message in such cases."]}),(0,n.jsxs)(s.p,{children:["A and B are filler answers: You can obviously keep track of the ",(0,n.jsx)(s.code,{children:"msg.sender"})," values, and EOAs are not chain-specific and can be used across chains."]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-6-of-8",children:"Question 6 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["Is ",(0,n.jsx)(s.code,{children:"replayMessage()"})," susceptible to reentrancy?"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. No, the ",(0,n.jsx)(s.code,{children:"gasleft()"})," check prevents any state changes from occurring in a reentrant call."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. No, the ",(0,n.jsx)(s.code,{children:"failedMessages[messageHash]"})," check prevents any reentrancy attacks."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Yes, reentrancy can be used to block the execution of future messages."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Yes, reentrancy can be used to execute a single failed message multiple times."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is D."})}),(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["Notice how ",(0,n.jsx)(s.code,{children:"failedMessages[messageHash]"})," is reset to false only after ",(0,n.jsx)(s.code,{children:"safeCall()"}),". Executing a failed message multiple times can be achieved by re-entering ",(0,n.jsx)(s.code,{children:"replayMessage()"})," in ",(0,n.jsx)(s.code,{children:"safeCall()"}),"."]}),"\n"]}),(0,n.jsxs)(s.p,{children:["A possible scenario where this could be exploited would be if the protocol receiving the message makes an unsafe external call to an untrusted contract. Such a malicious contract could then re-enter ",(0,n.jsx)(s.code,{children:"replayMessage()"})," before ",(0,n.jsx)(s.code,{children:"safeCall()"})," has returned, causing the protocol to be called once again with the same message. A protocol assuming that each message may only arrive once could benefit the attacker by eg. rewarding them twice."]}),(0,n.jsx)(s.p,{children:"C isn't possible and A, B are filler answers that are unrelated to reentrancy."})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-7-of-8",children:"Question 7 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["When ",(0,n.jsx)(s.code,{children:"forceReplayMessages()"})," is called, it should not revert. However, a receiver contract (i.e. ",(0,n.jsx)(s.code,{children:"message.to"}),") can force the function to revert by:"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Reverting in the function called by ",(0,n.jsx)(s.code,{children:"unsafeCall()"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Returning ",(0,n.jsx)(s.code,{children:"false"})," in the function called by ",(0,n.jsx)(s.code,{children:"unsafeCall()"}),"."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Consuming all the remaining gas in the function called by ",(0,n.jsx)(s.code,{children:"unsafeCall()"})," without reverting."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Performing a return bomb attack (i.e. return a huge chunk of data, causing ",(0,n.jsx)(s.code,{children:"forceReplayMessage()"})," to consume more gas than the block gas limit)."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is A."})}),(0,n.jsxs)(s.p,{children:["While ",(0,n.jsx)(s.code,{children:"safeCall()"})," returns a boolean depending on whether the ",(0,n.jsx)(s.code,{children:"CALL"})," was successful, the ",(0,n.jsx)(s.code,{children:"unsafeCall()"}),' function will "bubble up" the callee\'s revert causing ',(0,n.jsx)(s.code,{children:"forceReplayMessages()"})," to revert. If the callee returns ",(0,n.jsx)(s.code,{children:"false"})," instead of reverting it is simply treated as returned data."]}),(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["Assuming that ",(0,n.jsx)(s.code,{children:"forceReplayMessage()"})," is called with sufficient gas to execute all messages, the gas limit on each message prevents any execution from consuming all remaining gas in ",(0,n.jsx)(s.code,{children:"forceReplayMessages()"}),"."]}),"\n"]}),(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["D is a trick option. Although ",(0,n.jsx)(s.code,{children:"unsafeCall()"})," reads an unbounded amount of data from the called function, only a maximum of 100,000 gas is passed to the called function. Due to the memory expansion cost, the function will not be able to create a huge chunk of data in memory to be returned, hence a return bomb attack is not possible."]}),"\n"]})]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsx)(s.h3,{id:"question-8-of-8",children:"Question 8 of 8"}),"\n",(0,n.jsxs)(s.p,{children:["When ",(0,n.jsx)(s.code,{children:"forceReplayMessages()"})," is called with multiple messages, it will:"]}),"\n",(0,n.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Execute all messages in the ",(0,n.jsx)(s.code,{children:"messages"})," array."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Always revert when trying to execute the first message."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Execute all messages in the ",(0,n.jsx)(s.code,{children:"messages"})," array and revert after the last call."]}),(0,n.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,n.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Only execute the first message in the ",(0,n.jsx)(s.code,{children:"messages"})," array."]})]}),"\n",(0,n.jsxs)(HiddenSolution,{children:[(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Correct is D."})}),(0,n.jsxs)(s.p,{children:["At a first glance, it may appear that it is correctly looping through all messages, but the problem is that ",(0,n.jsx)(s.code,{children:"unsafeCall()"})," is not making use of a regular (Solidity) ",(0,n.jsx)(s.code,{children:"return"})," statement, but rather executes the ",(0,n.jsx)(s.code,{children:"RETURN"})," opcode which will exit the currently executed contract and not simply return to the calling function. Remember that, ",(0,n.jsx)(s.code,{children:"unsafeCall()"})," being\nan internal library function, it is not externally-called but instead inlined into the ",(0,n.jsx)(s.code,{children:"CrossChainMessenger"})," contract. Therefore, when ",(0,n.jsx)(s.code,{children:"forceReplayMessages()"})," calls ",(0,n.jsx)(s.code,{children:"unsafeCall()"})," it will ",(0,n.jsx)(s.code,{children:"JUMP"})," to the function's bytecode which will then terminate execution with ",(0,n.jsx)(s.code,{children:"RETURN"})," instead of jumping back to ",(0,n.jsx)(s.code,{children:"forceReplayMessages()"}),"'s bytecode."]}),(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["A PoC demonstrating this can be found here: ",(0,n.jsx)(s.a,{href:"https://gist.github.com/MiloTruck/837ecb49fe18901d70bf03241548768b",children:"https://gist.github.com/MiloTruck/837ecb49fe18901d70bf03241548768b"})]}),"\n"]}),(0,n.jsx)(s.p,{children:"(Answers B and C are fillers)"})]}),"\n",(0,n.jsx)(s.hr,{}),"\n","\n",(0,n.jsxs)(r.oy,{children:[(0,n.jsx)(r.Zb,{icon:(0,n.jsx)(x.H8,{}),title:"← RACE #33 Of The Secureum Bootcamp Epoch∞",href:"/posts/2024/10/1/race-33-of-the-secureum-bootcamp-epoch-infinity/"}),(0,n.jsx)(r.Zb,{icon:(0,n.jsx)(x.H8,{}),title:"RACE #35 Of The Secureum Bootcamp Epoch∞ →",href:"/posts/2024/12/10/race-35-of-the-secureum-bootcamp-epoch-infinity"})]})]})}s.default=(0,l.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,c.a)(),e.components);return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/2024/11/10/race-34-of-the-secureum-bootcamp-epoch-infinity.mdx",route:"/posts/2024/11/10/race-34-of-the-secureum-bootcamp-epoch-infinity",timestamp:173381166e4,title:"RACE #34 Of The Secureum Bootcamp Epoch∞",headings:m},pageNextRoute:"/posts/2024/11/10/race-34-of-the-secureum-bootcamp-epoch-infinity"})},96139:function(e,s,a){var n=a(94869);a(26228);var t=a(70079),i=t&&"object"==typeof t&&"default"in t?t:{default:t};function _defineProperties(e,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=void 0!==n&&n.env&&!0,isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},c=function(){function StyleSheet(e){var s=void 0===e?{}:e,a=s.name,n=void 0===a?"stylesheet":a,t=s.optimizeForSpeed,i=void 0===t?l:t;invariant$1(isString(n),"`name` must be a string"),this._name=n,this._deletedRulePlaceholder="#"+n+"-deleted-rule____{}",invariant$1("boolean"==typeof i,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=i,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var c=document.querySelector('meta[property="csp-nonce"]');this._nonce=c?c.getAttribute("content"):null}var e,s=StyleSheet.prototype;return s.setOptimizeForSpeed=function(e){invariant$1("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),invariant$1(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(invariant$1(!this._injected,"sheet already injected"),this._injected=!0,this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(l||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(s,a){return"number"==typeof a?e._serverSheet.cssRules[a]={cssText:s}:e._serverSheet.cssRules.push({cssText:s}),a},deleteRule:function(s){e._serverSheet.cssRules[s]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].ownerNode===e)return document.styleSheets[s]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,s){if(invariant$1(isString(e),"`insertRule` accepts only strings"),this._optimizeForSpeed){var a=this.getSheet();"number"!=typeof s&&(s=a.cssRules.length);try{a.insertRule(e,s)}catch(s){return l||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var n=this._tags[s];this._tags.push(this.makeStyleTag(this._name,e,n))}return this._rulesCount++},s.replaceRule=function(e,s){if(this._optimizeForSpeed){var a=this.getSheet();if(s.trim()||(s=this._deletedRulePlaceholder),!a.cssRules[e])return e;a.deleteRule(e);try{a.insertRule(s,e)}catch(n){l||console.warn("StyleSheet: illegal rule: \n\n"+s+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),a.insertRule(this._deletedRulePlaceholder,e)}}else{var n=this._tags[e];invariant$1(n,"old rule at index `"+e+"` not found"),n.textContent=s}return e},s.deleteRule=function(e){if(this._optimizeForSpeed)this.replaceRule(e,"");else{var s=this._tags[e];invariant$1(s,"rule at index `"+e+"` not found"),s.parentNode.removeChild(s),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]},s.cssRules=function(){var e=this;return this._tags.reduce(function(s,a){return a?s=s.concat(Array.prototype.map.call(e.getSheetForTag(a).cssRules,function(s){return s.cssText===e._deletedRulePlaceholder?null:s})):s.push(null),s},[])},s.makeStyleTag=function(e,s,a){s&&invariant$1(isString(s),"makeStyleTag accepts only strings as second parameter");var n=document.createElement("style");this._nonce&&n.setAttribute("nonce",this._nonce),n.type="text/css",n.setAttribute("data-"+e,""),s&&n.appendChild(document.createTextNode(s));var t=document.head||document.getElementsByTagName("head")[0];return a?t.insertBefore(n,a):t.appendChild(n),n},_defineProperties(StyleSheet.prototype,[{key:"length",get:function(){return this._rulesCount}}]),e&&_defineProperties(StyleSheet,e),StyleSheet}();function invariant$1(e,s){if(!e)throw Error("StyleSheet: "+s+".")}var stringHash=function(e){for(var s=5381,a=e.length;a;)s=33*s^e.charCodeAt(--a);return s>>>0},r={};function computeId(e,s){if(!s)return"jsx-"+e;var a=String(s),n=e+a;return r[n]||(r[n]="jsx-"+stringHash(e+"-"+a)),r[n]}function computeSelector(e,s){var a=e+s;return r[a]||(r[a]=s.replace(/__jsx-style-dynamic-selector/g,e)),r[a]}var o=function(){function StyleSheetRegistry(e){var s=void 0===e?{}:e,a=s.styleSheet,n=void 0===a?null:a,t=s.optimizeForSpeed,i=void 0!==t&&t;this._sheet=n||new c({name:"styled-jsx",optimizeForSpeed:i}),this._sheet.inject(),n&&"boolean"==typeof i&&(this._sheet.setOptimizeForSpeed(i),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var e=StyleSheetRegistry.prototype;return e.add=function(e){var s=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,s){return e[s]=0,e},{}));var a=this.getIdAndRules(e),n=a.styleId,t=a.rules;if(n in this._instancesCounts){this._instancesCounts[n]+=1;return}var i=t.map(function(e){return s._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[n]=i,this._instancesCounts[n]=1},e.remove=function(e){var s=this,a=this.getIdAndRules(e).styleId;if(function(e,s){if(!e)throw Error("StyleSheetRegistry: "+s+".")}(a in this._instancesCounts,"styleId: `"+a+"` not found"),this._instancesCounts[a]-=1,this._instancesCounts[a]<1){var n=this._fromServer&&this._fromServer[a];n?(n.parentNode.removeChild(n),delete this._fromServer[a]):(this._indices[a].forEach(function(e){return s._sheet.deleteRule(e)}),delete this._indices[a]),delete this._instancesCounts[a]}},e.update=function(e,s){this.add(s),this.remove(e)},e.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},e.cssRules=function(){var e=this,s=this._fromServer?Object.keys(this._fromServer).map(function(s){return[s,e._fromServer[s]]}):[],a=this._sheet.cssRules();return s.concat(Object.keys(this._indices).map(function(s){return[s,e._indices[s].map(function(e){return a[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},e.styles=function(e){var s,a;return s=this.cssRules(),void 0===(a=e)&&(a={}),s.map(function(e){var s=e[0],n=e[1];return i.default.createElement("style",{id:"__"+s,key:"__"+s,nonce:a.nonce?a.nonce:void 0,dangerouslySetInnerHTML:{__html:n}})})},e.getIdAndRules=function(e){var s=e.children,a=e.dynamic,n=e.id;if(a){var t=computeId(n,a);return{styleId:t,rules:Array.isArray(s)?s.map(function(e){return computeSelector(t,e)}):[computeSelector(t,s)]}}return{styleId:computeId(n),rules:Array.isArray(s)?s:[s]}},e.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,s){return e[s.id.slice(2)]=s,e},{})},StyleSheetRegistry}(),h=t.createContext(null);h.displayName="StyleSheetContext";var d=i.default.useInsertionEffect||i.default.useLayoutEffect,x=new o;function JSXStyle(e){var s=x||t.useContext(h);return s&&d(function(){return s.add(e),function(){s.remove(e)}},[e.id,String(e.dynamic)]),null}JSXStyle.dynamic=function(e){return e.map(function(e){return computeId(e[0],e[1])}).join(" ")},s.style=JSXStyle},65910:function(e,s,a){"use strict";e.exports=a(96139).style},26228:function(){}},function(e){e.O(0,[3220,1589,9774,2888,179],function(){return e(e.s=96877)}),_N_E=e.O()}]);