(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8183],{58556:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/2024/3/4/race-27-of-the-secureum-bootcamp-epoch-infinity",function(){return n(64645)}])},64751:function(e,s){"use strict";s.Z={src:"/_next/static/media/secureum-banner.b3ad8557.jpg",height:630,width:1200,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAEAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAbEAACAgMBAAAAAAAAAAAAAAAAAgEDBCEyE//EABUBAQEAAAAAAAAAAAAAAAAAAAQF/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAwDAQACEQMRAD8AnGFcviyPjUWS1PTJuOtgAcT9auj/2Q==",blurWidth:8,blurHeight:4}},64645:function(e,s,n){"use strict";n.r(s),n.d(s,{HiddenSolution:function(){return HiddenSolution},__toc:function(){return p}});var t=n(35250),i=n(65910),a=n.n(i),l=n(47147),r=n(77298),c=n(18363),o=n(30746),h=n.n(o),d=n(64751),x=n(13423);function HiddenSolution(e){let{children:s}=e,n=Object.assign({details:"details",summary:"summary",strong:"strong",div:"div"},(0,r.a)());return(0,t.jsxs)(n.details,{closed:!0,className:"last-of-type:mb-0 rounded-lg bg-neutral-50 dark:bg-neutral-800 p-2 mt-4",children:[(0,t.jsx)(n.summary,{children:(0,t.jsx)(n.strong,{className:"text-lg",children:"Solution"})}),(0,t.jsx)(n.div,{className:"nx-p-2",children:s})]})}let p=[{depth:3,value:"Code",id:"code"},{depth:3,value:"Question 1 of 8",id:"question-1-of-8"},{depth:3,value:"Question 2 of 8",id:"question-2-of-8"},{depth:3,value:"Question 3 of 8",id:"question-3-of-8"},{depth:3,value:"Question 4 of 8",id:"question-4-of-8"},{depth:3,value:"Question 5 of 8",id:"question-5-of-8"},{depth:3,value:"Question 6 of 8",id:"question-6-of-8"},{depth:3,value:"Question 7 of 8",id:"question-7-of-8"},{depth:3,value:"Question 8 of 8",id:"question-8-of-8"}];function _createMdxContent(e){let s=Object.assign({h1:"h1",p:"p",a:"a",strong:"strong",hr:"hr",h3:"h3",pre:"pre",code:"code",span:"span"},(0,r.a)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{children:"RACE #27 Of The Secureum Bootcamp Epoch∞"}),"\n","\n",(0,t.jsxs)(h(),{children:[(0,t.jsx)("meta",{property:"og:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"}),(0,t.jsx)("meta",{name:"twitter:image",content:"https://ventral.digital"+d.Z.src,className:"jsx-ea2c409626c7be76"})]}),"\n",(0,t.jsxs)(s.p,{children:["This is a Write-Up of RACE-27, Quiz of the ",(0,t.jsx)(s.a,{href:"https://twitter.com/0xRajeev/status/1470910752085065731",children:"Secureum Bootcamp"})," for Ethereum Smart Contract Auditors. It was designed by the Secureum Mentor ",(0,t.jsx)(s.a,{href:"https://twitter.com/GalloDaSballo",children:"Alex The Entreprenerd"}),", Security Researcher at Spearbit, Judge at Code4rena and former Smart Contract Developer at BadgerDAO."]}),"\n",(0,t.jsxs)(c.UW,{type:"info",children:[(0,t.jsxs)(s.p,{children:["Participants of this quiz had to ",(0,t.jsx)(s.strong,{children:"answer 8 questions within the strict time limit of 16 minutes"}),". If you’re reading this in preparation for participating yourself, it’s best to give it a try under the same time limit!"]}),(0,t.jsx)(s.p,{children:"As usual, I waited for submissions to close before publishing it and, to stay true to the original, I omitted syntax highlighting. Feel free to copy it into your favorite editor, but do so after starting the timer!"})]}),"\n",(0,t.jsxs)("p",{className:"jsx-ea2c409626c7be76 text-xs text-right",children:["March 4, 2024 by ",(0,t.jsx)(s.a,{href:"/about#patrickd",children:"patrickd"})]}),"\n",(0,t.jsx)(a(),{id:"ea2c409626c7be76",children:"input[type=checkbox].jsx-ea2c409626c7be76{width:15px;height:15px}li.jsx-ea2c409626c7be76{padding:.5em}"}),"\n","\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"code",children:"Code"}),"\n",(0,t.jsx)(c.UW,{type:"info",children:(0,t.jsx)(s.p,{children:"All 8 questions in this RACE are based on the code snippet below, which was shown for all questions."})}),"\n",(0,t.jsx)(s.pre,{"data-language":"plaintext","data-theme":"default",children:(0,t.jsxs)(s.code,{"data-line-numbers":"","data-language":"plaintext","data-theme":"default","data-line-numbers-max-digits":"3",children:[(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"// SPDX-License-Identifier: GPL-2.0"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"pragma solidity 0.8.20;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import "@openzeppelin@4.8.3/contracts/utils/Multicall.sol";'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import "@openzeppelin@4.8.3/contracts/metatx/ERC2771Context.sol";'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'import "@openzeppelin@4.8.3/contracts/security/ReentrancyGuard.sol";'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"interface IToken {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function transfer(address, uint256) external returns (bool);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function approve(address, uint256) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function balanceOf(address) external view returns (uint256);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"interface ISwapper {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function swap(address tokenIn, address tokenOut, uint256 amountIn, uint256 amountOutMin) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"interface IStrategy {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function want() external view returns (address);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function reward() external view returns (address);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract Controller is Multicall, ERC2771Context {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   address immutable OWNER;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   mapping(address => bool) isStrategy;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   mapping(address => bool) isDivested;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   mapping(address => mapping(address => bool)) allowedSwap;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   mapping(address => uint256) lastSafeBalanceOfWant;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   constructor(address owner, address trustedForwarder_) ERC2771Context(trustedForwarder_) public {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       OWNER = owner;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   modifier onlyOwner() {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(_msgSender() == OWNER, "onlyOwner");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       _;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function registerStrategy(address strategy) external onlyOwner returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       address want = IStrategy(strategy).want();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       address reward = IStrategy(strategy).reward();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(!allowedSwap[reward][want], "Cannot add same swap route");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       allowedSwap[reward][want] = true;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       isStrategy[strategy] = true;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   /** Multicallable Operations */"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function divest(address strategy, uint256 amt, uint256 minOut) external onlyOwner returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(isStrategy[strategy], "Must be registered");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(!isDivested[strategy], "Must be Invested!");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       isDivested[strategy] = true;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       bool healthCheck = Strategy(strategy).shouldDivest();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(healthCheck, "Must be in emergency");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       Strategy(strategy).divest(amt, minOut);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       lastSafeBalanceOfWant[strategy] = IToken(Strategy(strategy).want()).balanceOf(strategy);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function invest(address strategy, uint256 minOut) external onlyOwner returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       require(isDivested[strategy]);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(isStrategy[strategy], "Must be registered");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken token = IToken(address(IStrategy(strategy).want()));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 amt = token.balanceOf(address(this));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       require(amt >= lastSafeBalanceOfWant[strategy]); // Ensure we didn't lose value on divest"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       token.transfer(strategy, amt);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       Strategy(strategy).invest(amt, minOut);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       isDivested[strategy] = false;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function harvestSwap(ISwapper swapper, address tokenIn, address tokenOut, uint256 amountIn, uint256 amountOutMin, address strategy)"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       external"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       onlyOwner"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       returns (uint256)"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:'       require(allowedSwap[tokenIn][tokenOut], "Must be allowed");'})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken reward = IToken(address(IStrategy(strategy).reward()));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken want = IToken(address(IStrategy(strategy).want()));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       require(address(reward) == tokenIn);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       require(address(want) == tokenOut);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken(address(tokenIn)).approve(address(swapper), 0);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken(address(tokenIn)).approve(address(swapper), amountIn);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       swapper.swap(tokenIn, tokenOut, amountIn, amountOutMin);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       want.transfer(strategy, want.balanceOf(address(this)));       "})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"interface ICurvePool {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // Add with WETH"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function add_liquidity(uint256[] memory amounts, uint256 min_mint_amount) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function remove_liquidity(uint256 _amount, uint256[] memory _min_amounts) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function remove_liquidity_one_coin(uint256 token_amount, uint256 i, uint256 min_amount) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function exchange(uint256 i, uint256 j, uint256 dx, uint256 min_dy, bool useETh) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function balances(uint256) external view returns (uint256);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function D() external returns (uint256);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function virtual_price() external returns (uint256);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function get_virtual_price() external returns (uint256);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function totalSupply() external view returns (uint256);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"interface IGauge {   "})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function balanceOf(address) external view returns (uint256);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function deposit(uint256) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function withdraw(uint256) external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function claim_rewards() external;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"contract Strategy is ReentrancyGuard {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   address public immutable CONTROLLER;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   address public immutable want;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   address public immutable reward;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint256 constant PRECISION = 1e18; // 50%"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint256 constant IDLE_AMOUNT = 5; // 5%"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint256 constant IDLE_PRECISION = 100; // 5%"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // https://arbiscan.io/address/0x82aF49447D8a07e3bd95BD0d56f35241523fBab1"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   uint256 constant WETH_INDEX = 2;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // https://arbiscan.io/address/0x960ea3e3C7FB317332d990873d354E18d7645590"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   ICurvePool pool = ICurvePool(0x960ea3e3C7FB317332d990873d354E18d7645590);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   IGauge gauge = IGauge(0x555766f3da968ecBefa690Ffd49A2Ac02f47aa5f);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   constructor(address controller, address _want, address _reward) public {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       CONTROLLER = controller;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       want = _want;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       reward = _reward;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken(_want).approve(address(pool), type(uint256).max);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken(address(pool)).approve(address(gauge), type(uint256).max);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   modifier onlyController() {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       require(msg.sender == CONTROLLER);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       _;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function idleBalance() public view returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       return IToken(want).balanceOf(address(this));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function balanceInPool() public view returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       return IToken(address(gauge)).balanceOf(address(this));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function balanceOfRewards() public view returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       return IToken(reward).balanceOf(address(this));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // Get Total Value we would have if we withdrew WETH"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function investedBalance() external view returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint128 bal_1 = uint128(pool.balances(WETH_INDEX));"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 calculatedBalance = bal_1 * PRECISION * balanceInPool() / pool.totalSupply() / PRECISION;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       return calculatedBalance;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   // We should divest when something goes wrong, avoids bricking the pool"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function shouldDivest() external view returns (bool) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       try this.investedBalance() {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           return false;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       } catch {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           return true; // Divest if something goes wrong"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       return false;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function invest(uint256 amt, uint256 minMint) external nonReentrant onlyController returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 toKeep = idleBalance() * IDLE_AMOUNT / IDLE_PRECISION;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 toDeposit = idleBalance() - toKeep;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256[] memory amounts = new uint256[](3);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       amounts[WETH_INDEX] = toDeposit;"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 initialBal = balanceInPool();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       pool.add_liquidity(amounts, minMint);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 afterBal = balanceInPool();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       gauge.deposit(afterBal - initialBal);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function divest(uint256 amt, uint256 minOut) external nonReentrant onlyController returns (uint256) {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       gauge.withdraw(amt);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 initialBal = idleBalance();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       pool.remove_liquidity_one_coin(amt, WETH_INDEX, minOut);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 afterBal = idleBalance();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken(reward).transfer(address(CONTROLLER), afterBal - initialBal);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   function harvest() external nonReentrant {"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       // Increases"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 prevBalRewards = balanceOfRewards();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       gauge.claim_rewards();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       uint256 afterBalReward = balanceOfRewards();"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"       IToken(reward).transfer(address(CONTROLLER), afterBalReward - prevBalRewards);"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   }"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})}),"\n",(0,t.jsx)(s.span,{className:"line",children:(0,t.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})})]})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-1-of-8",children:"Question 1 of 8"}),"\n",(0,t.jsx)(s.p,{children:"Functions depositing and withdrawing from the Gauge:"}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Should use a reentrancy guard "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Should have a ",(0,t.jsx)(s.code,{children:"minOut"})," parameter "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Should verify that we have sufficient balance before making the call "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Are perfectly safe because it's an official Curve gauge "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is D."})}),(0,t.jsxs)(s.p,{children:["A: The ",(0,t.jsx)(s.code,{children:"invest()"})," and ",(0,t.jsx)(s.code,{children:"divest()"})," functions, which are the only ones depositing or withdrawing from the gauge, are already using a reentrancy guard thanks to the ",(0,t.jsx)(s.code,{children:"nonReentrant"})," modifier. This option implies that such a guard was missing, which is incorrect and makes this option false."]}),(0,t.jsxs)(s.p,{children:["B: The ",(0,t.jsx)(s.code,{children:"divest()"})," function already has such a parameter, for the ",(0,t.jsx)(s.code,{children:"invest()"})," function its called ",(0,t.jsx)(s.code,{children:"minMint"})," instead. Again both already have it, while the option implies that its missing. It can furthermore be noted that gauge contracts have no slippage, so these parameters aren't actually related to the fact that the gauge is being called."]}),(0,t.jsx)(s.p,{children:"C: Since the gauge does not want to get scammed, it'll check whether we have sufficient balance for us and there's no need to check this before making the call. If we had insufficient balance it would revert."}),(0,t.jsx)(s.p,{children:"D: The gauge used is hardcoded and is indeed an official Curve gauge which will behave as expected by this code."})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-2-of-8",children:"Question 2 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["The function ",(0,t.jsx)(s.code,{children:"shouldDivest"}),":"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Can never return ",(0,t.jsx)(s.code,{children:"true"})," as the ",(0,t.jsx)(s.code,{children:"investedBalance"})," function will not revert "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Can revert because ",(0,t.jsx)(s.code,{children:"this"})," may be ",(0,t.jsx)(s.code,{children:"selfdestructed"})," when we ",(0,t.jsx)(s.code,{children:"delegatecall"})," to a ",(0,t.jsx)(s.code,{children:"proxy"})," "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Can never return ",(0,t.jsx)(s.code,{children:"true"})," because the catch clause doesn't catch ",(0,t.jsx)(s.code,{children:"Bytes Error"})," "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is D."})}),(0,t.jsxs)(s.p,{children:["A: The ",(0,t.jsx)(s.code,{children:"investedBalance()"})," function will revert when the ",(0,t.jsx)(s.code,{children:"uint256"})," value returned by ",(0,t.jsx)(s.code,{children:"balanceInPool()"})," is too large to fit into ",(0,t.jsx)(s.code,{children:"uint128"})," when multiplied in ",(0,t.jsx)(s.code,{children:"bal_1 * PRECISION * balanceInPool()"}),". This is because the expression is casted to ",(0,t.jsx)(s.code,{children:"uint128"})," because of ",(0,t.jsx)(s.code,{children:"bal_1"}),", the fact that it is back-cast to ",(0,t.jsx)(s.code,{children:"uint256"})," in the end does not matter."]}),(0,t.jsx)(s.p,{children:"B: Random gibberish option."}),(0,t.jsxs)(s.p,{children:["C: The ",(0,t.jsx)(s.code,{children:"} catch {"}),' will catch all errors, even if it is  some "',(0,t.jsx)(s.code,{children:"Bytes Error"}),"\", because it's not specifying anything specific that it is trying to catch."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-3-of-8",children:"Question 3 of 8"}),"\n",(0,t.jsx)(s.p,{children:"The owner can:"}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Steal all funds by withdrawing them to a malicious strategy "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Lose their private key "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Be impersonated due to Multicall and Meta Transactions support "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Set only one strategy per ",(0,t.jsx)(s.code,{children:"reward"})," and ",(0,t.jsx)(s.code,{children:"want"})," combination "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A, B, C."})}),(0,t.jsxs)(s.p,{children:["A: The owner is capable of arbitrarily adding new strategies, and using ",(0,t.jsx)(s.code,{children:"invest()"})," and ",(0,t.jsx)(s.code,{children:"divest()"})," to move funds between them. A malicious owner could indeed simply add a strategy that allows stealing all of the funds after moving them there."]}),(0,t.jsx)(s.p,{children:"B: Protocol owners can indeed lose their private key, a simple and true statement. Sadly it happens all the time, or is used to cover up a rug pull. Since this is off-chain operational security, it's hard to tell and often not much thought is put into preventing it."}),(0,t.jsxs)(s.p,{children:["C: Account Impersonation is indeed possible through combining ERC-2771 and Multicall with the used version of OpenZeppelin which does not contain the appropriate fix yet. If you're unfamiliar with this bug, take a look at the detailed ",(0,t.jsx)(s.a,{href:"https://ventral.digital/posts/2024/1/19/ethereum-smart-contract-auditors-2023-rewind/#erc-2771--multicall--account-impersonation",children:"write-up about it"})," in the Ethereum Smart Contract Auditor's 2023 Rewind."]}),(0,t.jsxs)(s.p,{children:["D: While there's code that prevents adding the same swap route in ",(0,t.jsx)(s.code,{children:"allowedSwap"}),", this check is directional. Even if ",(0,t.jsx)(s.code,{children:"[reward][want]"})," has already been set, there's always a second combination involving both of these values that is still allowed (basically ",(0,t.jsx)(s.code,{children:"[want][reward]"}),")."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-4-of-8",children:"Question 4 of 8"}),"\n",(0,t.jsx)(s.p,{children:"The System is:"}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Using a swapper to allow custom swaps in the future "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. A Template system for generating NFTs "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Using a Controller and a Strategy where the Controller can work with only one strategy "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A."})}),(0,t.jsx)(s.p,{children:'A: It indeed appears to be using a "swapper".'}),(0,t.jsx)(s.p,{children:"B: Just random gibberish again."}),(0,t.jsx)(s.p,{children:"C: The controller appears to work with many Strategies."})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-5-of-8",children:"Question 5 of 8"}),"\n",(0,t.jsx)(s.p,{children:"The Strategy:"}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Cannot be forced to invest and divest due to ownership checks in the ",(0,t.jsx)(s.code,{children:"Controller"})," "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Can be made to lose all of its rewards by claiming on behalf of the strategy "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Can be made to lose all of its rewards because the reward token is Fee-on-Transfer "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Can send tokens to the wrong address "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A, B."})}),(0,t.jsx)(s.p,{children:"A: These operations are indeed permissioned by an ownership check."}),(0,t.jsxs)(s.p,{children:["B: Is true when exploiting a gauge ",(0,t.jsx)(s.a,{href:"https://github.com/code-423n4/2023-07-tapioca-findings/issues/1429",children:"loss-of-yield attack"}),"."]}),(0,t.jsx)(s.p,{children:"C/D: More gibberish."})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-6-of-8",children:"Question 6 of 8"}),"\n",(0,t.jsx)(s.p,{children:"Harvest for the Strategy:"}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Will claim reward tokens and send them to the Controller "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Doesn't use ",(0,t.jsx)(s.code,{children:"safeTransfer"})," and so it will revert "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. ",(0,t.jsx)(s.code,{children:"transfer"})," will not revert because the reward token is known "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Can overflow via a donation during gauge execution that requires no changes in the external contracts "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A, C."})}),(0,t.jsx)(s.p,{children:"A: That's indeed what the code appears to do."}),(0,t.jsxs)(s.p,{children:["B/C: The token we're calling ",(0,t.jsx)(s.code,{children:"transfer()"})," on is a hardcoded Curve token that is known to work as expected by this code. A ",(0,t.jsx)(s.code,{children:"safeTransfer"})," wrapper would only be necessary if it's unknown how the used token handles errors."]}),(0,t.jsx)(s.p,{children:"D: You guessed it, gibberish it is."})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-7-of-8",children:"Question 7 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["The mapping ",(0,t.jsx)(s.code,{children:"lastSafeBalanceOfWant[strategy]"}),":"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Is always zero"]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Should be zero if no direct donation has happened"]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Will track the balance of ",(0,t.jsx)(s.code,{children:"want"})," of the controller"]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. Will prevent sweep exploits in invest"]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is B."})}),(0,t.jsxs)(s.p,{children:["As you can tell from the code comment, the way that ",(0,t.jsx)(s.code,{children:"lastSafeBalanceOfWant[strategy]"})," is currently used is incorrect and should be swapped."]}),(0,t.jsx)(s.p,{children:"A/B: Although it is most likely to be zero indeed, it can't be said that it's always zero because there's the possibility that a \"direct donation\" (ie. a injection of funds) happened."}),(0,t.jsx)(s.p,{children:"C: It's not tracking as intended since setting the mapping's value and checking it are swapped."}),(0,t.jsx)(s.p,{children:"D: Incorrect, this offers no protection."})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"question-8-of-8",children:"Question 8 of 8"}),"\n",(0,t.jsxs)(s.p,{children:["The function ",(0,t.jsx)(s.code,{children:"invest"}),":"]}),"\n",(0,t.jsxs)("ul",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," A. Allows the owner to deposit want, convert it into Tricrypto LP and stake in the gauge "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," B. Allows an attacker to deposit in the wrong strategy "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," C. Allows an attacker to cause loss of  value because ",(0,t.jsx)(s.code,{children:"lastSafeBalanceOfWant[strategy]"})," is ineffective "]}),(0,t.jsxs)("li",{className:"jsx-ea2c409626c7be76",children:[(0,t.jsx)("input",{type:"checkbox",className:"jsx-ea2c409626c7be76"})," D. None of the above "]})]}),"\n",(0,t.jsxs)(HiddenSolution,{children:[(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Correct is A, B, C."})}),(0,t.jsxs)(s.p,{children:["A: That's factually what it does. You can see that it's indeed \"Tricrypto LP\" by checking the gauge's token tracker in ",(0,t.jsx)(s.a,{href:"https://arbiscan.io/address/0x555766f3da968ecBefa690Ffd49A2Ac02f47aa5f",children:"arbiscan"}),"."]}),(0,t.jsxs)(s.p,{children:["B/C: Both are possible thanks to the ERC-2771 + Multicall bug mentioned in ",(0,t.jsx)(s.a,{href:"#question-3-of-8",children:"Question 3"})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n","\n",(0,t.jsxs)(c.oy,{children:[(0,t.jsx)(c.Zb,{icon:(0,t.jsx)(x.H8,{}),title:"← RACE #26 Of The Secureum Bootcamp Epoch∞",href:"/posts/2024/1/30/race-26-of-the-secureum-bootcamp-epoch-infinity/"}),(0,t.jsx)(c.Zb,{icon:(0,t.jsx)(x.H8,{}),title:"RACE #28 Of The Secureum Bootcamp Epoch∞ →",href:"/posts/2024/4/2/race-28-of-the-secureum-bootcamp-epoch-infinity"})]})]})}s.default=(0,l.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,r.a)(),e.components);return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/2024/3/4/race-27-of-the-secureum-bootcamp-epoch-infinity.mdx",route:"/posts/2024/3/4/race-27-of-the-secureum-bootcamp-epoch-infinity",timestamp:1731290394e3,title:"RACE #27 Of The Secureum Bootcamp Epoch∞",headings:p},pageNextRoute:"/posts/2024/3/4/race-27-of-the-secureum-bootcamp-epoch-infinity"})},96139:function(e,s,n){var t=n(94869);n(26228);var i=n(70079),a=i&&"object"==typeof i&&"default"in i?i:{default:i};function _defineProperties(e,s){for(var n=0;n<s.length;n++){var t=s[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var l=void 0!==t&&t.env&&!0,isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},r=function(){function StyleSheet(e){var s=void 0===e?{}:e,n=s.name,t=void 0===n?"stylesheet":n,i=s.optimizeForSpeed,a=void 0===i?l:i;invariant$1(isString(t),"`name` must be a string"),this._name=t,this._deletedRulePlaceholder="#"+t+"-deleted-rule____{}",invariant$1("boolean"==typeof a,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=a,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var r=document.querySelector('meta[property="csp-nonce"]');this._nonce=r?r.getAttribute("content"):null}var e,s=StyleSheet.prototype;return s.setOptimizeForSpeed=function(e){invariant$1("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),invariant$1(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(invariant$1(!this._injected,"sheet already injected"),this._injected=!0,this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(l||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(s,n){return"number"==typeof n?e._serverSheet.cssRules[n]={cssText:s}:e._serverSheet.cssRules.push({cssText:s}),n},deleteRule:function(s){e._serverSheet.cssRules[s]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var s=0;s<document.styleSheets.length;s++)if(document.styleSheets[s].ownerNode===e)return document.styleSheets[s]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,s){if(invariant$1(isString(e),"`insertRule` accepts only strings"),this._optimizeForSpeed){var n=this.getSheet();"number"!=typeof s&&(s=n.cssRules.length);try{n.insertRule(e,s)}catch(s){return l||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var t=this._tags[s];this._tags.push(this.makeStyleTag(this._name,e,t))}return this._rulesCount++},s.replaceRule=function(e,s){if(this._optimizeForSpeed){var n=this.getSheet();if(s.trim()||(s=this._deletedRulePlaceholder),!n.cssRules[e])return e;n.deleteRule(e);try{n.insertRule(s,e)}catch(t){l||console.warn("StyleSheet: illegal rule: \n\n"+s+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),n.insertRule(this._deletedRulePlaceholder,e)}}else{var t=this._tags[e];invariant$1(t,"old rule at index `"+e+"` not found"),t.textContent=s}return e},s.deleteRule=function(e){if(this._optimizeForSpeed)this.replaceRule(e,"");else{var s=this._tags[e];invariant$1(s,"rule at index `"+e+"` not found"),s.parentNode.removeChild(s),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]},s.cssRules=function(){var e=this;return this._tags.reduce(function(s,n){return n?s=s.concat(Array.prototype.map.call(e.getSheetForTag(n).cssRules,function(s){return s.cssText===e._deletedRulePlaceholder?null:s})):s.push(null),s},[])},s.makeStyleTag=function(e,s,n){s&&invariant$1(isString(s),"makeStyleTag accepts only strings as second parameter");var t=document.createElement("style");this._nonce&&t.setAttribute("nonce",this._nonce),t.type="text/css",t.setAttribute("data-"+e,""),s&&t.appendChild(document.createTextNode(s));var i=document.head||document.getElementsByTagName("head")[0];return n?i.insertBefore(t,n):i.appendChild(t),t},_defineProperties(StyleSheet.prototype,[{key:"length",get:function(){return this._rulesCount}}]),e&&_defineProperties(StyleSheet,e),StyleSheet}();function invariant$1(e,s){if(!e)throw Error("StyleSheet: "+s+".")}var stringHash=function(e){for(var s=5381,n=e.length;n;)s=33*s^e.charCodeAt(--n);return s>>>0},c={};function computeId(e,s){if(!s)return"jsx-"+e;var n=String(s),t=e+n;return c[t]||(c[t]="jsx-"+stringHash(e+"-"+n)),c[t]}function computeSelector(e,s){var n=e+s;return c[n]||(c[n]=s.replace(/__jsx-style-dynamic-selector/g,e)),c[n]}var o=function(){function StyleSheetRegistry(e){var s=void 0===e?{}:e,n=s.styleSheet,t=void 0===n?null:n,i=s.optimizeForSpeed,a=void 0!==i&&i;this._sheet=t||new r({name:"styled-jsx",optimizeForSpeed:a}),this._sheet.inject(),t&&"boolean"==typeof a&&(this._sheet.setOptimizeForSpeed(a),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var e=StyleSheetRegistry.prototype;return e.add=function(e){var s=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer||(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,s){return e[s]=0,e},{}));var n=this.getIdAndRules(e),t=n.styleId,i=n.rules;if(t in this._instancesCounts){this._instancesCounts[t]+=1;return}var a=i.map(function(e){return s._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[t]=a,this._instancesCounts[t]=1},e.remove=function(e){var s=this,n=this.getIdAndRules(e).styleId;if(function(e,s){if(!e)throw Error("StyleSheetRegistry: "+s+".")}(n in this._instancesCounts,"styleId: `"+n+"` not found"),this._instancesCounts[n]-=1,this._instancesCounts[n]<1){var t=this._fromServer&&this._fromServer[n];t?(t.parentNode.removeChild(t),delete this._fromServer[n]):(this._indices[n].forEach(function(e){return s._sheet.deleteRule(e)}),delete this._indices[n]),delete this._instancesCounts[n]}},e.update=function(e,s){this.add(s),this.remove(e)},e.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},e.cssRules=function(){var e=this,s=this._fromServer?Object.keys(this._fromServer).map(function(s){return[s,e._fromServer[s]]}):[],n=this._sheet.cssRules();return s.concat(Object.keys(this._indices).map(function(s){return[s,e._indices[s].map(function(e){return n[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},e.styles=function(e){var s,n;return s=this.cssRules(),void 0===(n=e)&&(n={}),s.map(function(e){var s=e[0],t=e[1];return a.default.createElement("style",{id:"__"+s,key:"__"+s,nonce:n.nonce?n.nonce:void 0,dangerouslySetInnerHTML:{__html:t}})})},e.getIdAndRules=function(e){var s=e.children,n=e.dynamic,t=e.id;if(n){var i=computeId(t,n);return{styleId:i,rules:Array.isArray(s)?s.map(function(e){return computeSelector(i,e)}):[computeSelector(i,s)]}}return{styleId:computeId(t),rules:Array.isArray(s)?s:[s]}},e.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,s){return e[s.id.slice(2)]=s,e},{})},StyleSheetRegistry}(),h=i.createContext(null);h.displayName="StyleSheetContext";var d=a.default.useInsertionEffect||a.default.useLayoutEffect,x=new o;function JSXStyle(e){var s=x||i.useContext(h);return s&&d(function(){return s.add(e),function(){s.remove(e)}},[e.id,String(e.dynamic)]),null}JSXStyle.dynamic=function(e){return e.map(function(e){return computeId(e[0],e[1])}).join(" ")},s.style=JSXStyle},65910:function(e,s,n){"use strict";e.exports=n(96139).style},26228:function(){}},function(e){e.O(0,[3220,1589,9774,2888,179],function(){return e(e.s=58556)}),_N_E=e.O()}]);